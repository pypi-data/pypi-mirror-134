"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[832],{22737:(t,e,n)=>{var i=n(63025),a=n(95023),s=n.n(a),o=n(95161),r=n.n(o),l=n(53806),c=n.n(l),d=n(32735),u=n(12788),m=(n(95499),n(80445)),b=n(44409),p=n(19306),h=n(59090),f=n(12394),y=n(28995),g=n(60216),v=n.n(g),D=n(13213),k=n(53130),E=n(75723),I=n(67986);function _(t){let{open:e,setModalOpen:n,trigger:i,published:a,onClick:s}=t;return d.createElement(D.Z,{open:e,onClose:()=>n(!1),size:"tiny",trigger:i,closeIcon:!0},d.createElement(k.Z,{content:a?p.vN.string("Set contribution list in draft mode"):p.vN.string("Publish contributions")}),d.createElement(D.Z.Content,null,a?d.createElement(d.Fragment,null,d.createElement("p",null,d.createElement(p.vN,null,"Are you sure you want to change the contribution list back to draft mode?")),d.createElement("p",null,d.createElement(p.vN,null,"By doing so the following menu items won't be accessible:"))):d.createElement(d.Fragment,null,d.createElement("p",null,d.createElement(p.vN,null,"Are you sure you want to publish the contribution list?")),d.createElement("p",null,d.createElement(p.vN,null,"By doing so the following menu items will be accessible:"))),d.createElement(E.Z,{bulleted:!0},d.createElement(E.Z.Item,null,d.createElement(p.vN,null,"Contribution List")),d.createElement(E.Z.Item,null,d.createElement(p.vN,null,"My Contributions")),d.createElement(E.Z.Item,null,d.createElement(p.vN,null,"Author List")),d.createElement(E.Z.Item,null,d.createElement(p.vN,null,"Speaker List")),d.createElement(E.Z.Item,null,d.createElement(p.vN,null,"Timetable")),d.createElement(E.Z.Item,null,d.createElement(p.vN,null,"Book of Abstracts")))),d.createElement(D.Z.Actions,null,d.createElement(I.Z,{onClick:()=>n(!1)},d.createElement(p.vN,null,"No")),d.createElement(I.Z,{primary:!0,onClick:s},d.createElement(p.vN,null,"Yes"))))}_.propTypes={open:v().bool.isRequired,setModalOpen:v().func.isRequired,trigger:v().node.isRequired,published:v().bool.isRequired,onClick:v().func.isRequired};const C=i.ZP.bind(null,{endpoint:"contributions.manage_publication",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contributions",isDynamic:!1},{data:"/",isDynamic:!1},{data:"published",isDynamic:!1}]}]},"/");function x(t){let{eventId:e,onSuccess:n}=t;const i=C({event_id:e}),[a,s]=(0,d.useState)(!1),o=d.createElement(b.Lp,{onClick:()=>s(!0)},d.createElement(p.vN,null,"Publish contributions"));return d.createElement(_,{open:a,setModalOpen:s,trigger:o,published:!1,onClick:async()=>{try{await h.l2.put(i)}catch(t){return(0,h.zZ)(t)}n(),s(!1)}})}x.propTypes={eventId:v().string.isRequired,onSuccess:v().func.isRequired};var w=n(41187),S=n(43146);const T=i.ZP.bind(null,{endpoint:"contributions.manage_publication",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"manage",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contributions",isDynamic:!1},{data:"/",isDynamic:!1},{data:"published",isDynamic:!1}]}]},"/");function N(t){let{eventId:e}=t;const[n,i]=(0,d.useState)(!1),[a,s,o,r]=(0,S.RF)(T({event_id:e}));if(o)return null;const l=d.createElement(w.Z,{label:a?p.vN.string("Published"):p.vN.string("Draft"),toggle:!0,onClick:()=>i(!0),checked:a,disabled:r});return d.createElement(_,{open:n,setModalOpen:i,trigger:l,published:a,onClick:()=>{s(),i(!1)}})}N.propTypes={eventId:v().string.isRequired};const L=i.ZP.bind(null,{endpoint:"event_editing.api_file_types",rules:[{args:["event_id","type"],converters:{event_id:"IntegerConverter",type:"AnyConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"editing",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"type",isDynamic:!0},{data:"/",isDynamic:!1},{data:"file-types",isDynamic:!1}]}]},"/"),Z=i.ZP.bind(null,{endpoint:"papers.api_paper_details",rules:[{args:["contrib_id","event_id"],converters:{contrib_id:"IntegerConverter",event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"papers",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"contrib_id",isDynamic:!0}]}]},"/");document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("#contribution-calendar-link");if(!t)return;const{contributionId:e,eventId:n}=t.dataset;u.render(d.createElement(b.Os,{endpoint:"contributions.export_ics",params:{event_id:n,contrib_id:e},renderButton:t=>d.createElement(b.Lp,{icon:"calendar",classes:t}),options:[{key:"contribution",text:p.vN.string("Contribution"),extraParams:{}}]}),t)})),function(t){function e(t){$(t).tablesorter({cssAsc:"header-sort-asc",cssDesc:"header-sort-desc",cssInfoBlock:"avoid-sort",headerTemplate:"",sortList:[[1,0]]})}function n(t,e,n){return $.ajax({url:t,method:e,data:JSON.stringify(n),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress()})}function i(){$(".js-contrib-start-date").each((function(){const t=$(this);t.ajaxqbubble({url:t.data("href"),qBubbleOptions:{style:{classes:"qbubble-contrib-start-date qtip-allow-overflow"}}})}))}function a(){$(".js-contrib-duration").each((function(){const t=$(this);t.ajaxqbubble({url:t.data("href"),qBubbleOptions:{style:{classes:"qbubble-contrib-duration"}}})}))}t.setupEditableSubmissionButton=async function(){const t=document.querySelector("#editable-submission-button");if(!t)return;const e=JSON.parse(t.dataset.availableTypes),{eventId:n,contributionId:i,contributionCode:a}=t.dataset;let s,o,l;try{[s,o]=await Promise.all([Promise.all(e.map((t=>h.l2.get(L({event_id:n,type:t}))))),h.l2.get(Z({event_id:n,contrib_id:i}),{validateStatus:t=>t>=200&&t<300||404===t})])}catch(t){return void(0,h.zZ)(t)}const c=r()(s.map(((t,n)=>[e[n],(0,f.k)(t.data)])));if(o){const{isInFinalState:t,lastRevision:e}=(0,f.k)(o.data);t&&e&&(l=e.files)}u.render(d.createElement(m.Z,{fileTypes:c,eventId:+n,contributionId:+i,contributionCode:a,uploadableFiles:l}),t)},t.setupContributionConfig=function(){!function(){const t=document.querySelector("#pub-switch");u.render(d.createElement(N,{eventId:t.dataset.eventId}),t)}()},t.setupContributionList=function(t){t=$.extend({createSessionURL:null,createTrackURL:null,timetableRESTURL:null},t);$(".list-section [data-toggle=dropdown]").closest(".toolbar").dropdown(),e("#contribution-list .tablesorter"),function(t,e){const i=$("#contribution-list");i.on("click",".session-item-picker",(function(){$(this).itempicker({filterPlaceholder:y.$T.gettext("Filter sessions"),containerClasses:"session-item-container",items:i.find("table").data("session-items"),footerElements:[{title:y.$T.gettext("Assign new session"),onClick(e){ajaxDialog({title:y.$T.gettext("Add new session"),url:t,onClose(t){t&&($(".session-item-picker").each((function(){const e=$(this);e.data("indicoItempicker")?e.itempicker("updateItemList",t.sessions):i.find("table").data("session-items",t.sessions)})),e.itempicker("selectItem",t.new_session_id))}})}}],onSelect(t,i){const a=$(this),s=a[0].style,o={session_id:t?t.id:null};return n(a.data("href"),a.data("method"),o).then((function(o){const r=t?t.title:y.$T.gettext("No session");if(a.find(".label").text(r),t?(s.setProperty("color",`#${t.colors.text}`,"important"),s.setProperty("background",`#${t.colors.background}`,"important")):(s.removeProperty("color"),s.removeProperty("background")),o.unscheduled){const t=a.closest("tr"),s=t.find("td.start-date > .vertical-aligner"),r=s.children().detach();s.html($("<em>",{text:y.$T.gettext("Not scheduled")})),showUndoWarning(y.$T.gettext("'{0}' has been unscheduled due to the session change.").format(t.data("title")),y.$T.gettext("Undo successful! Timetable entry and session have been restored."),(function(){return n(e,"POST",o.undo_unschedule).then((function(t){r.filter(".label").text(" "+c().utc(t.start_dt).format("DD/MM/YYYY HH:mm")),s.html(r),a.itempicker("selectItem",i?i.id:null)}))}))}}))}})}))}(t.createSessionURL,t.timetableRESTURL),function(t){const e=$("#contribution-list");e.on("click",".track-item-picker",(function(){$(this).itempicker({filterPlaceholder:y.$T.gettext("Filter tracks"),containerClasses:"track-item-container",uncheckedItemIcon:"",items:e.find("table").data("track-items"),footerElements:[{title:y.$T.gettext("Add new track"),onClick(n){ajaxDialog({title:y.$T.gettext("Add new track"),url:t,onClose(t){t&&($(".track-item-picker").each((function(){const n=$(this);n.data("indicoItempicker")?n.itempicker("updateItemList",t.tracks):e.find("table").data("track-items",t.tracks)})),n.itempicker("selectItem",t.new_track_id))}})}}],onSelect(t){const e=$(this),i={track_id:t?t.id:null};return n(e.data("href"),e.data("method"),i).then((function(){const n=t?t.title:y.$T.gettext("No track");e.find(".label").text(n)}))}})}))}(t.createTrackURL),i(),a(),enableIfChecked("#contribution-list","input[name=contribution_id]",".js-enable-if-checked");const o=setupListGenerator({itemHandle:"tr",listItems:"#contribution-list tbody tr",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"});$("#contribution-list").on("indico:htmlUpdated",(function(){e("#contribution-list .tablesorter"),i(),a(),s()(o)})).on("attachments:updated",(function(t){const e=$(t.target);reloadManagementAttachmentInfoColumn(e.data("locator"),e.closest("td"))})),$(".js-submit-form").on("click",(function(t){t.preventDefault();const e=$(this);e.hasClass("disabled")||$("#contribution-list form").attr("action",e.data("href")).submit()}))},t.setupSubContributionList=function(){$("#subcontribution-list [data-toggle=dropdown]").closest(".toolbar").dropdown(),e("#subcontribution-list .tablesorter"),enableIfChecked("#subcontribution-list","input[name=subcontribution_id]","#subcontribution-list .js-enable-if-checked"),$("#subcontribution-list td.subcontribution-title").on("mouseenter",(function(){const t=$(this);this.offsetWidth<this.scrollWidth&&!t.attr("title")&&t.attr("title",t.text())})),$("#subcontribution-list").on("attachments:updated",(function(t){const e=$(t.target);reloadManagementAttachmentInfoColumn(e.data("locator"),e.closest("td")),$(this).trigger("ajaxDialog:setData",[!0])})),$("#subcontribution-list").on("indico:htmlUpdated",(function(){$(this).trigger("ajaxDialog:setData",[!0])})),$("#subcontribution-list table").sortable({items:".js-sortable-subcontribution-row",handle:".js-sort-handle",placeholder:"sortable-placeholder",tolerance:"pointer",distance:10,axis:"y",containment:"#subcontribution-list table",start(t,e){e.placeholder.height(e.helper.outerHeight())},update(t,e){const n=$(this);$.ajax({url:e.item.data("sort-url"),method:"POST",data:{subcontrib_ids:n.sortable("toArray")},error:handleAjaxError}),n.trigger("ajaxDialog:setData",[!0])}})},t.setupEventDisplayContributionList=function(){setupListGenerator({itemHandle:"div.contribution-row",listItems:"#display-contribution-list div.contribution-row",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"})()},t.setupEventDisplayAuthorList=function(){setupSearchBox({itemHandle:".author-list > li",listItems:".author-list > li",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"})()},t.setupDraftModeWarning=function(){const t=document.querySelector("#draft-mode-warning"),e=document.querySelector("#draft-mode-warning-button");t&&e&&u.render(d.createElement(x,{eventId:e.dataset.eventId,onSuccess:()=>t.classList.add("hidden")}),e)}}(window)}},t=>{t.O(0,[5514,3044,8592],(()=>{return e=22737,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=module_events.contributions.0f090c17.bundle.js.map