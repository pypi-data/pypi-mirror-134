import{e as W,f as D,s as n,j as L,B as ce,o as u,q as S,N as de,am as _e,C as pe,al as fe,r as b,c as v,d as s,a as l,w as i,D as me,ae as he,u as t,t as c,J as ve,F as ye,p as we,b as xe,g as y,k as p,n as K}from"./vendor.57cae64e.js";import{A as f,E as h,_ as be,S as ke,f as O,s as Q}from"./index.a5b3a1e2.js";import{T as ge}from"./Timeline.fc00bf98.js";import{R as Re,M as Ie}from"./MiniRadar.52d95942.js";const Te=W({props:{id:{type:String,required:!0}},setup(w){const k=w,g=D(new Re),m=n(()=>({id:k.id})),d={radar:f.query({endpoint:h.radar,body:m,options:{pollInterval:5e3}})};return L(()=>{var a;return(a=d.radar.response)==null?void 0:a.value},a=>{a&&g.value.items(a)}),ce(()=>{g.value.id("id").dependencies("upstream_dependencies").items([])}),(a,E)=>(u(),S(Ie,{id:w.id,radar:g.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const R=w=>(we("data-v-a921227a"),w=w(),xe(),w),Fe={class:"main-grid"},Se={class:"d-flex align-center justify-space-between py-1 px-2"},qe={class:"d-inline-flex flex-column"},Ce={class:"flex-grow-0 flex-shrink-1"},Be={class:"d-inline-flex align-center text-truncate"},je={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},Ne={key:0},De=p(" Started: "),Le={class:"text--grey-80 mr-1 ml--half"},Ee={key:1},Ve=p(" Ended: "),Me={class:"text--grey-80 mr-1 ml--half"},Ae={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},$e={key:0},Pe=p(" Deployment: "),Ue={class:"text--grey-80 mr-1 ml--half"},ze={key:1},Ge=p(" Parent: "),He={class:"text--grey-80"},Je=p(" /"),We={key:2},Ke=p(" Results: "),Oe={class:"text--grey-80 mr-1 ml--half"},Qe={key:3},Xe=p(" Flow version: "),Ye={class:"text--grey-80 mr-1 ml--half"},Ze={class:"font--secondary"},et={class:"d-flex align-center justify-space-between py-1 px-2"},tt=R(()=>s("div",{class:"subheader"},"Timeline",-1)),st={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},nt={class:"d-flex align-center justify-space-between py-1 px-2"},ot=R(()=>s("div",{class:"subheader"},"Radar",-1)),at={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},lt=R(()=>s("i",{class:"pi pi-task mr-1 text--grey-40"},null,-1)),rt=p(" Task Runs "),ut=R(()=>s("i",{class:"pi pi-flow-run mr-1 text--grey-40"},null,-1)),it=p(" Subflow Runs "),ct={class:"font--secondary caption my-2",style:{"min-height":"17px"}},dt={class:"results-section d-flex flex-column align-stretch justify-stretch"},_t={class:"text-center my-8",key:"no-results"},pt=R(()=>s("h2",null," No Results Found ",-1)),ft=[pt],mt=R(()=>s("hr",{class:"results-hr mt-3"},null,-1)),ht=W({async setup(w){let k,g;const m=de(),d=D("task_runs"),a=D(m==null?void 0:m.params.id),E=n(()=>({id:a.value})),x=([k,g]=_e(()=>f.query({endpoint:h.flow_run,body:E,options:{pollInterval:5e3}}).fetch()),k=await k,g(),k),X=n(()=>x.response.value.flow_id),I=n(()=>x.response.value.parent_task_run_id),q=n(()=>x.response.value.deployment_id),Y=n(()=>({id:X.value})),Z=n(()=>({id:q.value})),V=n(()=>({task_runs:{id:{any_:[I.value]}}})),C=n(()=>({flow_runs:{id:{any_:[a.value]}}})),M=n(()=>({flow_runs:{id:{any_:[a.value]}},task_runs:{subflow_runs:{exists_:!0}}})),o={flow:f.query({endpoint:h.flow,body:Y}),deployment:f.query({endpoint:h.deployment,body:Z,options:{paused:!q.value}}),parent_flow:f.query({endpoint:h.flows,body:V,options:{paused:!I.value}}),parent_flow_run:f.query({endpoint:h.flow_runs,body:V,options:{paused:!I.value}}),task_runs_count:f.query({endpoint:h.task_runs_count,body:C,options:{pollInterval:1e4}}),task_runs:f.query({endpoint:h.task_runs,body:C,options:{pollInterval:1e4}}),sub_flow_runs_count:f.query({endpoint:h.task_runs_count,body:M,options:{pollInterval:1e4}})},ee={task_runs:"task_runs_count",sub_flow_runs:"sub_flow_runs_count"},T=n(()=>{var e;return d.value&&((e=o[ee[d.value]])==null?void 0:e.response)||0}),B=n(()=>{var e;return((e=o.deployment.response)==null?void 0:e.value)||{}}),A=n(()=>{var e,_;return((_=(e=o.parent_flow.response)==null?void 0:e.value)==null?void 0:_[0])||{}}),$=n(()=>{var e,_;return((_=(e=o.parent_flow_run.response)==null?void 0:e.value)==null?void 0:_[0])||{}}),P=n(()=>{var e,_;return(_=(e=B.value)==null?void 0:e.flow_data)==null?void 0:_.blob}),r=n(()=>{var e;return((e=x.response)==null?void 0:e.value)||{}}),te=n(()=>r.value.end_time),F=n(()=>{var e;return(e=r.value)==null?void 0:e.state}),se=n(()=>{var e;return((e=r.value)==null?void 0:e.tags)||[]}),ne=n(()=>{var e;return((e=o.task_runs_count.response)==null?void 0:e.value)||0}),oe=n(()=>{var e;return((e=o.sub_flow_runs_count.response)==null?void 0:e.value)||0}),U=n(()=>{var e;return((e=o.task_runs.response)==null?void 0:e.value)||[]}),ae=n(()=>F.value.type=="PENDING"||F.value.type=="SCHEDULED"?"--":r.value.total_run_time?Q(r.value.total_run_time):Q(r.value.estimated_run_time));pe(()=>{x.stopPolling(),f.queries.delete(x.id)});const le=L(m,()=>{a.value=m==null?void 0:m.params.id});return fe(()=>{le()}),L(a,async()=>{!a.value||(await x.fetch(),o.flow.fetch(),o.task_runs_count.fetch(),o.task_runs.fetch(),o.sub_flow_runs_count.fetch(),q.value?o.deployment.fetch():o.deployment.clearResult(),I.value?o.parent_flow.fetch():o.parent_flow.clearResult(),I.value?o.parent_flow_run.fetch():o.parent_flow_run.clearResult(),d.value="task_runs")}),(e,_)=>{var J;const re=b("Tags"),j=b("router-link"),N=b("Card"),z=b("IconButton"),G=b("Tab"),ue=b("Tabs"),H=b("ResultsList");return u(),v(ye,null,[s("div",Fe,[l(N,{class:"details",shadow:"sm"},{default:i(()=>[s("div",Se,[s("div",qe,[s("div",Ce,[s("span",Be,[l(ke,{name:t(F).name,type:t(F).type,class:"mr-1"},null,8,["name","type"]),l(re,{tags:t(se),class:"mr-1 caption"},null,8,["tags"]),s("div",je,[t(r).start_time?(u(),v("span",Ne,[De,s("span",Le,c(t(O)(t(r).start_time)),1)])):y("",!0),t(r).end_time?(u(),v("span",Ee,[Ve,s("span",Me,c(t(O)(t(r).end_time)),1)])):y("",!0)])])]),s("div",Ae,[t(B).name?(u(),v("span",$e,[Pe,s("span",Ue,c(t(B).name),1)])):y("",!0),t(A).name?(u(),v("span",ze,[Ge,s("span",He,c(t(A).name),1),Je,l(j,{to:`/flow-run/${t($).id}`,class:"mr-1 ml--half text--primary"},{default:i(()=>[p(c(t($).name),1)]),_:1},8,["to"])])):y("",!0),t(P)?(u(),v("span",We,[Ke,s("span",Oe,c(t(P)),1)])):y("",!0),t(r).flow_version?(u(),v("span",Qe,[Xe,s("span",Ye,c(t(r).flow_version),1)])):y("",!0)])]),s("div",Ze,c(t(ae)),1)])]),_:1}),l(N,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:i(()=>[s("div",et,[tt,l(j,{to:`/flow-run/${a.value}/timeline`},{default:i(()=>[l(z,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:i(()=>[s("div",st,[t(U).length?(u(),S(ge,{key:0,items:t(U),"max-end-time":t(te),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):y("",!0)])]),_:1}),l(N,{class:"radar",shadow:"sm"},{header:i(()=>[s("div",nt,[ot,l(j,{to:`/flow-run/${a.value}/radar`},{default:i(()=>[l(z,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:i(()=>[s("div",at,[l(Te,{id:a.value},null,8,["id"])])]),_:1})]),l(ue,{modelValue:d.value,"onUpdate:modelValue":_[0]||(_[0]=ie=>d.value=ie),class:"mt-3"},{default:i(()=>[l(G,{href:"task_runs",class:"subheader"},{default:i(()=>[lt,rt,s("span",{class:K(["result-badge caption ml-1",{active:d.value=="task_runs"}])},c(t(ne).toLocaleString()),3)]),_:1}),l(G,{href:"sub_flow_runs",class:"subheader"},{default:i(()=>[ut,it,s("span",{class:K(["result-badge caption ml-1",{active:d.value=="sub_flow_runs"}])},c(t(oe).toLocaleString()),3)]),_:1})]),_:1},8,["modelValue"]),s("div",ct,[me(s("span",null,c((J=t(T).value)==null?void 0:J.toLocaleString())+" Result"+c(t(T).value!==1?"s":""),513),[[he,t(T).value>0]])]),s("section",dt,[l(ve,{name:"tab-fade",mode:"out-in",css:""},{default:i(()=>[t(T)===0?(u(),v("div",_t,ft)):d.value=="task_runs"?(u(),S(H,{key:"task_runs",filter:t(C),component:"list-item-task-run",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):d.value=="sub_flow_runs"?(u(),S(H,{key:"sub_flow_runs",filter:t(M),component:"list-item-sub-flow-run",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):y("",!0)]),_:1})]),mt],64)}}});var bt=be(ht,[["__scopeId","data-v-a921227a"]]);export{bt as default};
