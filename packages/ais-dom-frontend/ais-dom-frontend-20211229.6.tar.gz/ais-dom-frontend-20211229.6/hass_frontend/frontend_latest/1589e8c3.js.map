{"version":3,"file":"1589e8c3.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;;ACuBA;;;AAcA;AACA;;AAGA;;AAEA;AAEA;;AAIA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAEA;;AAMA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;AAKA;;AAGA;;;AAGA;;;;;;AAMA;AACA;AACA;AACA;AACA;;;;;AAKA;;;;;;;AAQA;;;;;AAKA;AACA;;AAEA;AAKA;AACA;;;;;;;;AASA;;;;;AAMA;;;;;AAKA;AACA;;AAEA;AAEA;AACA;;;;;;AASA;AAEA;;;;;AAMA;;;;;AAKA;AACA;;AAEA;AAEA;AACA;;;;;;AASA;AAEA;;;;;AAMA;;;;;AAKA;AACA;;AAEA;AAEA;;;;;AAMA;AAEA;;;;AAKA;;;AAGA;AACA;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA9PA","sources":["webpack://home-assistant-frontend/./src/components/ha-climate-control.js","webpack://home-assistant-frontend/./src/dialogs/more-info/controls/more-info-climate.ts"],"sourcesContent":["import \"@polymer/iron-flex-layout/iron-flex-layout-classes\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { EventsMixin } from \"../mixins/events-mixin\";\nimport \"./ha-icon\";\nimport \"./ha-icon-button\";\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaClimateControl extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-flex iron-flex-alignment\"></style>\n      <style>\n        /* local DOM styles go here */\n        :host {\n          @apply --layout-flex;\n          @apply --layout-horizontal;\n          @apply --layout-justified;\n        }\n        .in-flux#target_temperature {\n          color: var(--error-color);\n        }\n        #target_temperature {\n          @apply --layout-self-center;\n          font-size: 200%;\n          direction: ltr;\n        }\n        .control-buttons {\n          font-size: 200%;\n          text-align: right;\n        }\n        ha-icon-button {\n          --mdc-icon-size: 32px;\n        }\n      </style>\n\n      <!-- local DOM goes here -->\n      <div id=\"target_temperature\">[[value]] [[units]]</div>\n      <div class=\"control-buttons\">\n        <div>\n          <ha-icon-button on-click=\"incrementValue\">\n            <ha-icon icon=\"hass:chevron-up\"></ha-icon>\n          </ha-icon-button>\n        </div>\n        <div>\n          <ha-icon-button on-click=\"decrementValue\">\n            <ha-icon icon=\"hass:chevron-down\"></ha-icon>\n          </ha-icon-button>\n        </div>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      value: {\n        type: Number,\n        observer: \"valueChanged\",\n      },\n      units: {\n        type: String,\n      },\n      min: {\n        type: Number,\n      },\n      max: {\n        type: Number,\n      },\n      step: {\n        type: Number,\n        value: 1,\n      },\n    };\n  }\n\n  temperatureStateInFlux(inFlux) {\n    this.$.target_temperature.classList.toggle(\"in-flux\", inFlux);\n  }\n\n  _round(val) {\n    // round value to precision derived from step\n    // insired by https://github.com/soundar24/roundSlider/blob/master/src/roundslider.js\n    const s = this.step.toString().split(\".\");\n    return s[1] ? parseFloat(val.toFixed(s[1].length)) : Math.round(val);\n  }\n\n  incrementValue() {\n    const newval = this._round(this.value + this.step);\n    if (this.value < this.max) {\n      this.last_changed = Date.now();\n      this.temperatureStateInFlux(true);\n    }\n    if (newval <= this.max) {\n      // If no initial target_temp\n      // this forces control to start\n      // from the min configured instead of 0\n      if (newval <= this.min) {\n        this.value = this.min;\n      } else {\n        this.value = newval;\n      }\n    } else {\n      this.value = this.max;\n    }\n  }\n\n  decrementValue() {\n    const newval = this._round(this.value - this.step);\n    if (this.value > this.min) {\n      this.last_changed = Date.now();\n      this.temperatureStateInFlux(true);\n    }\n    if (newval >= this.min) {\n      this.value = newval;\n    } else {\n      this.value = this.min;\n    }\n  }\n\n  valueChanged() {\n    // when the last_changed timestamp is changed,\n    // trigger a potential event fire in\n    // the future, as long as last changed is far enough in the\n    // past.\n    if (this.last_changed) {\n      window.setTimeout(() => {\n        const now = Date.now();\n        if (now - this.last_changed >= 2000) {\n          this.fire(\"change\");\n          this.temperatureStateInFlux(false);\n          this.last_changed = null;\n        }\n      }, 2010);\n    }\n  }\n}\n\ncustomElements.define(\"ha-climate-control\", HaClimateControl);\n","import \"@polymer/iron-flex-layout/iron-flex-layout-classes\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { property } from \"lit/decorators\";\nimport { classMap } from \"lit/directives/class-map\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport { supportsFeature } from \"../../../common/entity/supports-feature\";\nimport { computeRTLDirection } from \"../../../common/util/compute_rtl\";\nimport \"../../../components/ha-climate-control\";\nimport \"../../../components/ha-paper-dropdown-menu\";\nimport \"../../../components/ha-slider\";\nimport \"../../../components/ha-switch\";\nimport {\n  ClimateEntity,\n  CLIMATE_SUPPORT_AUX_HEAT,\n  CLIMATE_SUPPORT_FAN_MODE,\n  CLIMATE_SUPPORT_PRESET_MODE,\n  CLIMATE_SUPPORT_SWING_MODE,\n  CLIMATE_SUPPORT_TARGET_HUMIDITY,\n  CLIMATE_SUPPORT_TARGET_TEMPERATURE,\n  CLIMATE_SUPPORT_TARGET_TEMPERATURE_RANGE,\n  compareClimateHvacModes,\n} from \"../../../data/climate\";\nimport { HomeAssistant } from \"../../../types\";\n\nclass MoreInfoClimate extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public stateObj?: ClimateEntity;\n\n  private _resizeDebounce?: number;\n\n  protected render(): TemplateResult {\n    if (!this.stateObj) {\n      return html``;\n    }\n\n    const hass = this.hass;\n    const stateObj = this.stateObj;\n\n    const supportTargetTemperature = supportsFeature(\n      stateObj,\n      CLIMATE_SUPPORT_TARGET_TEMPERATURE\n    );\n    const supportTargetTemperatureRange = supportsFeature(\n      stateObj,\n      CLIMATE_SUPPORT_TARGET_TEMPERATURE_RANGE\n    );\n    const supportTargetHumidity = supportsFeature(\n      stateObj,\n      CLIMATE_SUPPORT_TARGET_HUMIDITY\n    );\n    const supportFanMode = supportsFeature(stateObj, CLIMATE_SUPPORT_FAN_MODE);\n    const supportPresetMode = supportsFeature(\n      stateObj,\n      CLIMATE_SUPPORT_PRESET_MODE\n    );\n    const supportSwingMode = supportsFeature(\n      stateObj,\n      CLIMATE_SUPPORT_SWING_MODE\n    );\n    const supportAuxHeat = supportsFeature(stateObj, CLIMATE_SUPPORT_AUX_HEAT);\n\n    const temperatureStepSize =\n      stateObj.attributes.target_temp_step ||\n      (hass.config.unit_system.temperature.indexOf(\"F\") === -1 ? 0.5 : 1);\n\n    const rtlDirection = computeRTLDirection(hass);\n\n    return html`\n      <div\n        class=${classMap({\n          \"has-current_temperature\":\n            \"current_temperature\" in stateObj.attributes,\n          \"has-current_humidity\": \"current_humidity\" in stateObj.attributes,\n          \"has-target_temperature\": supportTargetTemperature,\n          \"has-target_temperature_range\": supportTargetTemperatureRange,\n          \"has-target_humidity\": supportTargetHumidity,\n          \"has-fan_mode\": supportFanMode,\n          \"has-swing_mode\": supportSwingMode,\n          \"has-aux_heat\": supportAuxHeat,\n          \"has-preset_mode\": supportPresetMode,\n        })}\n      >\n        <div class=\"container-temperature\">\n          <div class=${stateObj.state}>\n            ${supportTargetTemperature || supportTargetTemperatureRange\n              ? html`\n                  <div>\n                    ${hass.localize(\"ui.card.climate.target_temperature\")}\n                  </div>\n                `\n              : \"\"}\n            ${stateObj.attributes.temperature !== undefined &&\n            stateObj.attributes.temperature !== null\n              ? html`\n                  <ha-climate-control\n                    .value=${stateObj.attributes.temperature}\n                    .units=${hass.config.unit_system.temperature}\n                    .step=${temperatureStepSize}\n                    .min=${stateObj.attributes.min_temp}\n                    .max=${stateObj.attributes.max_temp}\n                    @change=${this._targetTemperatureChanged}\n                  ></ha-climate-control>\n                `\n              : \"\"}\n            ${(stateObj.attributes.target_temp_low !== undefined &&\n              stateObj.attributes.target_temp_low !== null) ||\n            (stateObj.attributes.target_temp_high !== undefined &&\n              stateObj.attributes.target_temp_high !== null)\n              ? html`\n                  <ha-climate-control\n                    .value=${stateObj.attributes.target_temp_low}\n                    .units=${hass.config.unit_system.temperature}\n                    .step=${temperatureStepSize}\n                    .min=${stateObj.attributes.min_temp}\n                    .max=${stateObj.attributes.target_temp_high}\n                    class=\"range-control-left\"\n                    @change=${this._targetTemperatureLowChanged}\n                  ></ha-climate-control>\n                  <ha-climate-control\n                    .value=${stateObj.attributes.target_temp_high}\n                    .units=${hass.config.unit_system.temperature}\n                    .step=${temperatureStepSize}\n                    .min=${stateObj.attributes.target_temp_low}\n                    .max=${stateObj.attributes.max_temp}\n                    class=\"range-control-right\"\n                    @change=${this._targetTemperatureHighChanged}\n                  ></ha-climate-control>\n                `\n              : \"\"}\n          </div>\n        </div>\n\n        ${supportTargetHumidity\n          ? html`\n              <div class=\"container-humidity\">\n                <div>${hass.localize(\"ui.card.climate.target_humidity\")}</div>\n                <div class=\"single-row\">\n                  <div class=\"target-humidity\">\n                    ${stateObj.attributes.humidity} %\n                  </div>\n                  <ha-slider\n                    step=\"1\"\n                    pin\n                    ignore-bar-touch\n                    dir=${rtlDirection}\n                    .min=${stateObj.attributes.min_humidity}\n                    .max=${stateObj.attributes.max_humidity}\n                    .value=${stateObj.attributes.humidity}\n                    @change=${this._targetHumiditySliderChanged}\n                  >\n                  </ha-slider>\n                </div>\n              </div>\n            `\n          : \"\"}\n\n        <div class=\"container-hvac_modes\">\n          <div class=\"controls\">\n            <ha-paper-dropdown-menu\n              label-float\n              dynamic-align\n              .label=${hass.localize(\"ui.card.climate.operation\")}\n            >\n              <paper-listbox\n                slot=\"dropdown-content\"\n                attr-for-selected=\"item-name\"\n                .selected=${stateObj.state}\n                @selected-changed=${this._handleOperationmodeChanged}\n              >\n                ${stateObj.attributes.hvac_modes\n                  .concat()\n                  .sort(compareClimateHvacModes)\n                  .map(\n                    (mode) => html`\n                      <paper-item item-name=${mode}>\n                        ${hass.localize(`component.climate.state._.${mode}`)}\n                      </paper-item>\n                    `\n                  )}\n              </paper-listbox>\n            </ha-paper-dropdown-menu>\n          </div>\n        </div>\n\n        ${supportPresetMode && stateObj.attributes.preset_modes\n          ? html`\n              <div class=\"container-preset_modes\">\n                <ha-paper-dropdown-menu\n                  label-float\n                  dynamic-align\n                  .label=${hass.localize(\"ui.card.climate.preset_mode\")}\n                >\n                  <paper-listbox\n                    slot=\"dropdown-content\"\n                    attr-for-selected=\"item-name\"\n                    .selected=${stateObj.attributes.preset_mode}\n                    @selected-changed=${this._handlePresetmodeChanged}\n                  >\n                    ${stateObj.attributes.preset_modes!.map(\n                      (mode) => html`\n                        <paper-item item-name=${mode}>\n                          ${hass.localize(\n                            `state_attributes.climate.preset_mode.${mode}`\n                          ) || mode}\n                        </paper-item>\n                      `\n                    )}\n                  </paper-listbox>\n                </ha-paper-dropdown-menu>\n              </div>\n            `\n          : \"\"}\n        ${supportFanMode && stateObj.attributes.fan_modes\n          ? html`\n              <div class=\"container-fan_list\">\n                <ha-paper-dropdown-menu\n                  label-float\n                  dynamic-align\n                  .label=${hass.localize(\"ui.card.climate.fan_mode\")}\n                >\n                  <paper-listbox\n                    slot=\"dropdown-content\"\n                    attr-for-selected=\"item-name\"\n                    .selected=${stateObj.attributes.fan_mode}\n                    @selected-changed=${this._handleFanmodeChanged}\n                  >\n                    ${stateObj.attributes.fan_modes!.map(\n                      (mode) => html`\n                        <paper-item item-name=${mode}>\n                          ${hass.localize(\n                            `state_attributes.climate.fan_mode.${mode}`\n                          ) || mode}\n                        </paper-item>\n                      `\n                    )}\n                  </paper-listbox>\n                </ha-paper-dropdown-menu>\n              </div>\n            `\n          : \"\"}\n        ${supportSwingMode && stateObj.attributes.swing_modes\n          ? html`\n              <div class=\"container-swing_list\">\n                <ha-paper-dropdown-menu\n                  label-float\n                  dynamic-align\n                  .label=${hass.localize(\"ui.card.climate.swing_mode\")}\n                >\n                  <paper-listbox\n                    slot=\"dropdown-content\"\n                    attr-for-selected=\"item-name\"\n                    .selected=${stateObj.attributes.swing_mode}\n                    @selected-changed=${this._handleSwingmodeChanged}\n                  >\n                    ${stateObj.attributes.swing_modes!.map(\n                      (mode) => html`\n                        <paper-item item-name=${mode}>${mode}</paper-item>\n                      `\n                    )}\n                  </paper-listbox>\n                </ha-paper-dropdown-menu>\n              </div>\n            `\n          : \"\"}\n        ${supportAuxHeat\n          ? html`\n              <div class=\"container-aux_heat\">\n                <div class=\"center horizontal layout single-row\">\n                  <div class=\"flex\">\n                    ${hass.localize(\"ui.card.climate.aux_heat\")}\n                  </div>\n                  <ha-switch\n                    .checked=${stateObj.attributes.aux_heat === \"on\"}\n                    @change=${this._auxToggleChanged}\n                  ></ha-switch>\n                </div>\n              </div>\n            `\n          : \"\"}\n      </div>\n    `;\n  }\n\n  protected updated(changedProps: PropertyValues) {\n    super.updated(changedProps);\n    if (!changedProps.has(\"stateObj\") || !this.stateObj) {\n      return;\n    }\n\n    if (this._resizeDebounce) {\n      clearTimeout(this._resizeDebounce);\n    }\n    this._resizeDebounce = window.setTimeout(() => {\n      fireEvent(this, \"iron-resize\");\n      this._resizeDebounce = undefined;\n    }, 500);\n  }\n\n  private _targetTemperatureChanged(ev) {\n    const newVal = ev.target.value;\n    this._callServiceHelper(\n      this.stateObj!.attributes.temperature,\n      newVal,\n      \"set_temperature\",\n      { temperature: newVal }\n    );\n  }\n\n  private _targetTemperatureLowChanged(ev) {\n    const newVal = ev.currentTarget.value;\n    this._callServiceHelper(\n      this.stateObj!.attributes.target_temp_low,\n      newVal,\n      \"set_temperature\",\n      {\n        target_temp_low: newVal,\n        target_temp_high: this.stateObj!.attributes.target_temp_high,\n      }\n    );\n  }\n\n  private _targetTemperatureHighChanged(ev) {\n    const newVal = ev.currentTarget.value;\n    this._callServiceHelper(\n      this.stateObj!.attributes.target_temp_high,\n      newVal,\n      \"set_temperature\",\n      {\n        target_temp_low: this.stateObj!.attributes.target_temp_low,\n        target_temp_high: newVal,\n      }\n    );\n  }\n\n  private _targetHumiditySliderChanged(ev) {\n    const newVal = ev.target.value;\n    this._callServiceHelper(\n      this.stateObj!.attributes.humidity,\n      newVal,\n      \"set_humidity\",\n      { humidity: newVal }\n    );\n  }\n\n  private _auxToggleChanged(ev) {\n    const newVal = ev.target.checked;\n    this._callServiceHelper(\n      this.stateObj!.attributes.aux_heat === \"on\",\n      newVal,\n      \"set_aux_heat\",\n      { aux_heat: newVal }\n    );\n  }\n\n  private _handleFanmodeChanged(ev) {\n    const newVal = ev.detail.value;\n    this._callServiceHelper(\n      this.stateObj!.attributes.fan_mode,\n      newVal,\n      \"set_fan_mode\",\n      { fan_mode: newVal }\n    );\n  }\n\n  private _handleOperationmodeChanged(ev) {\n    const newVal = ev.detail.value;\n    this._callServiceHelper(this.stateObj!.state, newVal, \"set_hvac_mode\", {\n      hvac_mode: newVal,\n    });\n  }\n\n  private _handleSwingmodeChanged(ev) {\n    const newVal = ev.detail.value;\n    this._callServiceHelper(\n      this.stateObj!.attributes.swing_mode,\n      newVal,\n      \"set_swing_mode\",\n      { swing_mode: newVal }\n    );\n  }\n\n  private _handlePresetmodeChanged(ev) {\n    const newVal = ev.detail.value || null;\n    this._callServiceHelper(\n      this.stateObj!.attributes.preset_mode,\n      newVal,\n      \"set_preset_mode\",\n      { preset_mode: newVal }\n    );\n  }\n\n  private async _callServiceHelper(\n    oldVal: unknown,\n    newVal: unknown,\n    service: string,\n    data: {\n      entity_id?: string;\n      [key: string]: unknown;\n    }\n  ) {\n    if (oldVal === newVal) {\n      return;\n    }\n\n    data.entity_id = this.stateObj!.entity_id;\n    const curState = this.stateObj;\n\n    await this.hass.callService(\"climate\", service, data);\n\n    // We reset stateObj to re-sync the inputs with the state. It will be out\n    // of sync if our service call did not result in the entity to be turned\n    // on. Since the state is not changing, the resync is not called automatic.\n    await new Promise((resolve) => setTimeout(resolve, 2000));\n\n    // No need to resync if we received a new state.\n    if (this.stateObj !== curState) {\n      return;\n    }\n\n    this.stateObj = undefined;\n    await this.updateComplete;\n    // Only restore if not set yet by a state change\n    if (this.stateObj === undefined) {\n      this.stateObj = curState;\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        color: var(--primary-text-color);\n      }\n\n      ha-paper-dropdown-menu {\n        width: 100%;\n      }\n\n      paper-item {\n        cursor: pointer;\n      }\n\n      ha-slider {\n        width: 100%;\n      }\n\n      .container-humidity .single-row {\n        display: flex;\n        height: 50px;\n      }\n\n      .target-humidity {\n        width: 90px;\n        font-size: 200%;\n        margin: auto;\n        direction: ltr;\n      }\n\n      ha-climate-control.range-control-left,\n      ha-climate-control.range-control-right {\n        float: left;\n        width: 46%;\n      }\n      ha-climate-control.range-control-left {\n        margin-right: 4%;\n      }\n      ha-climate-control.range-control-right {\n        margin-left: 4%;\n      }\n\n      .single-row {\n        padding: 8px 0;\n      }\n    `;\n  }\n}\n\ncustomElements.define(\"more-info-climate\", MoreInfoClimate);\n"],"names":[],"sourceRoot":""}