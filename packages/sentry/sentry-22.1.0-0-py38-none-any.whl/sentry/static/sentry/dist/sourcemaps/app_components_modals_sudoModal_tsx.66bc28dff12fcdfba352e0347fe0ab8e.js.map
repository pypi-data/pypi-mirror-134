{"version":3,"file":"chunks/app_components_modals_sudoModal_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/u2f/u2fContainer.tsx","webpack:///./app/components/modals/sudoModal.tsx","webpack:///./app/components/u2f/webAuthnHelper.tsx","webpack:///./app/components/u2f/u2finterface.tsx","webpack:///./app/components/u2f/u2fsign.tsx","webpack:///./app/utils/useApi.tsx","webpack:///./app/utils/withApi.tsx"],"sourcesContent":["import {Component} from 'react';\n\nimport {Client} from 'sentry/api';\nimport {Authenticator} from 'sentry/types';\nimport withApi from 'sentry/utils/withApi';\n\nimport U2fSign from './u2fsign';\n\ntype Props = {\n  api: Client;\n  onTap: U2fSign['props']['onTap'];\n  displayMode?: U2fSign['props']['displayMode'];\n  className?: string;\n  isWebauthnSigninFFEnabled: boolean;\n};\ntype State = {\n  authenticators: Array<Authenticator>;\n};\n\nclass U2fContainer extends Component<Props, State> {\n  state: State = {\n    authenticators: [],\n  };\n  componentDidMount() {\n    this.getAuthenticators();\n  }\n\n  async getAuthenticators() {\n    const {api} = this.props;\n\n    try {\n      const authenticators = await api.requestPromise('/authenticators/');\n      this.setState({authenticators: authenticators ?? []});\n    } catch {\n      // ignore errors\n    }\n  }\n\n  render() {\n    const {className} = this.props;\n    const {authenticators} = this.state;\n\n    if (!authenticators.length) {\n      return null;\n    }\n\n    return (\n      <div className={className}>\n        {authenticators.map(auth =>\n          auth.id === 'u2f' && auth.challenge ? (\n            <U2fSign key={auth.id} {...this.props} challengeData={auth.challenge} />\n          ) : null\n        )}\n      </div>\n    );\n  }\n}\n\nexport default withApi(U2fContainer);\n","import * as React from 'react';\nimport {withRouter, WithRouterProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {ModalRenderProps} from 'sentry/actionCreators/modal';\nimport {Client} from 'sentry/api';\nimport Alert from 'sentry/components/alert';\nimport Button from 'sentry/components/button';\nimport U2fContainer from 'sentry/components/u2f/u2fContainer';\nimport {IconFlag} from 'sentry/icons';\nimport {t} from 'sentry/locale';\nimport ConfigStore from 'sentry/stores/configStore';\nimport space from 'sentry/styles/space';\nimport withApi from 'sentry/utils/withApi';\nimport Form from 'sentry/views/settings/components/forms/form';\nimport InputField from 'sentry/views/settings/components/forms/inputField';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\n\ntype OnTapProps = NonNullable<React.ComponentProps<typeof U2fContainer>['onTap']>;\n\ntype Props = WithRouterProps &\n  Pick<ModalRenderProps, 'Body' | 'Header'> & {\n    api: Client;\n    closeModal: () => void;\n    /**\n     * User is a superuser without an active su session\n     */\n    superuser?: boolean;\n    /**\n     * expects a function that returns a Promise\n     */\n    retryRequest?: () => Promise<any>;\n  };\n\ntype State = {\n  error: boolean;\n  busy: boolean;\n};\n\nclass SudoModal extends React.Component<Props, State> {\n  state: State = {\n    error: false,\n    busy: false,\n  };\n\n  handleSuccess = () => {\n    const {closeModal, superuser, location, router, retryRequest} = this.props;\n\n    if (!retryRequest) {\n      closeModal();\n      return;\n    }\n\n    if (superuser) {\n      router.replace({pathname: location.pathname, state: {forceUpdate: new Date()}});\n      return;\n    }\n\n    this.setState({busy: true}, () => {\n      retryRequest().then(() => {\n        this.setState({busy: false}, closeModal);\n      });\n    });\n  };\n\n  handleError = () => {\n    this.setState({busy: false, error: true});\n  };\n\n  handleU2fTap = async (data: Parameters<OnTapProps>[0]) => {\n    this.setState({busy: true});\n\n    const {api} = this.props;\n\n    try {\n      await api.requestPromise('/auth/', {method: 'PUT', data});\n      this.handleSuccess();\n    } catch (err) {\n      this.setState({busy: false});\n      // u2fInterface relies on this\n      throw err;\n    }\n  };\n\n  renderBodyContent() {\n    const {superuser} = this.props;\n    const {error} = this.state;\n    const user = ConfigStore.get('user');\n    if (!user.hasPasswordAuth) {\n      return (\n        <React.Fragment>\n          <TextBlock>{t('You will need to reauthenticate to continue.')}</TextBlock>\n          <Button\n            priority=\"primary\"\n            href={`/auth/login/?next=${encodeURIComponent(location.pathname)}`}\n          >\n            {t('Continue')}\n          </Button>\n        </React.Fragment>\n      );\n    }\n\n    return (\n      <React.Fragment>\n        <StyledTextBlock>\n          {superuser\n            ? t(\n                'You are attempting to access a resource that requires superuser access, please re-authenticate as a superuser.'\n              )\n            : t('Help us keep your account safe by confirming your identity.')}\n        </StyledTextBlock>\n\n        {error && (\n          <StyledAlert type=\"error\" icon={<IconFlag size=\"md\" />}>\n            {t('Incorrect password')}\n          </StyledAlert>\n        )}\n\n        <Form\n          apiMethod=\"PUT\"\n          apiEndpoint=\"/auth/\"\n          submitLabel={t('Confirm Password')}\n          onSubmitSuccess={this.handleSuccess}\n          onSubmitError={this.handleError}\n          hideFooter={!user.hasPasswordAuth}\n          resetOnError\n        >\n          <StyledInputField\n            type=\"password\"\n            inline={false}\n            label={t('Password')}\n            name=\"password\"\n            autoFocus\n            flexibleControlStateSize\n          />\n          <U2fContainer\n            displayMode=\"sudo\"\n            onTap={this.handleU2fTap}\n            isWebauthnSigninFFEnabled\n          />\n        </Form>\n      </React.Fragment>\n    );\n  }\n\n  render() {\n    const {Header, Body} = this.props;\n\n    return (\n      <React.Fragment>\n        <Header closeButton>{t('Confirm Password to Continue')}</Header>\n        <Body>{this.renderBodyContent()}</Body>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withRouter(withApi(SudoModal));\nexport {SudoModal};\n\nconst StyledTextBlock = styled(TextBlock)`\n  margin-bottom: ${space(1)};\n`;\n\nconst StyledInputField = styled(InputField)`\n  padding-left: 0;\n`;\n\nconst StyledAlert = styled(Alert)`\n  margin-bottom: 0;\n`;\n","// Copyright (c) 2019 GitHub, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"),\n// to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\n// and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n// DEALINGS IN THE SOFTWARE.\n\n// below is from https://github.com/github/webauthn-json/tree/66322fc5c12184c5269691ab5abaac79545a3916\n\nexport function base64urlToBuffer(baseurl64String: string): ArrayBuffer {\n  // Base64url to Base64\n  const padding = '=='.slice(0, (4 - (baseurl64String.length % 4)) % 4);\n  const base64String = baseurl64String.replace(/-/g, '+').replace(/_/g, '/') + padding;\n\n  // Base64 to binary string\n  const str = atob(base64String);\n\n  // Binary string to buffer\n  const buffer = new ArrayBuffer(str.length);\n  const byteView = new Uint8Array(buffer);\n  for (let i = 0; i < str.length; i++) {\n    byteView[i] = str.charCodeAt(i);\n  }\n  return buffer;\n}\n\nexport function bufferToBase64url(buffer: ArrayBuffer): string {\n  // Buffer to binary string\n  const byteView = new Uint8Array(buffer);\n  let str = '';\n  for (const charCode of byteView) {\n    str += String.fromCharCode(charCode);\n  }\n\n  // Binary string to base64\n  const base64String = btoa(str);\n\n  // Base64 to base64url\n  // We assume that the base64url string is well-formed.\n  const base64urlString = base64String\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '');\n  return base64urlString;\n}\n","import * as React from 'react';\nimport * as Sentry from '@sentry/react';\nimport * as cbor from 'cbor-web';\nimport u2f from 'u2f-api';\n\nimport {base64urlToBuffer, bufferToBase64url} from 'sentry/components/u2f/webAuthnHelper';\nimport {t, tct} from 'sentry/locale';\nimport ConfigStore from 'sentry/stores/configStore';\nimport {ChallengeData, Organization} from 'sentry/types';\nimport withOrganization from 'sentry/utils/withOrganization';\n\ntype TapParams = {\n  response: string;\n  challenge: string;\n};\n\ntype Props = {\n  organization: Organization;\n  challengeData: ChallengeData;\n  isWebauthnSigninFFEnabled: boolean;\n  flowMode: string;\n  silentIfUnsupported: boolean;\n  onTap: ({response, challenge}: TapParams) => Promise<void>;\n  style?: React.CSSProperties;\n};\n\ntype State = {\n  responseElement: HTMLInputElement | null;\n  formElement: HTMLFormElement | null;\n  challengeElement: HTMLInputElement | null;\n  isSupported: boolean | null;\n  hasBeenTapped: boolean;\n  deviceFailure: string | null;\n  isSafari: boolean;\n  failCount: number;\n};\n\nclass U2fInterface extends React.Component<Props, State> {\n  state: State = {\n    isSupported: null,\n    formElement: null,\n    challengeElement: null,\n    hasBeenTapped: false,\n    deviceFailure: null,\n    responseElement: null,\n    isSafari: false,\n    failCount: 0,\n  };\n\n  async componentDidMount() {\n    const supported = this.props.isWebauthnSigninFFEnabled\n      ? !!window.PublicKeyCredential\n      : await u2f.isSupported();\n    // eslint-disable-next-line react/no-did-mount-set-state\n    this.setState({isSupported: supported});\n\n    const isSafari =\n      navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome');\n\n    if (isSafari) {\n      // eslint-disable-next-line react/no-did-mount-set-state\n      this.setState({\n        deviceFailure: 'safari: requires interaction',\n        isSafari,\n        hasBeenTapped: false,\n      });\n    }\n\n    if (supported && !isSafari) {\n      this.invokeU2fFlow();\n    }\n  }\n\n  getU2FResponse(data) {\n    if (!data.response) {\n      return JSON.stringify(data);\n    }\n\n    if (this.props.flowMode === 'sign') {\n      const authenticatorData = {\n        keyHandle: data.id,\n        clientData: bufferToBase64url(data.response.clientDataJSON),\n        signatureData: bufferToBase64url(data.response.signature),\n        authenticatorData: bufferToBase64url(data.response.authenticatorData),\n      };\n      return JSON.stringify(authenticatorData);\n    }\n    if (this.props.flowMode === 'enroll') {\n      const authenticatorData = {\n        id: data.id,\n        rawId: bufferToBase64url(data.rawId),\n        response: {\n          attestationObject: bufferToBase64url(data.response.attestationObject),\n          clientDataJSON: bufferToBase64url(data.response.clientDataJSON),\n        },\n        type: bufferToBase64url(data.type),\n      };\n      return JSON.stringify(authenticatorData);\n    }\n\n    throw new Error(`Unsupported flow mode '${this.props.flowMode}'`);\n  }\n\n  submitU2fResponse(promise) {\n    promise\n      .then(data => {\n        this.setState(\n          {\n            hasBeenTapped: true,\n          },\n          () => {\n            const u2fResponse = this.getU2FResponse(data);\n            const challenge = JSON.stringify(this.props.challengeData);\n\n            if (this.state.responseElement) {\n              // eslint-disable-next-line react/no-direct-mutation-state\n              this.state.responseElement.value = u2fResponse;\n            }\n\n            if (!this.props.onTap) {\n              this.state.formElement?.submit();\n              return;\n            }\n\n            this.props\n              .onTap({\n                response: u2fResponse,\n                challenge,\n              })\n              .catch(() => {\n                // This is kind of gross but I want to limit the amount of changes to this component\n                this.setState({\n                  deviceFailure: 'UNKNOWN_ERROR',\n                  hasBeenTapped: false,\n                });\n              });\n          }\n        );\n      })\n      .catch(err => {\n        let failure = 'DEVICE_ERROR';\n        // in some rare cases there is no metadata on the error which\n        // causes this to blow up badly.\n        if (err.metaData) {\n          if (err.metaData.type === 'DEVICE_INELIGIBLE') {\n            if (this.props.flowMode === 'enroll') {\n              failure = 'DUPLICATE_DEVICE';\n            } else {\n              failure = 'UNKNOWN_DEVICE';\n            }\n          } else if (err.metaData.type === 'BAD_REQUEST') {\n            failure = 'BAD_APPID';\n          }\n        }\n        // we want to know what is happening here.  There are some indicators\n        // that users are getting errors that should not happen through the\n        // regular u2f flow.\n        Sentry.captureException(err);\n        this.setState({\n          deviceFailure: failure,\n          hasBeenTapped: false,\n          failCount: this.state.failCount + 1,\n        });\n      });\n  }\n\n  webAuthnSignIn(publicKeyCredentialRequestOptions) {\n    const promise = navigator.credentials.get({\n      publicKey: publicKeyCredentialRequestOptions,\n    });\n    this.submitU2fResponse(promise);\n  }\n\n  webAuthnRegister(publicKey) {\n    const promise = navigator.credentials.create({\n      publicKey,\n    });\n    this.submitU2fResponse(promise);\n  }\n\n  invokeU2fFlow() {\n    let promise: Promise<u2f.SignResponse | u2f.RegisterResponse>;\n    if (this.props.flowMode === 'sign') {\n      if (this.props.isWebauthnSigninFFEnabled) {\n        const challengeArray = base64urlToBuffer(\n          this.props.challengeData.webAuthnAuthenticationData\n        );\n        const challenge = cbor.decodeFirst(challengeArray);\n        challenge\n          .then(data => {\n            this.webAuthnSignIn(data);\n          })\n          .catch(err => {\n            const failure = 'DEVICE_ERROR';\n            Sentry.captureException(err);\n            this.setState({\n              deviceFailure: failure,\n              hasBeenTapped: false,\n            });\n          });\n      } else {\n        promise = u2f.sign(this.props.challengeData.authenticateRequests);\n        this.submitU2fResponse(promise);\n      }\n    } else if (this.props.flowMode === 'enroll') {\n      const {organization} = this.props;\n      if (organization.features.includes('webauthn-register')) {\n        const challengeArray = base64urlToBuffer(\n          this.props.challengeData.webAuthnRegisterData\n        );\n        const challenge = cbor.decodeFirst(challengeArray);\n        // challenge contains a PublicKeyCredentialRequestOptions object for webauthn registration\n        challenge\n          .then(data => {\n            this.webAuthnRegister(data.publicKey);\n          })\n          .catch(err => {\n            const failure = 'DEVICE_ERROR';\n            Sentry.captureException(err);\n            this.setState({\n              deviceFailure: failure,\n              hasBeenTapped: false,\n            });\n          });\n      } else {\n        const {registerRequests, registeredKeys} = this.props.challengeData;\n        promise = u2f.register(registerRequests as any, registeredKeys as any);\n        this.submitU2fResponse(promise);\n      }\n    } else {\n      throw new Error(`Unsupported flow mode '${this.props.flowMode}'`);\n    }\n  }\n\n  onTryAgain = () => {\n    this.setState(\n      {hasBeenTapped: false, deviceFailure: null},\n      () => void this.invokeU2fFlow()\n    );\n  };\n\n  bindChallengeElement: React.RefCallback<HTMLInputElement> = ref => {\n    this.setState({\n      challengeElement: ref,\n      formElement: ref && ref.form,\n    });\n\n    if (ref) {\n      ref.value = JSON.stringify(this.props.challengeData);\n    }\n  };\n\n  bindResponseElement: React.RefCallback<HTMLInputElement> = ref =>\n    this.setState({responseElement: ref});\n\n  renderUnsupported() {\n    return this.props.silentIfUnsupported ? null : (\n      <div className=\"u2f-box\">\n        <div className=\"inner\">\n          <p className=\"error\">\n            {t(\n              `\n             Unfortunately your browser does not support U2F. You need to use\n             a different two-factor method or switch to a browser that supports\n             it (Google Chrome or Microsoft Edge).`\n            )}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  get canTryAgain() {\n    return this.state.deviceFailure !== 'BAD_APPID';\n  }\n\n  renderSafariWebAuthn = () => {\n    return (\n      <a onClick={this.onTryAgain} className=\"btn btn-primary\">\n        {this.props.flowMode === 'enroll'\n          ? t('Enroll with WebAuthn')\n          : t('Sign in with WebAuthn')}\n      </a>\n    );\n  };\n\n  renderFailure = () => {\n    const {deviceFailure} = this.state;\n    const supportMail = ConfigStore.get('supportEmail');\n    const support = supportMail ? (\n      <a href={'mailto:' + supportMail}>{supportMail}</a>\n    ) : (\n      <span>{t('Support')}</span>\n    );\n    if (this.state.isSafari && this.state.failCount === 0) {\n      return this.renderSafariWebAuthn();\n    }\n    return (\n      <div className=\"failure-message\">\n        <div>\n          <strong>{t('Error: ')}</strong>{' '}\n          {\n            {\n              UNKNOWN_ERROR: t('There was an unknown problem, please try again'),\n              DEVICE_ERROR: t('Your U2F device reported an error.'),\n              DUPLICATE_DEVICE: t('This device is already registered with Sentry.'),\n              UNKNOWN_DEVICE: t('The device you used for sign-in is unknown.'),\n              BAD_APPID: tct(\n                '[p1:The Sentry server administrator modified the ' +\n                  'device registrations.]' +\n                  '[p2:You need to remove and re-add the device to continue ' +\n                  'using your U2F device. Use a different sign-in method or ' +\n                  'contact [support] for assistance.]',\n                {\n                  p1: <p />,\n                  p2: <p />,\n                  support,\n                }\n              ),\n            }[deviceFailure || '']\n          }\n        </div>\n        {this.canTryAgain && (\n          <div style={{marginTop: 18}}>\n            <a onClick={this.onTryAgain} className=\"btn btn-primary\">\n              {t('Try Again')}\n            </a>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  renderBody() {\n    return this.state.deviceFailure ? this.renderFailure() : this.props.children;\n  }\n\n  renderPrompt() {\n    const {style} = this.props;\n\n    return (\n      <div\n        style={style}\n        className={\n          'u2f-box' +\n          (this.state.hasBeenTapped ? ' tapped' : '') +\n          (this.state.deviceFailure\n            ? this.state.failCount === 0 && this.state.isSafari\n              ? ' loading-dots'\n              : ' device-failure'\n            : '')\n        }\n      >\n        <div className=\"device-animation-frame\">\n          <div className=\"device-failed\" />\n          <div className=\"device-animation\" />\n          <div className=\"loading-dots\">\n            <span className=\"dot\" />\n            <span className=\"dot\" />\n            <span className=\"dot\" />\n          </div>\n        </div>\n        <input type=\"hidden\" name=\"challenge\" ref={this.bindChallengeElement} />\n        <input type=\"hidden\" name=\"response\" ref={this.bindResponseElement} />\n        <div className=\"inner\">{this.renderBody()}</div>\n      </div>\n    );\n  }\n\n  render() {\n    const {isSupported} = this.state;\n    // if we are still waiting for the browser to tell us if we can do u2f this\n    // will be null.\n    if (isSupported === null) {\n      return null;\n    }\n\n    if (!isSupported) {\n      return this.renderUnsupported();\n    }\n\n    return this.renderPrompt();\n  }\n}\n\nexport default withOrganization(U2fInterface);\n","import {Component} from 'react';\n\nimport {t} from 'sentry/locale';\n\nimport U2fInterface from './u2finterface';\n\nconst MESSAGES = {\n  signin: t(\n    'Insert your U2F device or tap the button on it to confirm the sign-in request.'\n  ),\n  sudo: t('Alternatively you can use your U2F device to confirm the action.'),\n  enroll: t(\n    'To enroll your U2F device insert it now or tap the button on it to activate it.'\n  ),\n};\n\ntype InterfaceProps = React.ComponentProps<typeof U2fInterface>;\n\ntype Props = Omit<InterfaceProps, 'silentIfUnsupported' | 'flowMode'> & {\n  displayMode: 'signin' | 'enroll' | 'sudo';\n};\n\nclass U2fSign extends Component<Props> {\n  static defaultProps = {\n    displayMode: 'signin',\n  };\n\n  render() {\n    const {displayMode, ...props} = this.props;\n    const flowMode = displayMode === 'enroll' ? 'enroll' : 'sign';\n    return (\n      <U2fInterface\n        {...props}\n        silentIfUnsupported={displayMode === 'sudo'}\n        flowMode={flowMode}\n      >\n        <p>{MESSAGES[displayMode] || null}</p>\n      </U2fInterface>\n    );\n  }\n}\n\nexport default U2fSign;\n","import {useEffect, useRef} from 'react';\n\nimport {Client} from 'sentry/api';\n\ntype Options = {\n  /**\n   * Enabling this option will disable clearing in-flight requests when the\n   * component is unmounted.\n   *\n   * This may be useful in situations where your component needs to finish up\n   * somewhere the client was passed into some type of action creator and the\n   * component is unmounted.\n   */\n  persistInFlight?: boolean;\n  /**\n   * An existing API client may be provided.\n   *\n   * This is a continent way to re-use clients and still inherit the\n   * persistInFlight configuration.\n   */\n  api?: Client;\n};\n\n/**\n * Returns an API client that will have it's requests canceled when the owning\n * React component is unmounted (may be disabled via options).\n */\nfunction useApi({persistInFlight, api: providedApi}: Options = {}) {\n  const localApi = useRef<Client>();\n\n  // Lazily construct the client if we weren't provided with one\n  if (localApi.current === undefined && providedApi === undefined) {\n    localApi.current = new Client();\n  }\n\n  // Use the provided client if available\n  const api = providedApi ?? localApi.current!;\n\n  function handleCleanup() {\n    !persistInFlight && api.clear();\n  }\n\n  useEffect(() => handleCleanup, []);\n\n  return api;\n}\n\nexport default useApi;\n","import {Client} from 'sentry/api';\nimport getDisplayName from 'sentry/utils/getDisplayName';\nimport useApi from 'sentry/utils/useApi';\n\ntype InjectedApiProps = {\n  api: Client;\n};\n\ntype WrappedProps<P> = Omit<P, keyof InjectedApiProps> & Partial<InjectedApiProps>;\n\n/**\n * XXX: Prefer useApi if you are wrapping a Function Component!\n *\n * React Higher-Order Component (HoC) that provides \"api\" client when mounted,\n * and clears API requests when component is unmounted.\n *\n * If an `api` prop is provided when the component is invoked it will be passed\n * through.\n */\nconst withApi = <P extends InjectedApiProps>(\n  WrappedComponent: React.ComponentType<P>,\n  options: Parameters<typeof useApi>[0] = {}\n) => {\n  const WithApi: React.FC<WrappedProps<P>> = ({api: propsApi, ...props}) => {\n    const api = useApi({api: propsApi, ...options});\n\n    return <WrappedComponent {...(props as P)} api={api} />;\n  };\n\n  WithApi.displayName = `withApi(${getDisplayName(WrappedComponent)})`;\n\n  return WithApi;\n};\n\nexport default withApi;\n"],"names":["U2fContainer","Component","authenticators","componentDidMount","this","getAuthenticators","api","props","requestPromise","setState","render","className","state","length","map","auth","id","challenge","challengeData","withApi","SudoModal","React","error","busy","closeModal","superuser","location","router","retryRequest","replace","pathname","forceUpdate","Date","then","async","method","data","handleSuccess","err","renderBodyContent","user","ConfigStore","hasPasswordAuth","StyledTextBlock","t","StyledAlert","type","icon","size","apiMethod","apiEndpoint","submitLabel","onSubmitSuccess","onSubmitError","handleError","hideFooter","resetOnError","StyledInputField","inline","label","name","autoFocus","flexibleControlStateSize","displayMode","onTap","handleU2fTap","isWebauthnSigninFFEnabled","priority","href","encodeURIComponent","Header","Body","closeButton","withRouter","TextBlock","space","InputField","Alert","base64urlToBuffer","baseurl64String","padding","slice","base64String","str","atob","buffer","ArrayBuffer","byteView","Uint8Array","i","charCodeAt","bufferToBase64url","charCode","String","fromCharCode","btoa","U2fInterface","isSupported","formElement","challengeElement","hasBeenTapped","deviceFailure","responseElement","isSafari","failCount","invokeU2fFlow","ref","form","value","JSON","stringify","onClick","onTryAgain","flowMode","supportMail","support","renderSafariWebAuthn","UNKNOWN_ERROR","DEVICE_ERROR","DUPLICATE_DEVICE","UNKNOWN_DEVICE","BAD_APPID","tct","p1","p2","canTryAgain","style","marginTop","supported","window","PublicKeyCredential","u2f","navigator","userAgent","includes","getU2FResponse","response","authenticatorData","keyHandle","clientData","clientDataJSON","signatureData","signature","rawId","attestationObject","Error","submitU2fResponse","promise","u2fResponse","catch","submit","failure","metaData","Sentry","webAuthnSignIn","publicKeyCredentialRequestOptions","credentials","get","publicKey","webAuthnRegister","create","challengeArray","webAuthnAuthenticationData","cbor","decodeFirst","authenticateRequests","organization","features","webAuthnRegisterData","registerRequests","registeredKeys","renderUnsupported","silentIfUnsupported","renderBody","renderFailure","children","renderPrompt","bindChallengeElement","bindResponseElement","withOrganization","MESSAGES","signin","sudo","enroll","U2fSign","persistInFlight","providedApi","localApi","useRef","undefined","current","Client","handleCleanup","clear","useEffect","WrappedComponent","options","WithApi","propsApi","useApi","displayName","getDisplayName"],"sourceRoot":""}