"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dashboardsV2_detail_tsx"],{"./app/views/dashboardsV2/data.tsx":(e,t,a)=>{a.d(t,{R7:()=>o,CS:()=>r,L3:()=>n,GY:()=>l});var i=a("./app/locale.tsx"),s=a("./app/utils/guid.tsx"),d=a("./app/views/dashboardsV2/types.tsx");const o={id:"",dateCreated:"",createdBy:void 0,title:(0,i.t)("Untitled dashboard"),widgets:[]},r=[{id:"default-template",dateCreated:"",createdBy:void 0,title:(0,i.t)("Default"),widgets:[{title:(0,i.t)("Number of Errors"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"!event.type:transaction",fields:["count()"],orderby:"count()"}],tempId:(0,s.E)()},{title:(0,i.t)("Number of Issues"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"!event.type:transaction",fields:["count_unique(issue)"],orderby:"count_unique(issue)"}],tempId:(0,s.E)()},{title:(0,i.t)("Events"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Events"),conditions:"!event.type:transaction",fields:["count()"],orderby:"count()"}],tempId:(0,s.E)()},{title:(0,i.t)("Affected Users"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Known Users"),conditions:"has:user.email !event.type:transaction",fields:["count_unique(user)"],orderby:"count_unique(user)"},{name:(0,i.t)("Anonymous Users"),conditions:"!has:user.email !event.type:transaction",fields:["count_unique(user)"],orderby:"count_unique(user)"}],tempId:(0,s.E)()},{title:(0,i.t)("Handled vs. Unhandled"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Handled"),conditions:"error.handled:true",fields:["count()"],orderby:"count()"},{name:(0,i.t)("Unhandled"),conditions:"error.handled:false",fields:["count()"],orderby:"count()"}],tempId:(0,s.E)()},{title:(0,i.t)("Errors by Country"),displayType:d.FO.WORLD_MAP,interval:"5m",queries:[{name:(0,i.t)("Error counts"),conditions:"!event.type:transaction has:geo.country_code",fields:["count()"],orderby:"count()"}],tempId:(0,s.E)()},{title:(0,i.t)("Errors by Browser"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",conditions:"!event.type:transaction has:browser.name",fields:["browser.name","count()"],orderby:"-count"}],tempId:(0,s.E)()}]},{id:"frontend-template",title:(0,i.t)("Frontend"),dateCreated:"",createdBy:void 0,widgets:[{title:(0,i.t)("Overall LCP"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["p75(measurements.lcp)"],orderby:"measurements.lcp"}],tempId:(0,s.E)()},{title:(0,i.t)("Overall FCP"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["p75(measurements.fcp)"],orderby:"measurements.fcp"}],tempId:(0,s.E)()},{title:(0,i.t)("Overall FID"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["p75(measurements.fid)"],orderby:"measurements.fid"}],tempId:(0,s.E)()},{title:(0,i.t)("LCP over time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("LCP"),conditions:"event.type:transaction",fields:["p75(measurements.lcp)"],orderby:"measurements.lcp"}],tempId:(0,s.E)()},{title:(0,i.t)("FCP over time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("FCP"),conditions:"event.type:transaction",fields:["p75(measurements.fcp)"],orderby:"measurements.fcp"}],tempId:(0,s.E)()},{title:(0,i.t)("FID over time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("FID"),conditions:"event.type:transaction",fields:["p75(measurements.fid)"],orderby:"measurements.fid"}],tempId:(0,s.E)()}]},{id:"backend-template",title:(0,i.t)("Backend"),dateCreated:"",createdBy:void 0,widgets:[{title:(0,i.t)("Overall Apdex"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["apdex()"],orderby:"apdex"}],tempId:(0,s.E)()},{title:(0,i.t)("Failing Transactions"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["failure_count()"],orderby:"failure_count"}],tempId:(0,s.E)()},{title:(0,i.t)("Overall Misery"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",conditions:"event.type:transaction",fields:["user_misery()"],orderby:"user_misery"}],tempId:(0,s.E)()},{title:(0,i.t)("Apdex over time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Apdex"),conditions:"event.type:transaction",fields:["apdex()"],orderby:"apdex"}],tempId:(0,s.E)()},{title:(0,i.t)("Failure Transactions over time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Failing Transactions"),conditions:"event.type:transaction",fields:["failure_count()"],orderby:"failure_count"}],tempId:(0,s.E)()},{title:(0,i.t)("Misery over time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Miserable Users"),conditions:"event.type:transaction",fields:["user_misery()"],orderby:"user_misery"}],tempId:(0,s.E)()}]},{id:"mobile-template",title:(0,i.t)("Mobile"),dateCreated:"",createdBy:void 0,widgets:[{title:(0,i.t)("Total Crashes"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count()"],conditions:"error.handled:false event.type:error",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Unique Users Who Crashed"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count_unique(user)"],conditions:"error.handled:false event.type:error",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Overall Number of Errors"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["count()"],conditions:"event.type:error",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Issues Causing Crashes"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["issue","count()","count_unique(user)"],conditions:"error.handled:false",orderby:"-count_unique_user"}],tempId:(0,s.E)()},{title:(0,i.t)("Crashes Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:(0,i.t)("Crashes"),fields:["count()","count_unique(user)"],conditions:"error.handled:false",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Crashes by OS"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["os","count()"],conditions:"has:os error.handled:false",orderby:"-count"}],tempId:(0,s.E)()},{title:(0,i.t)("Overall Warm Startup Time"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.app_start_warm)"],conditions:"has:measurements.app_start_warm",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Overall Cold Startup Time"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.app_start_cold)"],conditions:"has:measurements.app_start_cold",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Overall Throughput"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["epm()"],conditions:"",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Warm Startup Times"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","p75(measurements.app_start_warm)"],conditions:"has:measurements.app_start_warm",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Cold Startup Times"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","p75(measurements.app_start_cold)"],conditions:"has:measurements.app_start_cold",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Throughput Over Time"),displayType:d.FO.LINE,interval:"5m",queries:[{name:"",fields:["epm()"],conditions:"",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Frozen Frames Over Time"),displayType:d.FO.BIG_NUMBER,interval:"5m",queries:[{name:"",fields:["p75(measurements.frames_frozen_rate)"],conditions:"",orderby:""}],tempId:(0,s.E)()},{title:(0,i.t)("Frozen Frames Rate"),displayType:d.FO.TABLE,interval:"5m",queries:[{name:"",fields:["transaction","p75(measurements.frames_frozen_rate)"],conditions:"has:measurements.frames_frozen_rate",orderby:"-p75_measurements_frames_frozen_rate"}],tempId:(0,s.E)()}]}],n=[{label:(0,i.t)("Area Chart"),value:"area"},{label:(0,i.t)("Bar Chart"),value:"bar"},{label:(0,i.t)("Line Chart"),value:"line"},{label:(0,i.t)("Table"),value:"table"},{label:(0,i.t)("World Map"),value:"world_map"},{label:(0,i.t)("Big Number"),value:"big_number"},{label:(0,i.t)("Top 5 Events"),value:"top_n"}],l=((0,i.t)("1 Minute"),(0,i.t)("5 Minutes"),(0,i.t)("15 Minutes"),(0,i.t)("30 Minutes"),(0,i.t)("1 Hour"),(0,i.t)("1 Day"),"24h")},"./app/views/dashboardsV2/detail.tsx":(e,t,a)=>{a.d(t,{Z:()=>$});var i=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),d=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/core-js/modules/es.string.replace.js"),a("../node_modules/react/index.js")),o=a("../node_modules/react-router/es/index.js"),r=a("../node_modules/lodash/isEqual.js"),n=a.n(r),l=a("./app/actionCreators/dashboards.tsx"),p=a("./app/actionCreators/indicator.tsx"),h=a("./app/actionCreators/modal.tsx"),c=a("./app/components/breadcrumbs.tsx"),u=a("./app/components/hookOrDefault.tsx"),m=a("./app/components/layouts/thirds.tsx"),b=a("./app/components/noProjectMessage.tsx"),g=a("./app/components/organizations/pageFilters/container.tsx"),y=a("./app/locale.tsx"),v=a("./app/styles/organization.tsx"),E=a("./app/styles/space.tsx"),f=a("./app/utils/analytics.tsx"),w=a("./app/utils/withApi.tsx"),D=a("./app/utils/withOrganization.tsx"),I=a("./app/utils/localStorage.tsx");const _=(e,t)=>"grid-layout-".concat(e,"-").concat(t),Z=(e,t)=>{const a=I.Z.getItem(_(e,t));return a?JSON.parse(a):[]},T=(e,t,a)=>{I.Z.setItem(_(e,t),JSON.stringify(a))};var B=a("./app/components/acl/feature.tsx"),C=a("./app/components/acl/featureDisabled.tsx"),W=a("./app/components/button.tsx"),S=a("./app/components/buttonBar.tsx"),L=a("./app/components/confirm.tsx"),x=a("./app/components/hovercard.tsx"),U=a("./app/components/tooltip.tsx"),z=a("./app/icons/index.tsx"),N=a("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),q=a("./app/views/dashboardsV2/types.tsx"),R=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class F extends d.Component{renderCancelButton(e=(0,y.t)("Cancel")){const{onCancel:t}=this.props;return(0,R.tZ)(W.ZP,{"data-test-id":"dashboard-cancel",onClick:e=>{e.preventDefault(),t()},children:e})}render(){const{organization:e,dashboardState:t,dashboards:a,widgetLimitReached:i,onEdit:s,onCommit:o,onDelete:r,onAddWidget:n}=this.props;return[q.n3.EDIT,q.n3.PENDING_DELETE].includes(t)?(0,R.BX)(A,{gap:1,children:[this.renderCancelButton(),(0,R.tZ)(L.Z,{priority:"danger",message:(0,y.t)("Are you sure you want to delete this dashboard?"),onConfirm:r,disabled:a.length<=1,children:(0,R.tZ)(W.ZP,{"data-test-id":"dashboard-delete",priority:"danger",children:(0,y.t)("Delete")})}),(0,R.tZ)(W.ZP,{"data-test-id":"dashboard-commit",onClick:e=>{e.preventDefault(),o()},priority:"primary",children:(0,y.t)("Save and Finish")})]},"edit-controls"):t===q.n3.CREATE?(0,R.BX)(A,{gap:1,children:[this.renderCancelButton(),(0,R.tZ)(W.ZP,{"data-test-id":"dashboard-commit",onClick:e=>{e.preventDefault(),o()},priority:"primary",children:(0,y.t)("Save and Finish")})]},"create-controls"):t===q.n3.PREVIEW?(0,R.BX)(A,{gap:1,children:[this.renderCancelButton((0,y.t)("Go Back")),(0,R.tZ)(W.ZP,{"data-test-id":"dashboard-commit",onClick:e=>{e.preventDefault(),o()},priority:"primary",children:(0,y.t)("Add Dashboard")})]},"preview-controls"):(0,R.tZ)(A,{gap:1,children:(0,R.tZ)(O,{children:t=>(0,R.BX)(d.Fragment,{children:[(0,R.tZ)(W.ZP,{"data-test-id":"dashboard-edit",onClick:e=>{e.preventDefault(),s()},icon:(0,R.tZ)(z.yl,{size:"xs"}),disabled:!t,priority:e.features.includes("widget-library")?"default":"primary",children:(0,y.t)("Edit Dashboard")}),e.features.includes("widget-library")&&t?(0,R.tZ)(U.Z,{title:(0,y._N)("Max widgets ([maxWidgets]) per dashboard reached.",{maxWidgets:q.ZU}),disabled:!i,children:(0,R.tZ)(W.ZP,{"data-test-id":"add-widget-library",priority:"primary",disabled:i,icon:(0,R.tZ)(z.N_,{isCircled:!0}),onClick:()=>{(0,N.Z)("dashboards_views.widget_library.opened",{organization:e}),n()},children:(0,y.t)("Add Widget")})}):null]})})},"controls")}}F.displayName="Controls";const O=({children:e})=>{const t=(0,y.t)("Requires dashboard editing.");return(0,R.tZ)(B.Z,{hookName:"feature-disabled:dashboards-edit",features:["organizations:dashboards-edit"],renderDisabled:e=>(0,R.tZ)(x.ZP,{body:(0,R.tZ)(C.Z,{features:e.features,hideHelpToggle:!0,message:t,featureName:t}),children:e.children(e)}),children:({hasFeature:t})=>e(t)})};O.displayName="DashboardEditFeature";const A=(0,s.Z)(S.ZP,{target:"e78awt50"})("@media (max-width: ",(e=>e.theme.breakpoints[0]),"){grid-auto-flow:row;grid-row-gap:",(0,E.Z)(1),";width:100%;}"),P=F;var M=a("./app/views/dashboardsV2/dashboard.tsx"),k=a("./app/views/dashboardsV2/data.tsx"),G=a("./app/components/editableText.tsx");function V({dashboard:e,isEditing:t,organization:a,onUpdate:i}){return(0,R.tZ)("div",{children:e?(0,R.tZ)(G.Z,{isDisabled:!t,value:a.features.includes("dashboards-edit")&&"default-overview"===e.id?"Default Dashboard":e.title,onChange:t=>i({...e,title:t}),errorMessage:(0,y.t)("Please set a title for this dashboard")}):(0,y.t)("Dashboards")})}V.displayName="DashboardTitle";const j=(0,D.Z)(V);var H=a("./app/views/dashboardsV2/utils.tsx");const X=(0,y.t)("You have unsaved changes, are you sure you want to leave?"),Y=(0,u.Z)({hookName:"component:dashboards-header"});class K extends d.Component{constructor(...e){super(...e),(0,i.Z)(this,"state",{dashboardState:this.props.initialState,modifiedDashboard:this.updateModifiedDashboard(this.props.initialState),layout:Z(this.props.organization.id,this.props.dashboard.id),widgetLimitReached:this.props.dashboard.widgets.length>=q.ZU}),(0,i.Z)(this,"onEdit",(()=>{const{dashboard:e}=this.props;(0,f.ec)({eventKey:"dashboards2.edit.start",eventName:"Dashboards2: Edit start",organization_id:parseInt(this.props.organization.id,10)}),this.setState({dashboardState:q.n3.EDIT,modifiedDashboard:(0,H.qk)(e)})})),(0,i.Z)(this,"onRouteLeave",(()=>{const{dashboard:e}=this.props,{modifiedDashboard:t}=this.state;if(![q.n3.VIEW,q.n3.PENDING_DELETE].includes(this.state.dashboardState)&&!n()(t,e))return X})),(0,i.Z)(this,"onUnload",(e=>{const{dashboard:t}=this.props,{modifiedDashboard:a}=this.state;[q.n3.VIEW,q.n3.PENDING_DELETE].includes(this.state.dashboardState)||n()(a,t)||(e.preventDefault(),e.returnValue=X)})),(0,i.Z)(this,"onDelete",(e=>()=>{const{api:t,organization:a,location:i}=this.props;if(null==e||!e.id)return;const s=this.state.dashboardState;this.setState({dashboardState:q.n3.PENDING_DELETE},(()=>{(0,l.iM)(t,a.slug,e.id).then((()=>{(0,p.S9)((0,y.t)("Dashboard deleted")),(0,f.ec)({eventKey:"dashboards2.delete",eventName:"Dashboards2: Delete",organization_id:parseInt(this.props.organization.id,10)}),o.browserHistory.replace({pathname:"/organizations/".concat(a.slug,"/dashboards/"),query:i.query})})).catch((()=>{this.setState({dashboardState:s})}))}))})),(0,i.Z)(this,"onCancel",(()=>{const{organization:e,dashboard:t,location:a,params:i}=this.props,{modifiedDashboard:s}=this.state;if(n()(s,t)||confirm(X)){if(i.dashboardId)return(0,f.ec)({eventKey:"dashboards2.edit.cancel",eventName:"Dashboards2: Edit cancel",organization_id:parseInt(this.props.organization.id,10)}),void this.setState({dashboardState:q.n3.VIEW,modifiedDashboard:null,layout:Z(e.id,t.id)});(0,f.ec)({eventKey:"dashboards2.create.cancel",eventName:"Dashboards2: Create cancel",organization_id:parseInt(this.props.organization.id,10)}),o.browserHistory.replace({pathname:"/organizations/".concat(e.slug,"/dashboards/"),query:a.query})}})),(0,i.Z)(this,"handleUpdateWidgetList",(e=>{const{organization:t,dashboard:a,api:i,onDashboardUpdate:s,location:d}=this.props,{modifiedDashboard:r}=this.state,n={...(0,H.qk)(r||a),widgets:e.map(M.TE)};this.setState({modifiedDashboard:n,widgetLimitReached:e.length>=q.ZU}),this.isEditing||this.isPreview||(0,l.Y)(i,t.slug,n).then((e=>{s&&s(e),(0,p.S9)((0,y.t)("Dashboard updated")),a&&e.id!==a.id&&o.browserHistory.replace({pathname:"/organizations/".concat(t.slug,"/dashboard/").concat(e.id,"/"),query:{...d.query}})}),(()=>{}))})),(0,i.Z)(this,"handleAddCustomWidget",(e=>{const{dashboard:t}=this.props,{modifiedDashboard:a}=this.state,i=a||t;let s=e;this.props.organization.features.includes("dashboard-grid-layout")&&(s=(0,M.TE)(e)),this.onUpdateWidget([...i.widgets,s])})),(0,i.Z)(this,"onAddWidget",(()=>{const{organization:e,dashboard:t}=this.props;this.setState({modifiedDashboard:(0,H.qk)(t)}),(0,h.openAddDashboardWidgetModal)({organization:e,dashboard:t,onAddLibraryWidget:e=>this.handleUpdateWidgetList(e),source:q.EN.LIBRARY})})),(0,i.Z)(this,"saveLayoutWithNewWidgets",((e,t,a)=>{const{layout:i}=this.state;if(i.length>a.length)throw new Error("Expected layouts to have less length than widgets");const s=i.map(((e,t)=>({...e,i:(0,M.Yb)(a[t])})));return T(e,t,s),s})),(0,i.Z)(this,"onCommit",(()=>{const{api:e,organization:t,location:a,dashboard:i,onDashboardUpdate:s}=this.props,{layout:d,modifiedDashboard:r,dashboardState:h}=this.state;switch(h){case q.n3.PREVIEW:case q.n3.CREATE:r&&(0,l.JR)(e,t.slug,r,this.isPreview).then((e=>{t.features.includes("dashboard-grid-layout")&&this.saveLayoutWithNewWidgets(t.id,e.id,e.widgets),(0,p.S9)((0,y.t)("Dashboard created")),(0,f.ec)({eventKey:"dashboards2.create.complete",eventName:"Dashboards2: Create complete",organization_id:parseInt(t.id,10)}),this.setState({dashboardState:q.n3.VIEW}),o.browserHistory.replace({pathname:"/organizations/".concat(t.slug,"/dashboard/").concat(e.id,"/"),query:{...a.query}})}),(()=>{}));break;case q.n3.EDIT:if(t.features.includes("dashboard-grid-layout")&&T(t.id,i.id,d),r)return n()(i,r)?void this.setState({dashboardState:q.n3.VIEW,modifiedDashboard:null}):void(0,l.Y)(e,t.slug,r).then((e=>{var r;let n;s&&s(e),t.features.includes("dashboard-grid-layout")&&(n=this.saveLayoutWithNewWidgets(t.id,e.id,e.widgets)),(0,p.S9)((0,y.t)("Dashboard updated")),(0,f.ec)({eventKey:"dashboards2.edit.complete",eventName:"Dashboards2: Edit complete",organization_id:parseInt(t.id,10)}),this.setState({dashboardState:q.n3.VIEW,modifiedDashboard:null,layout:null!==(r=n)&&void 0!==r?r:d}),i&&e.id!==i.id&&o.browserHistory.replace({pathname:"/organizations/".concat(t.slug,"/dashboard/").concat(e.id,"/"),query:{...a.query}})}),(()=>{}));this.setState({dashboardState:q.n3.VIEW,modifiedDashboard:null});break;case q.n3.VIEW:default:this.setState({dashboardState:q.n3.VIEW,modifiedDashboard:null})}})),(0,i.Z)(this,"setModifiedDashboard",(e=>{this.setState({modifiedDashboard:e})})),(0,i.Z)(this,"onSetWidgetToBeUpdated",(e=>{this.setState({widgetToBeUpdated:e})})),(0,i.Z)(this,"onLayoutChange",(e=>{this.setState({layout:e})})),(0,i.Z)(this,"onUpdateWidget",(e=>{this.setState((t=>({...t,widgetToBeUpdated:void 0,widgetLimitReached:e.length>=q.ZU,modifiedDashboard:{...t.modifiedDashboard||this.props.dashboard,widgets:e}})),this.updateRouteAfterSavingWidget)}))}componentDidMount(){const{route:e,router:t}=this.props;this.checkStateRoute(),t.setRouteLeaveHook(e,this.onRouteLeave),window.addEventListener("beforeunload",this.onUnload)}componentDidUpdate(e){e.location.pathname!==this.props.location.pathname&&this.checkStateRoute()}componentWillUnmount(){window.removeEventListener("beforeunload",this.onUnload)}checkStateRoute(){const{router:e,organization:t,params:a}=this.props,{dashboardId:i}=a,s="/organizations/".concat(t.slug,"/dashboard/").concat(i,"/");this.isWidgetBuilderRouter&&!this.isEditing&&e.replace(s),location.pathname===s&&this.state.widgetToBeUpdated&&this.onSetWidgetToBeUpdated(void 0)}updateRouteAfterSavingWidget(){if(this.isWidgetBuilderRouter){const{router:e,organization:t,params:a}=this.props,{dashboardId:i}=a;if(i)return void e.replace("/organizations/".concat(t.slug,"/dashboard/").concat(i,"/"));e.replace("/organizations/".concat(t.slug,"/dashboards/new/"))}}updateModifiedDashboard(e){const{dashboard:t}=this.props;switch(e){case q.n3.PREVIEW:case q.n3.CREATE:case q.n3.EDIT:return(0,H.qk)(t);default:return null}}get isPreview(){const{dashboardState:e}=this.state;return q.n3.PREVIEW===e}get isEditing(){const{dashboardState:e}=this.state;return[q.n3.EDIT,q.n3.CREATE,q.n3.PENDING_DELETE].includes(e)}get isWidgetBuilderRouter(){const{location:e,params:t,organization:a}=this.props,{dashboardId:i}=t;return["/organizations/".concat(a.slug,"/dashboards/new/widget/new/"),"/organizations/".concat(a.slug,"/dashboard/").concat(i,"/widget/new/")].includes(e.pathname)||this.isWidgetBuilderEditRouter}get isWidgetBuilderEditRouter(){const{location:e,params:t,organization:a}=this.props,{dashboardId:i,widgetId:s}=t;return["/organizations/".concat(a.slug,"/dashboards/new/widget/").concat(s,"/edit/"),"/organizations/".concat(a.slug,"/dashboard/").concat(i,"/widget/").concat(s,"/edit/")].includes(e.pathname)}get dashboardTitle(){const{dashboard:e}=this.props,{modifiedDashboard:t}=this.state;return t?t.title:e.title}renderWidgetBuilder(e){const{children:t}=this.props,{modifiedDashboard:a,widgetToBeUpdated:i}=this.state;return(0,d.isValidElement)(t)?(0,d.cloneElement)(t,{dashboard:null!=a?a:e,onSave:this.onUpdateWidget,widget:i}):t}renderDefaultDashboardDetail(){const{organization:e,dashboard:t,dashboards:a,params:i,router:s,location:d}=this.props,{layout:o,modifiedDashboard:r,dashboardState:n,widgetLimitReached:l}=this.state,{dashboardId:p}=i;return(0,R.tZ)(g.Z,{skipLoadLastUsed:e.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:k.GY}},children:(0,R.tZ)(v.JH,{children:(0,R.BX)(b.Z,{organization:e,children:[(0,R.BX)(J,{children:[(0,R.tZ)(j,{dashboard:null!=r?r:t,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing}),(0,R.tZ)(P,{organization:e,dashboards:a,onEdit:this.onEdit,onCancel:this.onCancel,onCommit:this.onCommit,onAddWidget:this.onAddWidget,onDelete:this.onDelete(t),dashboardState:n,widgetLimitReached:l})]}),(0,R.tZ)(Y,{organization:e}),(0,R.tZ)(M.ZP,{paramDashboardId:p,dashboard:null!=r?r:t,organization:e,isEditing:this.isEditing,widgetLimitReached:l,onUpdate:this.onUpdateWidget,onSetWidgetToBeUpdated:this.onSetWidgetToBeUpdated,handleUpdateWidgetList:this.handleUpdateWidgetList,handleAddCustomWidget:this.handleAddCustomWidget,isPreview:this.isPreview,router:s,location:d,layout:o,onLayoutChange:this.onLayoutChange})]})})})}getBreadcrumbLabel(){const{organization:e,dashboard:t}=this.props,{dashboardState:a}=this.state;let i=this.dashboardTitle;return a===q.n3.CREATE?i=(0,y.t)("Create Dashboard"):this.isPreview?i=(0,y.t)("Preview Dashboard"):e.features.includes("dashboards-edit")&&"default-overview"===t.id&&(i=(0,y.t)("Default Dashboard")),i}renderDashboardDetail(){const{organization:e,dashboard:t,dashboards:a,params:i,router:s,location:d,newWidget:o}=this.props,{layout:r,modifiedDashboard:n,dashboardState:l,widgetLimitReached:p}=this.state,{dashboardId:h}=i;return(0,R.tZ)(g.Z,{skipLoadLastUsed:e.features.includes("global-views"),defaultSelection:{datetime:{start:null,end:null,utc:!1,period:k.GY}},children:(0,R.tZ)(Q,{children:(0,R.BX)(b.Z,{organization:e,children:[(0,R.BX)(m.h4,{children:[(0,R.BX)(m.oB,{children:[(0,R.tZ)(c.Z,{crumbs:[{label:(0,y.t)("Dashboards"),to:"/organizations/".concat(e.slug,"/dashboards/")},{label:this.getBreadcrumbLabel()}]}),(0,R.tZ)(m.Dx,{children:(0,R.tZ)(j,{dashboard:null!=n?n:t,onUpdate:this.setModifiedDashboard,isEditing:this.isEditing})})]}),(0,R.tZ)(m.kP,{children:(0,R.tZ)(P,{organization:e,dashboards:a,onEdit:this.onEdit,onCancel:this.onCancel,onCommit:this.onCommit,onAddWidget:this.onAddWidget,onDelete:this.onDelete(t),dashboardState:l,widgetLimitReached:p})})]}),(0,R.tZ)(m.uT,{children:(0,R.tZ)(m.or,{fullWidth:!0,children:(0,R.tZ)(M.ZP,{paramDashboardId:h,dashboard:null!=n?n:t,organization:e,isEditing:this.isEditing,widgetLimitReached:p,onUpdate:this.onUpdateWidget,handleUpdateWidgetList:this.handleUpdateWidgetList,handleAddCustomWidget:this.handleAddCustomWidget,onSetWidgetToBeUpdated:this.onSetWidgetToBeUpdated,router:s,location:d,newWidget:o,layout:r,onLayoutChange:this.onLayoutChange,isPreview:this.isPreview})})})]})})})}render(){const{organization:e,dashboard:t}=this.props;return this.isEditing&&this.isWidgetBuilderRouter?this.renderWidgetBuilder(t):e.features.includes("dashboards-edit")?this.renderDashboardDetail():this.renderDefaultDashboardDetail()}}K.displayName="DashboardDetail";const J=(0,s.Z)("div",{target:"e1anno2f1"})("display:grid;grid-template-columns:minmax(0, 1fr);grid-row-gap:",(0,E.Z)(2),";align-items:center;font-size:",(e=>e.theme.headerFontSize),";color:",(e=>e.theme.textColor),";margin-bottom:",(0,E.Z)(2),";@media (min-width: ",(e=>e.theme.breakpoints[1]),"){grid-template-columns:minmax(0, 1fr) max-content;grid-column-gap:",(0,E.Z)(2),";height:40px;}"),Q=(0,s.Z)(v.JH,{target:"e1anno2f0"})({name:"1hcx8jb",styles:"padding:0"}),$=(0,w.Z)((0,D.Z)(K))}}]);
//# sourceMappingURL=../sourcemaps/app_views_dashboardsV2_detail_tsx.0d84d295c04a55851d203759372cc285.js.map