"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_organizationStats_index_tsx"],{"./app/components/gridEditable/sortLink.tsx":(t,e,a)=>{a.d(e,{Z:()=>m});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=a("../node_modules/react/index.js"),o=a("../node_modules/lodash/omit.js"),s=a.n(o),i=a("./app/components/links/link.tsx"),c=a("./app/icons/index.tsx"),l=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class d extends n.Component{renderArrow(){const{direction:t}=this.props;return t?"desc"===t?(0,l.tZ)(u,{size:"xs",direction:"down"}):(0,l.tZ)(u,{size:"xs",direction:"up"}):null}render(){const{align:t,title:e,canSort:a,generateSortLink:r,onClick:n}=this.props,o=r();return o&&a?(0,l.BX)(p,{align:t,to:o,onClick:n,children:[e," ",this.renderArrow()]}):(0,l.tZ)(h,{align:t,children:e})}}d.displayName="SortLink";const p=(0,r.Z)((t=>{const e=s()(t,["align"]);return(0,l.tZ)(i.Z,{...e})}),{target:"e1xb2te62"})("display:block;width:100%;white-space:nowrap;color:inherit;&:hover,&:active,&:focus,&:visited{color:inherit;}",(t=>t.align?"text-align: ".concat(t.align,";"):""),";"),h=(0,r.Z)("div",{target:"e1xb2te61"})("display:block;width:100%;white-space:nowrap;",(t=>t.align?"text-align: ".concat(t.align,";"):""),";"),u=(0,r.Z)(c.CC,{target:"e1xb2te60"})({name:"40f4ru",styles:"vertical-align:top"}),m=d},"./app/components/notAvailable.tsx":(t,e,a)=>{a.d(e,{Z:()=>l});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(a("../node_modules/react/index.js"),a("./app/components/tooltip.tsx")),o=a("./app/utils.tsx"),s=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i({tooltip:t,className:e}){return(0,s.tZ)(c,{className:e,children:(0,s.tZ)(n.Z,{title:t,disabled:!(0,o.ri)(t),children:"—"})})}i.displayName="NotAvailable";const c=(0,r.Z)("div",{target:"e1ickyb10"})("color:",(t=>t.theme.gray200),";"),l=i},"./app/components/pageTimeRangeSelector.tsx":(t,e,a)=>{a.d(e,{Z:()=>m});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/react/index.js")),o=a("./app/components/organizations/timeRangeSelector/index.tsx"),s=a("./app/components/panels/index.tsx"),i=a("./app/constants/index.tsx"),c=a("./app/locale.tsx"),l=a("./app/styles/space.tsx"),d=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p({className:t,...e}){const[a,r]=(0,n.useState)(!1);return(0,d.tZ)(h,{className:t,isCalendarOpen:a,children:(0,d.tZ)(o.Z,{label:(0,d.tZ)(u,{children:(0,c.t)("Date Range:")}),onToggleSelector:t=>r(t),relativeOptions:i.wh,...e},"period:".concat(e.relative,"-start:").concat(e.start,"-end:").concat(e.end,"-utc:").concat(e.utc,"-defaultPeriod:").concat(e.defaultPeriod))})}p.displayName="PageTimeRangeSelector";const h=(0,r.Z)(s.s_,{target:"e1hsuxgy1"})("display:flex;justify-content:center;align-items:center;height:42px;background:",(t=>t.theme.background),";border:1px solid ",(t=>t.theme.border),";border-radius:",(t=>t.isCalendarOpen?"".concat(t.theme.borderRadius," ").concat(t.theme.borderRadius," 0 0"):t.theme.borderRadius),";padding:0;margin:0;font-size:",(t=>t.theme.fontSizeMedium),";color:",(t=>t.theme.textColor),";>div{width:100%;align-self:stretch;}>div>div:first-child{padding:0 ",(0,l.Z)(2),";}>div>div:last-child{box-sizing:content-box;font-size:1em;}"),u=(0,r.Z)("span",{target:"e1hsuxgy0"})("text-align:left;font-weight:600;color:",(t=>t.theme.textColor),";>span:last-child{font-weight:400;}"),m=p},"./app/components/scoreCard.tsx":(t,e,a)=>{a.d(e,{zt:()=>u,Gh:()=>m,Zh:()=>y,BE:()=>x,UR:()=>f,ZP:()=>v});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(a("../node_modules/react/index.js"),a("./app/components/panels/index.tsx")),o=a("./app/components/questionTooltip.tsx"),s=a("./app/components/textOverflow.tsx"),i=a("./app/styles/overflowEllipsis.tsx"),c=a("./app/styles/space.tsx"),l=a("./app/utils.tsx"),d=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p({title:t,score:e,help:a,trend:r,trendStatus:n,className:i}){return(0,d.BX)(u,{className:i,children:[(0,d.BX)(m,{children:[(0,d.tZ)(g,{children:t}),a&&(0,d.tZ)(o.Z,{title:a,size:"sm",position:"top"})]}),(0,d.BX)(y,{children:[(0,d.tZ)(x,{children:null!=e?e:"—"}),(0,l.ri)(r)&&(0,d.tZ)(f,{trendStatus:n,children:(0,d.tZ)(s.Z,{children:r})})]})]})}function h(t){switch(t.trendStatus){case"good":return t.theme.green300;case"bad":return t.theme.red300;default:return t.theme.gray300}}p.displayName="ScoreCard";const u=(0,r.Z)(n.s_,{target:"e179ouq55"})("display:flex;flex-direction:column;justify-content:space-between;padding:",(0,c.Z)(2)," ",(0,c.Z)(3),";min-height:96px;"),m=(0,r.Z)("div",{target:"e179ouq54"})("display:inline-grid;grid-auto-flow:column;gap:",(0,c.Z)(1),";align-items:center;width:fit-content;"),g=(0,r.Z)("div",{target:"e179ouq53"})(i.Z,";"),y=(0,r.Z)("div",{target:"e179ouq52"})({name:"ph5vh8",styles:"display:flex;flex-direction:row;align-items:flex-end;max-width:100%"}),x=(0,r.Z)("span",{target:"e179ouq51"})({name:"1ev0dst",styles:"flex-shrink:1;font-size:32px;line-height:1;white-space:nowrap"}),f=(0,r.Z)("div",{target:"e179ouq50"})("color:",h,";margin-left:",(0,c.Z)(1),";line-height:1;overflow:hidden;"),v=p},"./app/views/organizationStats/header.tsx":(t,e,a)=>{a.d(e,{Z:()=>h});var r=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=a("./app/components/button.tsx"),o=a("./app/components/featureBadge.tsx"),s=a("./app/components/layouts/thirds.tsx"),i=a("./app/components/links/link.tsx"),c=a("./app/locale.tsx"),l=a("./app/styles/space.tsx"),d=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p({organization:t,activeTab:e}){return(0,d.BX)(s.h4,{children:[(0,d.tZ)(s.oB,{children:(0,d.tZ)(u,{children:(0,c.t)("Stats")})}),(0,d.tZ)(s.kP,{children:"team"===e&&(0,d.tZ)(n.ZP,{title:(0,c.t)("Send us feedback via email"),size:"small",href:"mailto:workflow-feedback@sentry.io?subject=Team Stats Feedback",children:(0,c.t)("Give Feedback")})}),(0,d.BX)(s.mL,{underlined:!0,children:[(0,d.tZ)("li",{className:"".concat("stats"===e?"active":""),children:(0,d.tZ)(i.Z,{to:"/organizations/".concat(t.slug,"/stats/"),children:(0,c.t)("Usage Stats")})}),(0,d.tZ)("li",{className:"".concat("team"===e?"active":""),children:(0,d.BX)(i.Z,{to:"/organizations/".concat(t.slug,"/stats/team/"),children:[(0,c.t)("Team Stats"),(0,d.tZ)(o.Z,{type:"beta"})]})})]})]})}p.displayName="StatsHeader";const h=p,u=(0,r.Z)(s.Dx,{target:"e8yr0f60"})("margin-top:",(0,l.Z)(.5),";")},"./app/views/organizationStats/index.tsx":(t,e,a)=>{a.r(e),a.d(e,{OrganizationStats:()=>$t,default:()=>te});var r=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(a("../node_modules/core-js/modules/web.dom-collections.iterator.js"),a("../node_modules/react/index.js")),s=a("../node_modules/lodash/omit.js"),i=a.n(s),c=a("../node_modules/lodash/pick.js"),l=a.n(c),d=a("../node_modules/moment/moment.js"),p=a.n(d),h=a("./app/components/dropdownControl.tsx"),u=a("./app/components/errorBoundary.tsx"),m=a("./app/components/hookOrDefault.tsx"),g=a("./app/components/layouts/thirds.tsx"),y=a("./app/components/organizations/pageFilters/parse.tsx"),x=a("./app/components/pageHeading.tsx"),f=a("./app/components/pageTimeRangeSelector.tsx"),v=a("./app/components/sentryDocumentTitle.tsx"),D=a("./app/constants/index.tsx"),C=a("./app/locale.tsx"),b=a("./app/styles/organization.tsx"),E=a("./app/styles/space.tsx"),Z=a("./app/types/index.tsx"),T=a("./app/utils/withOrganization.tsx"),S=a("./app/views/organizationStats/header.tsx"),A=a("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),P=a("../node_modules/color/index.js"),L=a.n(P),w=a("./app/components/charts/baseChart.tsx"),k=a("./app/components/charts/components/legend.tsx"),R=a("./app/components/charts/components/xAxis.tsx"),j=a("./app/components/charts/series/barSeries.tsx"),I=a("./app/components/charts/styles.tsx"),O=a("./app/components/loadingIndicator.tsx"),z=a("./app/components/panels/panel.tsx"),N=a("./app/components/placeholder.tsx"),_=a("./app/icons/index.tsx"),U=a("./app/utils/dates.tsx"),M=a("./app/utils/formatters.tsx"),F=a("./app/utils/getDynamicText.tsx"),q=a("./app/utils/theme.tsx"),B=a("./app/components/charts/utils.tsx"),X=a("./app/utils.tsx");const H=10**6,J=10**9;function V(t=0,e,a={isAbbreviated:!1,useUnitScaling:!1}){if(e!==Z.cn.ATTACHMENTS)return a.isAbbreviated?G(t):t.toLocaleString();if(a.useUnitScaling)return(0,X.E9)(t);const r=t/1e9;return a.isAbbreviated?"".concat(G(r)," GB"):"".concat(r.toLocaleString(void 0,{maximumFractionDigits:2})," GB")}function Q(t){return{isAbbreviated:t!==Z.cn.ATTACHMENTS,useUnitScaling:t===Z.cn.ATTACHMENTS}}function G(t){return t>=J?(t/J).toLocaleString(void 0,{maximumFractionDigits:2})+"B":t>=H?(t/H).toLocaleString(void 0,{maximumFractionDigits:1})+"M":t>=1e3?(t/1e3).toFixed().toLocaleString()+"K":t.toFixed().toLocaleString()}const Y="MMM D",W="MMM D LT";function K(t,e="1d",a=!1){if((0,U.YJ)(e)/24>=1)return a?p().utc(t).format(Y):t.format(Y);const r=(0,y.su)(e),n=a?p()(t).utc():p()(t).local();return r?"".concat(n.format(W)," - ").concat(n.add(r.period,r.periodLength).format("LT (Z)")):n.format(W)}function $(t,e,a=!1,r="1d"){var n;const o=[],s=p()(t).startOf("h"),i=p()(e).startOf("h");if(!s.isValid()||!i.isValid())return o;const{period:c,periodLength:l}=null!==(n=(0,y.su)(r))&&void 0!==n?n:{period:1,periodLength:"d"};for(;!s.isAfter(i);)o.push(K(s,r,a)),s.add(c,l);return o}function tt(t){return t===Z.cn.ATTACHMENTS?(t=0)=>V(t,Z.cn.ATTACHMENTS,{useUnitScaling:!0}):(t=0)=>t.toLocaleString()}var et=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const at=L()(q.ZP.dataCategory.errors).lighten(.25).string(),rt=L()(q.ZP.dataCategory.transactions).lighten(.35).string(),nt=L()(q.ZP.dataCategory.attachments).lighten(.65).string(),ot=q.ZP.red300,st=q.ZP.pink100,it=[{label:Z.mL[Z.cn.ERRORS],value:Z.cn.ERRORS,disabled:!1},{label:Z.mL[Z.cn.TRANSACTIONS],value:Z.cn.TRANSACTIONS,disabled:!1},{label:Z.mL[Z.cn.ATTACHMENTS],value:Z.cn.ATTACHMENTS,disabled:!1}];let ct;!function(t){t.CUMULATIVE="cumulative",t.PERIODIC="periodic"}(ct||(ct={}));const lt=[{label:(0,C.t)("Cumulative"),value:ct.CUMULATIVE,disabled:!1},{label:(0,C.t)("Periodic"),value:ct.PERIODIC,disabled:!1}];let dt;!function(t){t.ACCEPTED="Accepted",t.DROPPED="Dropped",t.PROJECTED="Projected",t.FILTERED="Filtered"}(dt||(dt={}));class pt extends o.Component{constructor(...t){super(...t),(0,r.Z)(this,"state",{xAxisDates:[]})}static getDerivedStateFromProps(t,e){const{usageDateStart:a,usageDateEnd:r,usageDateShowUtc:n,usageDateInterval:o}=t;return{...e,xAxisDates:$(a,r,n,o)}}get chartColors(){const{dataCategory:t,theme:e}=this.props,a=e.chartOther;return t===Z.cn.ERRORS?[at,st,ot,a]:t===Z.cn.ATTACHMENTS?[nt,st,ot,a]:[rt,st,ot,a]}get chartMetadata(){const{usageDateStart:t,usageDateEnd:e}=this.props,{usageDateInterval:a,usageStats:r,dataCategory:n,dataTransform:o,handleDataTransformation:s}=this.props,{xAxisDates:i}=this.state,c=it.find((t=>t.value===n));if(!c)throw new Error("Selected item is not supported");const l={...s(r,o)};Object.keys(l).forEach((t=>{const e=t===dt.PROJECTED;l[t]=l[t].map((t=>({...t,tooltip:{show:!1},itemStyle:{opacity:e?.6:1}})))}));const d=24*(0,U.Ri)(void 0,t,e),p=(0,U.YJ)(a);if(d<0||p<0)throw new Error("UsageChart: Unable to parse data time period");const{xAxisTickInterval:h,xAxisLabelInterval:u}=function(t,e){return t>168?function(t,e){const a=t/24;if(a<=7)throw new Error("This method should be used for periods > 7 days");let r=a,n=r;const o=[2,4,7,14],s=[1,2,7,7];for(let t=0;t<o.length&&n>10;t++)n=r/o[t],r=a/s[t];return{xAxisTickInterval:e/r-1,xAxisLabelInterval:e/n-1}}(t,e):function(t,e){const a=t/24;if(a>7)throw new Error("This method should be used for periods <= 7 days");const r=e/a;return{xAxisTickInterval:r-1,xAxisLabelInterval:r-1}}(t,e)}(d,d/p),{label:m,value:g}=c;return g===Z.cn.ERRORS||g===Z.cn.TRANSACTIONS?{chartLabel:m,chartData:l,xAxisData:i,xAxisTickInterval:h,xAxisLabelInterval:u,yAxisMinInterval:100,yAxisFormatter:M.Du,tooltipValueFormatter:tt(n)}:{chartLabel:m,chartData:l,xAxisData:i,xAxisTickInterval:h,xAxisLabelInterval:u,yAxisMinInterval:5e8,yAxisFormatter:t=>V(t,Z.cn.ATTACHMENTS,{isAbbreviated:!0,useUnitScaling:!0}),tooltipValueFormatter:tt(n)}}get chartSeries(){const{chartSeries:t}=this.props,{chartData:e}=this.chartMetadata;let a=[(0,j.Z)({name:dt.ACCEPTED,data:e.accepted,barMinHeight:1,stack:"usage",legendHoverLink:!1}),(0,j.Z)({name:dt.FILTERED,data:e.filtered,barMinHeight:1,stack:"usage",legendHoverLink:!1}),(0,j.Z)({name:dt.DROPPED,data:e.dropped,stack:"usage",legendHoverLink:!1}),(0,j.Z)({name:dt.PROJECTED,data:e.projected,barMinHeight:1,stack:"usage",legendHoverLink:!1})];return t&&(a=a.concat(t)),a}get chartLegend(){const{chartData:t}=this.chartMetadata,e=[{name:dt.ACCEPTED}];return t.filtered&&t.filtered.length>0&&e.push({name:dt.FILTERED}),t.dropped.length>0&&e.push({name:dt.DROPPED}),t.projected.length>0&&e.push({name:dt.PROJECTED}),e}get chartTooltip(){const{chartTooltip:t}=this.props;if(t)return t;const{tooltipValueFormatter:e}=this.chartMetadata;return{trigger:"axis",valueFormatter:e}}renderChart(){const{theme:t,title:e,isLoading:a,isError:r,errors:n}=this.props;if(a)return(0,et.tZ)(N.Z,{height:"200px",children:(0,et.tZ)(O.Z,{mini:!0})});if(r)return(0,et.BX)(N.Z,{height:"200px",children:[(0,et.tZ)(_.FC,{size:t.fontSizeExtraLarge}),(0,et.tZ)(ut,{children:n&&Object.keys(n).map((t=>{var e;return(0,et.tZ)("span",{children:null===(e=n[t])||void 0===e?void 0:e.message},t)}))})]});const{xAxisData:s,xAxisTickInterval:i,xAxisLabelInterval:c,yAxisMinInterval:l,yAxisFormatter:d}=this.chartMetadata;return(0,et.BX)(o.Fragment,{children:[(0,et.tZ)(I.ws,{children:e||(0,C.t)("Current Usage Period")}),(0,F.Z)({value:(0,et.tZ)(w.Z,{colors:this.chartColors,grid:{bottom:"3px",left:"0px",right:"10px",top:"40px"},xAxis:(0,R.Z)({show:!0,type:"category",name:"Date",boundaryGap:!0,data:s,axisTick:{interval:i,alignWithLabel:!0},axisLabel:{interval:c,formatter:t=>t.slice(0,6)},theme:t}),yAxis:{min:0,minInterval:l,axisLabel:{formatter:d,color:t.chartLabel}},series:this.chartSeries,tooltip:this.chartTooltip,onLegendSelectChanged:()=>{},legend:(0,k.Z)({right:10,top:5,data:this.chartLegend,theme:t})}),fixed:(0,et.tZ)(N.Z,{height:"200px"})})]})}render(){const{footer:t}=this.props;return(0,et.BX)(z.Z,{id:"usage-chart",children:[(0,et.tZ)(I.BO,{children:this.renderChart()}),t]})}}pt.displayName="UsageChart",(0,r.Z)(pt,"defaultProps",{usageDateShowUtc:!0,usageDateInterval:"1d",handleDataTransformation:(t,e)=>{const a={accepted:[],dropped:[],projected:[],filtered:[]},r=e===ct.CUMULATIVE;return Object.keys(t).forEach((e=>{let n=0;a[e]=t[e].map((t=>{const[e,a]=t.value;return n=r?n+a:a,{...t,value:[e,n]}}))})),a}});const ht=(0,A.b)(pt),ut=(0,n.Z)("div",{target:"erx9nbs0"})("display:flex;flex-direction:column;margin-top:",(0,E.Z)(1),";font-size:",(t=>t.theme.fontSizeSmall),";");var mt=a("../node_modules/@sentry/minimal/esm/index.js"),gt=a("./app/components/asyncComponent.tsx"),yt=a("./app/components/charts/optionSelector.tsx"),xt=a("./app/components/notAvailable.tsx"),ft=a("./app/components/scoreCard.tsx");let vt;!function(t){t.ACCEPTED="accepted",t.FILTERED="filtered",t.INVALID="invalid",t.DROPPED="dropped",t.RATE_LIMITED="rate_limited",t.CLIENT_DISCARD="client_discard"}(vt||(vt={}));class Dt extends gt.Z{getEndpoints(){return[["orgStats",this.endpointPath,{query:this.endpointQuery}]]}get endpointPath(){const{organization:t}=this.props;return"/organizations/".concat(t.slug,"/stats_v2/")}get endpointQuery(){return{statsPeriod:"5m",interval:"1m",groupBy:["category","outcome"],field:["sum(quantity)"]}}get minuteData(){const{dataCategory:t}=this.props,{loading:e,error:a,orgStats:r}=this.state;if(e||a||!r||0===r.intervals.length)return;const{intervals:n,groups:o}=r,s=Math.max(n.length-2,0);return V(o.reduce(((e,a)=>{const{outcome:r,category:n}=a.by;return t.includes("".concat(n))&&r===vt.ACCEPTED?e+=a.series["sum(quantity)"][s]:e}),0),t,Q(t))}renderComponent(){return this.minuteData?(0,et.BX)(bt,{children:[this.minuteData," ",(0,C.t)("in last min")]}):null}}const Ct=Dt,bt=(0,n.Z)("div",{target:"e2asf1f0"})("display:inline-block;color:",(t=>t.theme.success),";font-size:",(t=>t.theme.fontSizeMedium),";");class Et extends gt.Z{constructor(...t){super(...t),(0,r.Z)(this,"renderChartFooter",(()=>{const{handleChangeState:t}=this.props,{loading:e,error:a}=this.state,{chartDateInterval:r,chartTransform:n,chartDateStartDisplay:o,chartDateEndDisplay:s,chartDateTimezoneDisplay:i}=this.chartData;return(0,et.BX)(At,{children:[(0,et.tZ)(I.m2,{children:(0,et.BX)(Pt,{children:[(0,et.tZ)(I.OT,{children:(0,C.t)("Date Range:")}),(0,et.tZ)("span",{children:e||a?(0,et.tZ)(xt.Z,{}):(0,C._N)("[start] — [end] ([timezone] UTC, [interval] interval)",{start:o,end:s,timezone:i,interval:r})})]})}),(0,et.tZ)(I.m2,{children:(0,et.tZ)(yt.Z,{title:(0,C.t)("Type"),selected:n,options:lt,onChange:e=>t({transform:e})})})]})}))}componentDidUpdate(t){const{dataDatetime:e}=t,{dataDatetime:a}=this.props;e.start===a.start&&e.end===a.end&&e.period===a.period&&e.utc===a.utc||this.reloadData()}getEndpoints(){return[["orgStats",this.endpointPath,{query:this.endpointQuery}]]}get endpointPath(){const{organization:t}=this.props;return"/organizations/".concat(t.slug,"/stats_v2/")}get endpointQuery(){const{dataDatetime:t}=this.props;return{...t.start&&t.end?{start:t.start,end:t.end,utc:t.utc}:{statsPeriod:t.period||D.GY},interval:(0,B.EX)(t),groupBy:["category","outcome"],field:["sum(quantity)"]}}get chartData(){const{orgStats:t}=this.state;return{...this.mapSeriesToChart(t),...this.chartDateRange,...this.chartTransform}}get chartTransform(){const{chartTransform:t}=this.props;switch(t){case ct.CUMULATIVE:case ct.PERIODIC:return{chartTransform:t};default:return{chartTransform:ct.PERIODIC}}}get chartDateRange(){const{orgStats:t}=this.state,{dataDatetime:e}=this.props,a=(0,B.EX)(e);if(!t||!t.intervals)return{chartDateInterval:a,chartDateStart:"",chartDateEnd:"",chartDateUtc:!0,chartDateStartDisplay:"",chartDateEndDisplay:"",chartDateTimezoneDisplay:""};const{intervals:r}=t,n=(0,U.YJ)(a),o=p()(r[0]).utc(),s=r.length<2?p()(o):p()(r[r.length-1]).utc(),i=function(t){if(t.utc)return!0;const e=(0,B.EX)(t);return(0,U.YJ)(e)>=24}(e),c=n>=24?Y:W,l=p()(o),d=p()(s),h=i?p()(o).utc():p()(o).local(),u=i?p()(s).utc():p()(s).local();return n<24&&u.add(n,"h"),{chartDateInterval:a,chartDateStart:l.format(),chartDateEnd:d.format(),chartDateUtc:i,chartDateStartDisplay:h.format(c),chartDateEndDisplay:u.format(c),chartDateTimezoneDisplay:h.format("Z")}}mapSeriesToChart(t){const e={total:void 0,accepted:void 0,dropped:void 0,filtered:void 0},a={accepted:[],dropped:[],projected:[],filtered:[]};if(!t)return{cardStats:e,chartStats:a};try{const{dataCategory:e}=this.props,{chartDateInterval:r,chartDateUtc:n}=this.chartDateRange,o=t.intervals.map((t=>({date:K(p()(t),r,n),total:0,accepted:0,filtered:0,dropped:{total:0}}))),s={total:0,[vt.ACCEPTED]:0,[vt.FILTERED]:0,[vt.DROPPED]:0,[vt.INVALID]:0,[vt.RATE_LIMITED]:0,[vt.CLIENT_DISCARD]:0};return t.groups.forEach((t=>{const{outcome:a,category:r}=t.by;e.includes("".concat(r))&&(a!==vt.CLIENT_DISCARD&&(s.total+=t.totals["sum(quantity)"]),s[a]+=t.totals["sum(quantity)"],t.series["sum(quantity)"].forEach(((t,e)=>{switch(a){case vt.ACCEPTED:case vt.FILTERED:return void(o[e][a]+=t);case vt.DROPPED:case vt.RATE_LIMITED:case vt.INVALID:return void(o[e].dropped.total+=t);default:return}})))})),s[vt.DROPPED]+=s[vt.INVALID],s[vt.DROPPED]+=s[vt.RATE_LIMITED],o.forEach((t=>{var e;t.total=t.accepted+t.filtered+t.dropped.total,a.accepted.push({value:[t.date,t.accepted]}),a.dropped.push({value:[t.date,t.dropped.total]}),null===(e=a.filtered)||void 0===e||e.push({value:[t.date,t.filtered]})})),{cardStats:{total:V(s.total,e,Q(e)),accepted:V(s[vt.ACCEPTED],e,Q(e)),filtered:V(s[vt.FILTERED],e,Q(e)),dropped:V(s[vt.DROPPED],e,Q(e))},chartStats:a}}catch(r){return mt.$e((e=>{e.setContext("query",this.endpointQuery),e.setContext("body",t),mt.Tb(r)})),{cardStats:e,chartStats:a,dataError:new Error("Failed to parse stats data")}}}renderCards(){const{dataCategory:t,dataCategoryName:e,organization:a}=this.props,{loading:r}=this.state,{total:n,accepted:o,dropped:s,filtered:i}=this.chartData.cardStats;return[{title:(0,C._N)("Total [dataCategory]",{dataCategory:e}),value:n},{title:(0,C.t)("Accepted"),help:(0,C._N)("Accepted [dataCategory] were successfully processed by Sentry",{dataCategory:t}),value:o,secondaryValue:(0,et.tZ)(Ct,{organization:a,dataCategory:t})},{title:(0,C.t)("Filtered"),help:(0,C._N)("Filtered [dataCategory] were blocked due to your inbound data filter rules",{dataCategory:t}),value:i},{title:(0,C.t)("Dropped"),help:(0,C._N)("Dropped [dataCategory] were discarded due to invalid data, rate-limits, quota limits, or spike protection",{dataCategory:t}),value:s}].map(((t,e)=>(0,et.tZ)(Tt,{title:t.title,score:r?void 0:t.value,help:t.help,trend:t.secondaryValue},e)))}renderChart(){const{dataCategory:t}=this.props,{error:e,errors:a,loading:r}=this.state,{chartStats:n,dataError:o,chartDateInterval:s,chartDateStart:i,chartDateEnd:c,chartDateUtc:l,chartTransform:d}=this.chartData,p=e||!!o,h=o?{...a,data:o}:a;return(0,et.tZ)(ht,{isLoading:r,isError:p,errors:h,title:" ",footer:this.renderChartFooter(),dataCategory:t,dataTransform:d,usageDateStart:i,usageDateEnd:c,usageDateShowUtc:l,usageDateInterval:s,usageStats:n})}renderComponent(){return(0,et.BX)(o.Fragment,{children:[this.renderCards(),(0,et.tZ)(St,{children:this.renderChart()})]})}}const Zt=Et,Tt=(0,n.Z)(ft.ZP,{target:"e2z08b03"})({name:"14rqsjo",styles:"grid-column:auto/span 1;margin:0"}),St=(0,n.Z)("div",{target:"e2z08b02"})({name:"18iuzk9",styles:"grid-column:1/-1"}),At=(0,n.Z)("div",{target:"e2z08b01"})("display:flex;flex-direction:row;justify-content:space-between;padding:",(0,E.Z)(1)," ",(0,E.Z)(3),";border-top:1px solid ",(t=>t.theme.border),";"),Pt=(0,n.Z)("div",{target:"e2z08b00"})("display:flex;flex-direction:row;align-items:center;>",I.OT,"{margin-right:",(0,E.Z)(1.5),";}>span:last-child{font-weight:400;font-size:",(t=>t.theme.fontSizeMedium),";}");var Lt=a("./app/components/gridEditable/sortLink.tsx"),wt=a("./app/components/pagination.tsx"),kt=a("./app/components/searchBar.tsx"),Rt=a("./app/utils/withProjects.tsx"),jt=a("./app/components/charts/errorPanel.tsx"),It=a("./app/components/idBadge/index.tsx"),Ot=a("./app/components/links/externalLink.tsx"),zt=a("./app/components/links/link.tsx"),Nt=a("./app/components/organizations/headerItem.tsx"),_t=a("./app/components/panels/index.tsx"),Ut=a("./app/components/panels/panelTable.tsx"),Mt=a("./app/views/settings/components/emptyMessage.tsx");class Ft extends o.Component{constructor(...t){super(...t),(0,r.Z)(this,"getErrorMessage",(t=>"No projects available"===t.projectStats.responseJSON.detail?(0,et.tZ)(Mt.Z,{icon:(0,et.tZ)(_.FC,{color:"gray300",size:"48"}),title:(0,C.t)("You don't have access to any projects, or your organization has no projects."),description:(0,C._N)("Learn more about [link:Project Access]",{link:(0,et.tZ)(Ot.Z,{href:"https://docs.sentry.io/product/accounts/membership/#restricting-access"})})}):(0,et.tZ)(_.FC,{color:"gray300",size:"48"})))}get formatUsageOptions(){const{dataCategory:t}=this.props;return{isAbbreviated:t!==Z.cn.ATTACHMENTS,useUnitScaling:t===Z.cn.ATTACHMENTS}}renderTableRow(t){const{dataCategory:e}=this.props,{project:a,total:r,accepted:n,filtered:o,dropped:s}=t;return[(0,et.BX)(Ht,{children:[(0,et.tZ)(zt.Z,{to:t.projectLink,children:(0,et.tZ)(Jt,{avatarSize:16,disableLink:!0,hideOverflow:!0,project:a,displayName:a.slug})}),(0,et.tZ)(Nt.c,{to:t.projectSettingsLink,children:(0,et.tZ)(_.iC,{size:q.ZP.iconSizes.sm})})]},0),(0,et.tZ)(Xt,{children:V(r,e,this.formatUsageOptions)},1),(0,et.tZ)(Xt,{children:V(n,e,this.formatUsageOptions)},2),(0,et.tZ)(Xt,{children:V(o,e,this.formatUsageOptions)},3),(0,et.tZ)(Xt,{children:V(s,e,this.formatUsageOptions)},4)]}render(){const{isEmpty:t,isLoading:e,isError:a,errors:r,headers:n,usageStats:o}=this.props;return a?(0,et.tZ)(_t.s_,{children:(0,et.tZ)(jt.Z,{height:"256px",children:this.getErrorMessage(r)})}):(0,et.tZ)(Bt,{isLoading:e,isEmpty:t,headers:n,children:o.map((t=>this.renderTableRow(t)))})}}Ft.displayName="UsageTable";const qt=Ft,Bt=(0,n.Z)(Ut.Z,{target:"e5qzo7m3"})("grid-template-columns:repeat(5, auto);@media (min-width: ",(t=>t.theme.breakpoints[0]),"){grid-template-columns:1fr repeat(4, minmax(0, auto));}"),Xt=(0,n.Z)("div",{target:"e5qzo7m2"})({name:"10jfpq4",styles:"flex-shrink:1;text-align:right;font-variant-numeric:tabular-nums"}),Ht=(0,n.Z)(Xt,{target:"e5qzo7m1"})({name:"1axuxrw",styles:"display:flex;align-items:center;text-align:left"}),Jt=(0,n.Z)(It.Z,{target:"e5qzo7m0"})({name:"ri00hy",styles:"overflow:hidden;white-space:nowrap;flex-shrink:1"});let Vt;!function(t){t.PROJECT="project",t.TOTAL="total",t.ACCEPTED="accepted",t.FILTERED="filtered",t.DROPPED="dropped",t.INVALID="invalid",t.RATE_LIMITED="rate_limited"}(Vt||(Vt={}));class Qt extends gt.Z{constructor(...t){super(...t),(0,r.Z)(this,"handleChangeSort",(t=>{const{handleChangeState:e}=this.props,{key:a,direction:r}=this.tableSort;let n=1;return a===t?n=-1*r:t===Vt.PROJECT&&(n=-1),e({sort:"".concat(n>0?"-":"").concat(t)},{willUpdateRouter:!1})})),(0,r.Z)(this,"handleSearch",(t=>{const{handleChangeState:e,tableQuery:a}=this.props;t!==a&&e(t?{query:t,cursor:void 0}:{query:void 0,cursor:void 0})}))}componentDidUpdate(t){const{dataDatetime:e,dataCategory:a}=t,{dataDatetime:r,dataCategory:n}=this.props;e.start===r.start&&e.end===r.end&&e.period===r.period&&e.utc===r.utc&&n===a||this.reloadData()}getEndpoints(){return[["projectStats",this.endpointPath,{query:this.endpointQuery}]]}get endpointPath(){const{organization:t}=this.props;return"/organizations/".concat(t.slug,"/stats_v2/")}get endpointQuery(){const{dataDatetime:t,dataCategory:e}=this.props;return{...t.start&&t.end?{start:t.start,end:t.end,utc:t.utc}:{statsPeriod:t.period||D.GY},interval:(0,B.EX)(t),groupBy:["outcome","project"],field:["sum(quantity)"],project:"-1",category:e.slice(0,-1)}}get tableData(){const{projectStats:t}=this.state;return{headers:this.tableHeader,...this.mapSeriesToTable(t)}}get tableSort(){const{tableSort:t}=this.props;if(!t)return{key:Vt.TOTAL,direction:1};let e=t,a=-1;switch("-"===t.charAt(0)&&(e=e.slice(1),a=1),e){case Vt.PROJECT:case Vt.TOTAL:case Vt.ACCEPTED:case Vt.FILTERED:case Vt.DROPPED:return{key:e,direction:a};default:return{key:Vt.ACCEPTED,direction:-1}}}get tableCursor(){const{tableCursor:t}=this.props,e=Number(null==t?void 0:t.split(":")[1]);return isNaN(e)?0:e}get pageLink(){const t=this.filteredProjects.length,e=this.tableCursor,a=e-Qt.MAX_ROWS_USAGE_TABLE,r=e+Qt.MAX_ROWS_USAGE_TABLE;return'<link>; rel="previous"; results="'.concat(a>=0,'"; cursor="0:').concat(Math.max(0,a),':1", <link>; rel="next"; results="').concat(r<t,'"; cursor="0:').concat(r,':0"')}get filteredProjects(){const{projects:t,tableQuery:e}=this.props;return e?t.filter((t=>t.slug.includes(e)&&t.hasAccess)):t.filter((t=>t.hasAccess))}get tableHeader(){const{key:t,direction:e}=this.tableSort,a=a=>{if(a===t)return e>0?"desc":"asc"};return[{key:Vt.PROJECT,title:(0,C.t)("Project"),align:"left",direction:a(Vt.PROJECT),onClick:()=>this.handleChangeSort(Vt.PROJECT)},{key:Vt.TOTAL,title:(0,C.t)("Total"),align:"right",direction:a(Vt.TOTAL),onClick:()=>this.handleChangeSort(Vt.TOTAL)},{key:Vt.ACCEPTED,title:(0,C.t)("Accepted"),align:"right",direction:a(Vt.ACCEPTED),onClick:()=>this.handleChangeSort(Vt.ACCEPTED)},{key:Vt.FILTERED,title:(0,C.t)("Filtered"),align:"right",direction:a(Vt.FILTERED),onClick:()=>this.handleChangeSort(Vt.FILTERED)},{key:Vt.DROPPED,title:(0,C.t)("Dropped"),align:"right",direction:a(Vt.DROPPED),onClick:()=>this.handleChangeSort(Vt.DROPPED)}].map((t=>{const e=t.key===Vt.PROJECT?Ht:Xt;return(0,et.tZ)(e,{children:(0,et.tZ)(Lt.Z,{canSort:!0,title:t.title,align:t.align,direction:t.direction,generateSortLink:t.onClick})},t.key)}))}getProjectLink(t){const{dataCategory:e,getNextLocations:a,organization:r}=this.props,{performance:n,projectDetail:o,settings:s}=a(t);return e===Z.cn.TRANSACTIONS&&r.features.includes("performance-view")?{projectLink:n,projectSettingsLink:s}:{projectLink:o,projectSettingsLink:s}}mapSeriesToTable(t){if(!t)return{tableStats:[]};const e={};try{const a={[Vt.TOTAL]:0,[Vt.ACCEPTED]:0,[Vt.FILTERED]:0,[Vt.DROPPED]:0},r=this.filteredProjects,n=new Set(r.map((t=>t.id)));t.groups.forEach((t=>{const{outcome:r,project:o}=t.by;n.has(o.toString())&&(e[o]||(e[o]={...a}),r!==vt.CLIENT_DISCARD&&(e[o].total+=t.totals["sum(quantity)"]),r===vt.ACCEPTED||r===vt.FILTERED?e[o][r]+=t.totals["sum(quantity)"]:r!==vt.RATE_LIMITED&&r!==vt.INVALID&&r!==vt.DROPPED||(e[o][Vt.DROPPED]+=t.totals["sum(quantity)"]))}));const o=r.map((t=>{var r;const n=null!==(r=e[t.id])&&void 0!==r?r:{...a};return{project:{...t},...this.getProjectLink(t),...n}})),{key:s,direction:i}=this.tableSort;o.sort(((t,e)=>s===Vt.PROJECT?e.project.slug.localeCompare(t.project.slug)*i:t[s]!==e[s]?(e[s]-t[s])*i:t.project.slug.localeCompare(e.project.slug)));const c=this.tableCursor;return{tableStats:o.slice(c,c+Qt.MAX_ROWS_USAGE_TABLE)}}catch(e){return mt.$e((a=>{a.setContext("query",this.endpointQuery),a.setContext("body",t),mt.Tb(e)})),{tableStats:[],error:e}}}renderComponent(){const{error:t,errors:e,loading:a}=this.state,{dataCategory:r,loadingProjects:n,tableQuery:s}=this.props,{headers:i,tableStats:c}=this.tableData;return(0,et.BX)(o.Fragment,{children:[(0,et.tZ)(Yt,{children:(0,et.tZ)(kt.Z,{defaultQuery:"",query:s,placeholder:(0,C.t)("Filter your projects"),onSearch:this.handleSearch})}),(0,et.BX)(Yt,{children:[(0,et.tZ)(qt,{isLoading:a||n,isError:t,errors:e,isEmpty:0===c.length,headers:i,dataCategory:r,usageStats:c}),(0,et.tZ)(wt.Z,{pageLinks:this.pageLink})]})]})}}(0,r.Z)(Qt,"MAX_ROWS_USAGE_TABLE",25);const Gt=(0,Rt.Z)(Qt),Yt=(0,n.Z)("div",{target:"e1ii6wy90"})("margin-bottom:",(0,E.Z)(2),";"),Wt=(0,m.Z)({hookName:"component:org-stats-banner"}),Kt=["pageStatsPeriod","pageStart","pageEnd","pageUtc","dataCategory","transform","sort","query","cursor"];class $t extends o.Component{constructor(...t){super(...t),(0,r.Z)(this,"getNextLocations",(t=>{const{location:e,organization:a}=this.props,r={...e,query:{...e.query,project:t.id}};return r.query=i()(r.query,Kt),{performance:{...r,pathname:"/organizations/".concat(a.slug,"/performance/")},projectDetail:{...r,pathname:"/organizations/".concat(a.slug,"/projects/").concat(t.slug,"/")},issueList:{...r,pathname:"/organizations/".concat(a.slug,"/issues/")},settings:{pathname:"/settings/".concat(a.slug,"/projects/").concat(t.slug,"/")}}})),(0,r.Z)(this,"handleUpdateDatetime",(t=>{const{start:e,end:a,relative:r,utc:n}=t;if(e&&a){const t=n?p().utc:p();return this.setStateOnUrl({pageStatsPeriod:void 0,pageStart:t(e).format(),pageEnd:t(a).format(),pageUtc:null!=n?n:void 0})}return this.setStateOnUrl({pageStatsPeriod:r||void 0,pageStart:void 0,pageEnd:void 0,pageUtc:void 0})})),(0,r.Z)(this,"setStateOnUrl",((t,e={willUpdateRouter:!0})=>{const{location:a,router:r}=this.props,n=l()(t,Kt),o={...a,query:{...null==a?void 0:a.query,...n}};return e.willUpdateRouter&&r.push(o),o})),(0,r.Z)(this,"renderPageControl",(()=>{const{organization:t}=this.props,{start:e,end:a,period:r,utc:n}=this.dataDatetime;return(0,et.BX)(o.Fragment,{children:[(0,et.tZ)(ae,{label:(0,et.BX)(ne,{children:[(0,et.tZ)("span",{children:(0,C.t)("Event Type: ")}),(0,et.tZ)("span",{children:this.dataCategoryName})]}),children:it.map((t=>(0,et.tZ)(h.hP,{isActive:t.value===this.dataCategory,eventKey:t.value,onSelect:t=>this.setStateOnUrl({dataCategory:t}),children:t.label},t.value)))}),(0,et.tZ)(re,{organization:t,relative:null!=r?r:"",start:null!=e?e:null,end:null!=a?a:null,utc:null!=n?n:null,onUpdate:this.handleUpdateDatetime,relativeOptions:i()(D.wh,["1h"])})]})}))}get dataCategory(){var t,e;const a=null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.dataCategory;switch(a){case Z.cn.ERRORS:case Z.cn.TRANSACTIONS:case Z.cn.ATTACHMENTS:return a;default:return Z.cn.ERRORS}}get dataCategoryName(){var t;const e=this.dataCategory;return null!==(t=Z.mL[e])&&void 0!==t?t:(0,C.t)("Unknown Data Category")}get dataDatetime(){var t,e;const a=null!==(t=null===(e=this.props.location)||void 0===e?void 0:e.query)&&void 0!==t?t:{},{start:r,end:n,statsPeriod:o,utc:s}=(0,y.fK)(a,{allowEmptyPeriod:!0,allowAbsoluteDatetime:!0,allowAbsolutePageDatetime:!0});if(!o&&!r&&!n)return{period:D.GY};if(o)return{period:o};const i="true"===s;return r&&n?i?{start:p().utc(r).format(),end:p().utc(n).format(),utc:i}:{start:p()(r).utc().format(),end:p()(n).utc().format(),utc:i}:{period:D.GY}}get chartTransform(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.transform}get tableSort(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.sort}get tableQuery(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.query}get tableCursor(){var t,e;return null===(t=this.props.location)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.cursor}render(){const{organization:t}=this.props,e=t.features.includes("team-insights");return(0,et.tZ)(v.Z,{title:"Usage Stats",children:(0,et.BX)(o.Fragment,{children:[e&&(0,et.tZ)(S.Z,{organization:t,activeTab:"stats"}),(0,et.tZ)(oe,{children:(0,et.BX)(g.or,{fullWidth:!0,children:[!e&&(0,et.BX)(o.Fragment,{children:[(0,et.tZ)(b.mr,{children:(0,et.tZ)(x.Z,{children:(0,C.t)("Organization Usage Stats")})}),(0,et.tZ)("p",{children:(0,C.t)("We collect usage metrics on three types of events: errors, transactions, and attachments. The charts below reflect events that Sentry has received across your entire organization. You can also find them broken down by project in the table.")})]}),(0,et.tZ)(Wt,{organization:t}),(0,et.BX)(ee,{children:[this.renderPageControl(),(0,et.tZ)(u.Z,{mini:!0,children:(0,et.tZ)(Zt,{organization:t,dataCategory:this.dataCategory,dataCategoryName:this.dataCategoryName,dataDatetime:this.dataDatetime,chartTransform:this.chartTransform,handleChangeState:this.setStateOnUrl})})]}),(0,et.tZ)(u.Z,{mini:!0,children:(0,et.tZ)(Gt,{organization:t,dataCategory:this.dataCategory,dataCategoryName:this.dataCategoryName,dataDatetime:this.dataDatetime,tableSort:this.tableSort,tableQuery:this.tableQuery,tableCursor:this.tableCursor,handleChangeState:this.setStateOnUrl,getNextLocations:this.getNextLocations})})]})})]})})}}$t.displayName="OrganizationStats";const te=(0,T.Z)($t),ee=(0,n.Z)("div",{target:"eonnbv94"})("display:grid;grid-template-columns:1fr;gap:",(0,E.Z)(2),";@media (min-width: ",(t=>t.theme.breakpoints[0]),"){grid-template-columns:repeat(2, 1fr);}@media (min-width: ",(t=>t.theme.breakpoints[2]),"){grid-template-columns:repeat(4, 1fr);}"),ae=(0,n.Z)(h.ZP,{target:"eonnbv93"})("height:42px;grid-column:auto/span 1;justify-self:stretch;align-self:stretch;z-index:",(t=>t.theme.zIndex.orgStats.dataCategory),";button{width:100%;height:100%;>span{display:flex;justify-content:space-between;}}@media (min-width: ",(t=>t.theme.breakpoints[0]),"){grid-column:auto/span 2;}@media (min-width: ",(t=>t.theme.breakpoints[2]),"){grid-column:auto/span 1;}"),re=(0,n.Z)(f.Z,{target:"eonnbv92"})("grid-column:auto/span 1;z-index:",(t=>t.theme.zIndex.orgStats.timeRange),";@media (min-width: ",(t=>t.theme.breakpoints[0]),"){grid-column:auto/span 2;}@media (min-width: ",(t=>t.theme.breakpoints[2]),"){grid-column:auto/span 3;}"),ne=(0,n.Z)("span",{target:"eonnbv91"})("text-align:left;font-weight:600;color:",(t=>t.theme.textColor),";>span:last-child{font-weight:400;}"),oe=(0,n.Z)(g.uT,{target:"eonnbv90"})("margin-bottom:-20px;@media (min-width: ",(t=>t.theme.breakpoints[1]),"){display:block;}")}}]);
//# sourceMappingURL=../sourcemaps/app_views_organizationStats_index_tsx.4f44effbea3fb71f5da1c85995c5f391.js.map