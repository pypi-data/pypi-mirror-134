"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_components_createAlertButton_tsx"],{"./app/components/createAlertButton.tsx":(e,t,n)=>{n.d(t,{K:()=>A,Z:()=>j});var r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),a=n("../node_modules/react-router/es/index.js"),s=n("./app/actionCreators/indicator.tsx"),i=n("./app/actionCreators/navigation.tsx"),l=n("./app/components/acl/access.tsx"),c=n("./app/components/alert.tsx"),u=n("./app/components/assistant/guideAnchor.tsx"),p=n("./app/components/button.tsx"),d=n("./app/components/links/link.tsx"),m=n("./app/icons/index.tsx"),g=n("./app/locale.tsx"),y=n("./app/utils/discover/fields.tsx"),v=n("./app/utils/useApi.tsx"),h=n("./app/views/alerts/incidentRules/constants.tsx"),f=n("./app/views/alerts/utils/index.tsx"),b=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function x({incompatibleQuery:e,eventView:t,orgId:n,onClose:r}){const{hasProjectError:a,hasEnvironmentError:s,hasEventTypeError:i,hasYAxisError:l}=e,c=Object.values(e).filter((e=>!0===e)).length,u=t.clone();u.query+=" event.type:error";const p=t.clone();p.query+=" event.type:transaction";const y=t.clone();y.query+=" event.type:default";const v=t.clone();v.query+=" event.type:error or event.type:default";const h="/organizations/".concat(n,"/discover/results/"),f={error:(0,b.tZ)(d.Z,{to:{pathname:h,query:u.generateQueryStringObject()}}),default:(0,b.tZ)(d.Z,{to:{pathname:h,query:y.generateQueryStringObject()}}),transaction:(0,b.tZ)(d.Z,{to:{pathname:h,query:p.generateQueryStringObject()}}),errorDefault:(0,b.tZ)(d.Z,{to:{pathname:h,query:v.generateQueryStringObject()}})};return(0,b.BX)(w,{type:"warning",icon:(0,b.tZ)(m.aU,{color:"yellow300",size:"sm"}),children:[1===c&&(0,b.BX)(o.Fragment,{children:[a&&(0,g.t)("An alert can use data from only one Project. Select one and try again."),s&&(0,g.t)("An alert supports data from a single Environment or All Environments. Pick one try again."),i&&(0,g._N)("An alert needs a filter of [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)]. Use one of these and try again.",f),l&&(0,g._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,b.tZ)(R,{children:t.getYAxis()})})]}),c>1&&(0,b.BX)(o.Fragment,{children:[(0,g.t)("Yikes! That button didn’t work. Please fix the following problems:"),(0,b.BX)(E,{children:[a&&(0,b.tZ)("li",{children:(0,g.t)("Select one Project.")}),s&&(0,b.tZ)("li",{children:(0,g.t)("Select a single Environment or All Environments.")}),i&&(0,b.tZ)("li",{children:(0,g._N)("Use the filter [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)].",f)}),l&&(0,b.tZ)("li",{children:(0,g._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,b.tZ)(R,{children:t.getYAxis()})})})]})]}),(0,b.tZ)(k,{icon:(0,b.tZ)(m.bM,{size:"sm"}),"aria-label":(0,g.t)("Close"),size:"zero",onClick:r,borderless:!0})]})}function A({projects:e,eventView:t,organization:n,referrer:r,onIncompatibleQuery:o,onSuccess:a,...s}){const i={hasProjectError:1!==t.project.length||-1===t.project[0],hasEnvironmentError:t.environment.length>1,hasEventTypeError:null===(0,f.A4)(t.query),hasYAxisError:function(e){var t;const n=(0,y.nr)(e.getYAxis());if("field"===n.kind||"equation"===n.kind)return!0;const r=e.query.match(/event\.type:(transaction|error)/);if(!r)return!1;const o="error"===r[1]?h.yq:h.Yp,a=!o.aggregations.includes(n.function[0]),s=y.lx[n.function[0]];if(!s)return!1;const i=s.parameters.some((e=>"value"===e.kind&&"number"===e.dataType)),l=["",...o.fields,...null!==(t=o.measurementKeys)&&void 0!==t?t:[]],c=!i&&!l.includes(n.function[1]);return a||c}(t)},l=e.find((e=>e.id==="".concat(t.project[0]))),c=Object.values(i).some((e=>e)),u=c?void 0:{pathname:"/organizations/".concat(n.slug,"/alerts/").concat(null==l?void 0:l.slug,"/new/"),query:{...t.generateQueryStringObject(),createFromDiscover:!0,referrer:r}};return(0,b.tZ)(Z,{organization:n,onClick:e=>{if(c)return e.preventDefault(),void o((e=>(0,b.tZ)(x,{incompatibleQuery:i,eventView:t,orgId:n.slug,onClose:e})),i);a()},to:u,...s})}x.displayName="IncompatibleQueryAlert",A.displayName="CreateAlertFromViewButton";const Z=(0,a.withRouter)((({organization:e,projectSlug:t,iconProps:n,referrer:r,router:o,hideIcon:a,showPermissionGuide:c,...y})=>{const h=(0,v.Z)(),f=t=>{const n="/organizations/".concat(e.slug,"/alerts/").concat(t);return"".concat(n,"/wizard/").concat(r?"?referrer=".concat(r):"")};function x(e){e.preventDefault(),(0,i.T)(f(":projectId"),o)}async function A(){const t="/organizations/".concat(e.slug,"/");(0,s.E3)();try{await h.requestPromise(t,{method:"PUT",data:{alertsMemberWrite:!0}}),(0,s.S9)((0,g.t)("Successfully updated organization settings"))}catch(e){(0,s.Iw)((0,g.t)("Unable to update organization settings"))}}const Z=(0,g._N)("Ask your organization owner or manager to [settingsLink:enable alerts access] for you.",{settingsLink:(0,b.tZ)(d.Z,{to:"/settings/".concat(e.slug)})}),j=e=>{var r;return(0,b.tZ)(p.ZP,{disabled:!e,title:e?void 0:Z,icon:!a&&(0,b.tZ)(m.vr,{...n}),to:t?f(t):void 0,tooltipProps:{isHoverable:!0,position:"top",popperStyle:{maxWidth:"270px"}},onClick:t?void 0:x,...y,children:null!==(r=y.children)&&void 0!==r?r:(0,g.t)("Create Alert")})},w=!e.alertsMemberWrite&&!!c;return(0,b.tZ)(l.Z,{organization:e,access:["alerts:write"],children:({hasAccess:t})=>w?(0,b.tZ)(l.Z,{organization:e,access:["org:write"],children:({hasAccess:e})=>(0,b.tZ)(u.Z,{target:e?"alerts_write_owner":"alerts_write_member",onFinish:e?A:void 0,children:j(t)})}):j(t)})})),j=Z,w=(0,r.Z)(c.Z,{target:"e173ycuj3"})("color:",(e=>e.theme.textColor),";margin-bottom:0;"),E=(0,r.Z)("ul",{target:"e173ycuj2"})({name:"1ykowef",styles:"margin-bottom:0"}),R=(0,r.Z)("code",{target:"e173ycuj1"})({name:"1imza1v",styles:"background-color:transparent;padding:0"}),k=(0,r.Z)(p.ZP,{target:"e173ycuj0"})({name:"d61lvy",styles:"transition:opacity 0.1s linear;position:absolute;top:3px;right:0;&:hover,&:focus{background-color:transparent;}"})},"./app/views/alerts/incidentRules/constants.tsx":(e,t,n)=>{n.d(t,{b1:()=>i,wT:()=>l,kV:()=>c,Vr:()=>u,Ng:()=>p,hh:()=>d,P1:()=>m,yq:()=>g,KP:()=>h,nM:()=>f,Yp:()=>b,W7:()=>x,ep:()=>A,H9:()=>Z,Q6:()=>j}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=n("./app/locale.tsx"),o=n("./app/utils/performance/vitals/constants.tsx"),a=n("./app/views/alerts/incidentRules/types.tsx"),s=n("./app/views/alerts/utils/index.tsx");const i=1,l=60,c=10080,u="count()",p="p95(transaction.duration)",d={[a.qz.ERRORS]:"event.type:error",[a.qz.TRANSACTIONS]:"event.type:transaction"},m={[a.Yh.ERROR_DEFAULT]:"event.type:[error, default]",[a.Yh.ERROR]:"event.type:error",[a.Yh.DEFAULT]:"event.type:default",[a.Yh.TRANSACTION]:"event.type:transaction"},g={aggregations:["count","count_unique"],fields:["user"]},y=["avg","percentile","p50","p75","p95","p99","p100"],v=[...y,"failure_rate","apdex","count"],h=[{value:5,label:(0,r.t)("same time 5 minutes ago")},{value:15,label:(0,r.t)("same time 15 minutes ago")},{value:60,label:(0,r.t)("same time one hour ago")},{value:1440,label:(0,r.t)("same time one day ago")},{value:10080,label:(0,r.t)("same time one week ago")},{value:43200,label:(0,r.t)("same time one month ago")}];function f(e,t){return"custom"===e&&t===a.qz.ERRORS?g:{aggregations:"apdex"===e||"custom"===e?v:y,fields:["transaction.duration"],measurementKeys:Object.keys(o.r)}}Object.keys(o.r);const b={aggregations:v,fields:["transaction.duration"],measurementKeys:Object.keys(o.r)};function x(e){return{label:e,alertThreshold:"",actions:[]}}function A(e={}){return{dataset:a.qz.ERRORS,eventTypes:[a.GM.ERROR],aggregate:u,query:"",timeWindow:1,triggers:[x("critical"),x("warning")],projects:[],environment:null,resolveThreshold:"",thresholdType:a.lT.ABOVE,...e}}function Z(e){var t;const n=(0,s.A4)(e.query),r=n?s.Ey[n.source]:s.Ey.error;let o=e.getYAxis();return"transactions"===r.dataset&&/^p\d{2,3}\(\)/.test(e.getYAxis())&&(o=e.getYAxis().slice(0,3)+"(transaction.duration)"),{...A(),...r,query:null!==(t=null==n?void 0:n.query)&&void 0!==t?t:e.query,aggregate:o,environment:e.environment.length?e.environment[0]:null}}function j(e){const{eventTypes:t,aggregate:n,dataset:r}=e,o={};return(0,s.Eb)(n)&&(o.thresholdType=a.lT.BELOW,o.timeWindow=a.Tb.ONE_HOUR),{...A(o),eventTypes:[t],aggregate:n,dataset:r}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_createAlertButton_tsx.f3f2e702879f463eb5f2164e8c1785f7.js.map