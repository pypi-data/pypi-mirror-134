"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx"],{"./app/actionCreators/plugins.tsx":(t,e,s)=>{s.d(e,{MM:()=>d,Cg:()=>c,rR:()=>u}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=s("./app/actionCreators/indicator.tsx"),a=s("./app/actions/pluginActions.tsx"),i=s("./app/api.tsx"),o=s("./app/locale.tsx");const l={},r=new i.KU;function p({orgId:t,projectId:e,pluginId:s,update:n,...i}){a.Z.update(s,n);const o=r.requestPromise("/projects/".concat(t,"/").concat(e,"/plugins/").concat(s,"/"),{...i});return o.then((()=>{a.Z.updateSuccess(s,n)})).catch((t=>{const e=t&&t.responseJSON&&"string"==typeof t.responseJSON.detail?new Error(t.responseJSON.detail):new Error("Unable to update plugin");a.Z.updateError(s,n,e)})),o}function d({orgId:t,projectId:e},s){const n="/projects/".concat(t,"/").concat(e,"/plugins/");if(l[n])return l[n];a.Z.fetchAll(s);const i=r.requestPromise(n,{method:"GET",includeAllArgs:!0});return l[n]=i,i.then((([t,e,s])=>(a.Z.fetchAllSuccess(t,{pageLinks:null==s?void 0:s.getResponseHeader("Link")}),t))).catch((t=>{throw a.Z.fetchAllError(t),new Error("Unable to fetch plugins")})).then((()=>l[n]=null)),i}function c(t){return(0,n.E3)((0,o.t)("Enabling...")),p({...t,update:{enabled:!0},method:"POST"}).then((()=>(0,n.S9)((0,o.t)("Plugin was enabled")))).catch((()=>(0,n.Iw)((0,o.t)("Unable to enable plugin"))))}function u(t){return(0,n.E3)((0,o.t)("Disabling...")),p({...t,update:{enabled:!1},method:"DELETE"}).then((()=>(0,n.S9)((0,o.t)("Plugin was disabled")))).catch((()=>(0,n.Iw)((0,o.t)("Unable to disable plugin"))))}},"./app/actions/pluginActions.tsx":(t,e,s)=>{s.d(e,{Z:()=>a});var n=s("../node_modules/reflux/src/index.js");const a=s.n(n)().createActions(["update","updateError","updateSuccess","fetchAll","fetchAllSuccess","fetchAllError"])},"./app/components/pluginConfig.tsx":(t,e,s)=>{s.d(e,{Z:()=>x});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("../node_modules/lodash/isEqual.js"),l=s.n(o),r=s("./app/actionCreators/indicator.tsx"),p=s("./app/components/button.tsx"),d=s("./app/components/loadingIndicator.tsx"),c=s("./app/components/panels/index.tsx"),u=s("./app/locale.tsx"),g=s("./app/plugins/index.tsx"),h=s("./app/plugins/components/pluginIcon.tsx"),m=s("./app/styles/space.tsx"),Z=s("./app/utils/withApi.tsx"),b=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class f extends i.Component{constructor(...t){super(...t),(0,n.Z)(this,"state",{loading:!g.ZP.isLoaded(this.props.data),testResults:""}),(0,n.Z)(this,"handleDisablePlugin",(()=>{this.props.onDisablePlugin(this.props.data)})),(0,n.Z)(this,"handleTestPlugin",(async()=>{this.setState({testResults:""}),(0,r.E3)((0,u.t)("Sending test..."));try{const t=await this.props.api.requestPromise(this.getPluginEndpoint(),{method:"POST",data:{test:!0}});this.setState({testResults:JSON.stringify(t.detail)}),(0,r.S9)((0,u.t)("Test Complete!"))}catch(t){(0,r.Iw)((0,u.t)("An unexpected error occurred while testing your plugin. Please try again."))}}))}componentDidMount(){this.loadPlugin(this.props.data)}UNSAFE_componentWillReceiveProps(t){this.loadPlugin(t.data)}shouldComponentUpdate(t,e){return!l()(e,this.state)||!l()(t.data,this.props.data)}loadPlugin(t){this.setState({loading:!0},(()=>{g.ZP.load(t,(()=>{this.setState({loading:!1})}))}))}getPluginEndpoint(){const{organization:t,project:e,data:s}=this.props;return"/projects/".concat(t.slug,"/").concat(e.slug,"/plugins/").concat(s.id,"/")}createMarkup(){return{__html:this.props.data.doc}}render(){const{data:t}=this.props,e=void 0!==this.props.enabled?this.props.enabled:t.enabled;return(0,b.BX)(c.s_,{className:"plugin-config ref-plugin-config-".concat(t.id),"data-test-id":"plugin-config",children:[(0,b.BX)(c.V9,{hasButtons:!0,children:[(0,b.BX)(P,{children:[(0,b.tZ)(j,{pluginId:t.id}),(0,b.tZ)("span",{children:t.name})]}),t.canDisable&&e&&(0,b.BX)(S,{children:[t.isTestable&&(0,b.tZ)(w,{onClick:this.handleTestPlugin,size:"small",children:(0,u.t)("Test Plugin")}),(0,b.tZ)(p.ZP,{size:"small",onClick:this.handleDisablePlugin,children:(0,u.t)("Disable")})]})]}),"beta"===t.status&&(0,b.tZ)(c.aU,{type:"warning",children:(0,u.t)("This plugin is considered beta and may change in the future.")}),""!==this.state.testResults&&(0,b.BX)(c.aU,{type:"info",children:[(0,b.tZ)("strong",{children:"Test Results"}),(0,b.tZ)("div",{children:this.state.testResults})]}),(0,b.BX)(y,{children:[(0,b.tZ)("div",{dangerouslySetInnerHTML:this.createMarkup()}),this.state.loading?(0,b.tZ)(d.Z,{}):g.ZP.get(t).renderSettings({organization:this.props.organization,project:this.props.project})]})]})}}f.displayName="PluginConfig",(0,n.Z)(f,"defaultProps",{onDisablePlugin:()=>{}});const x=(0,Z.Z)(f),P=(0,a.Z)("div",{target:"e1kqgtma4"})({name:"y37upr",styles:"display:flex;align-items:center;flex:1"}),j=(0,a.Z)(h.ZP,{target:"e1kqgtma3"})("margin-right:",(0,m.Z)(1),";"),S=(0,a.Z)("div",{target:"e1kqgtma2"})({name:"zjik7",styles:"display:flex"}),w=(0,a.Z)(p.ZP,{target:"e1kqgtma1"})("margin-right:",(0,m.Z)(1),";"),y=(0,a.Z)(c.N,{target:"e1kqgtma0"})("padding:",(0,m.Z)(2),";padding-bottom:0;")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx.da48e6b61733cd36d7e07b69714015f7.js.map