"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_components_charts_eventsChart_tsx"],{"./app/actionCreators/events.tsx":(e,t,s)=>{s.d(t,{lI:()=>l,eV:()=>d,JE:()=>p}),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=s("../node_modules/lodash/pick.js"),o=s.n(r),a=s("./app/components/charts/utils.tsx"),i=s("./app/utils/getPeriod.tsx"),n=s("./app/utils/performance/constants.tsx");const l=(e,{organization:t,project:s,environment:r,team:o,period:n,start:l,end:d,interval:p,comparisonDelta:c,includePrevious:u,query:m,yAxis:h,field:v,topEvents:g,orderby:y,partial:x,withoutZerofill:f,referrer:b,queryBatching:j,generatePathname:Z,queryExtras:D})=>{var S;const C=(0,a.Sw)(u,n),P={query:{...Object.fromEntries(Object.entries({interval:p,comparisonDelta:c,project:s,environment:r,team:o,query:m,yAxis:h,field:v,topEvents:g,orderby:y,partial:x?"1":void 0,withoutZerofill:f?"1":void 0,referrer:b||"api.organization-event-stats"}).filter((([,e])=>void 0!==e))),...(0,i.X)({period:n,start:l,end:d},{shouldDoublePeriod:C}),...D}},_=null!==(S=null==Z?void 0:Z(t))&&void 0!==S?S:"/organizations/".concat(t.slug,"/events-stats/");return null!=j&&j.batchRequest?j.batchRequest(e,_,P):e.requestPromise(_,P)};async function d(e,t,s){const r={...o()(s,Object.values(n.s)),query:s.query};return e.requestPromise("/organizations/".concat(t,"/events-facets/"),{query:r})}async function p(e,t,s){const r={...o()(s,Object.values(n.s)),query:s.query};return e.requestPromise("/organizations/".concat(t,"/events-meta/"),{query:r}).then((e=>e.count))}},"./app/components/charts/areaChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>l});var r=s("../node_modules/react/index.js"),o=s("./app/components/charts/series/lineSeries.tsx"),a=s("./app/components/charts/baseChart.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class n extends r.Component{render(){const{series:e,stacked:t,colors:s,...r}=this.props;return(0,i.tZ)(a.Z,{...r,colors:s,series:e.map((({seriesName:e,data:r,...a},i)=>function(e={}){return(0,o.Z)({...e})}({stack:t?"area":void 0,name:e,data:r.map((({name:e,value:t})=>[e,t])),lineStyle:{color:null==s?void 0:s[i],opacity:1,width:.4},areaStyle:{color:null==s?void 0:s[i],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...a})))})}}n.displayName="AreaChart";const l=n},"./app/components/charts/chartZoom.tsx":(e,t,s)=>{s.d(t,{Z:()=>v});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=s("../node_modules/react/index.js"),a=s("../node_modules/moment/moment.js"),i=s.n(a),n=s("../node_modules/query-string/index.js"),l=s("./app/actionCreators/pageFilters.tsx"),d=s("./app/components/charts/components/dataZoomInside.tsx"),p=s("./app/components/charts/components/toolBox.tsx"),c=s("./app/utils/callIfFunction.tsx"),u=s("./app/utils/dates.tsx");const m=e=>e?i().utc(e).format(i().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class h extends o.Component{constructor(e){super(e),(0,r.Z)(this,"history",void 0),(0,r.Z)(this,"currentPeriod",void 0),(0,r.Z)(this,"zooming",null),(0,r.Z)(this,"saveCurrentPeriod",(e=>{this.currentPeriod={period:e.period,start:m(e.start),end:m(e.end)}})),(0,r.Z)(this,"setPeriod",(({period:e,start:t,end:s},r=!1)=>{const{router:o,onZoom:a,usePageDate:i}=this.props,d=m(t),p=m(s);r&&this.history.push(this.currentPeriod),(0,c.g)(a,{period:e,start:d,end:p}),this.zooming=()=>{if(i&&o){const r={...o.location.query,pageStart:t?(0,u.v5)(t):void 0,pageEnd:s?(0,u.v5)(s):void 0,pageStatsPeriod:null!=e?e:void 0};n.stringify(r)!==n.stringify(o.location.query)&&o.push({pathname:o.location.pathname,query:r})}else(0,l.dR)({period:e,start:d?(0,u.hC)(d):d,end:p?(0,u.hC)(p):p},o);this.saveCurrentPeriod({period:e,start:t,end:s})}})),(0,r.Z)(this,"handleChartReady",(e=>{(0,c.g)(this.props.onChartReady,e)})),(0,r.Z)(this,"handleZoomRestore",((e,t)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],(0,c.g)(this.props.onRestore,e,t))})),(0,r.Z)(this,"handleDataZoom",((e,t)=>{const s=t.getModel(),{startValue:r,endValue:o}=s._payload.batch[0];if(null===r&&null===o){const e=this.history.pop();if(!e)return;this.setPeriod(e)}else{const e=i().utc(r),t=i().utc(o);this.setPeriod({period:null,start:e,end:t},!0)}(0,c.g)(this.props.onDataZoom,e,t)})),(0,r.Z)(this,"handleChartFinished",((e,t)=>{var s;"function"==typeof this.zooming&&(this.zooming(),this.zooming=null);const r=null===(s=t._componentsViews)||void 0===s?void 0:s.find((e=>e._features&&e._features.dataZoom));r&&!r._features.dataZoom._isZoomActive&&t.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,c.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(e)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:e,start:t,end:s,disabled:r,children:o,xAxisIndex:a,router:i,onZoom:n,onRestore:l,onChartReady:c,onDataZoom:m,onFinished:h,...v}=this.props,g=null!=e?e:void 0,y=t?(0,u.hC)(t):void 0,x=s?(0,u.hC)(s):void 0;return o(r?{utc:g,start:y,end:x,...v}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:g,start:y,end:x,dataZoom:(0,d.Z)({xAxisIndex:a}),showTimeInTooltip:!0,toolBox:(0,p.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...v})}}h.displayName="ChartZoom";const v=h},"./app/components/charts/components/visualMap.tsx":(e,t,s)=>{function r(e){return e}s.d(t,{Z:()=>r}),s("../node_modules/echarts/lib/component/visualMap.js")},"./app/components/charts/eventsChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>R});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),i=s("../node_modules/lodash/isEqual.js"),n=s.n(i),l=s("./app/components/charts/areaChart.tsx"),d=s("./app/components/charts/barChart.tsx"),p=s("./app/components/charts/chartZoom.tsx"),c=s("./app/components/charts/errorPanel.tsx"),u=s("./app/components/charts/lineChart.tsx"),m=s("./app/components/charts/releaseSeries.tsx"),h=s("./app/components/charts/transitionChart.tsx"),v=s("./app/components/charts/transparentLoadingMask.tsx"),g=s("./app/components/charts/utils.tsx"),y=s("./app/components/charts/worldMapChart.tsx"),x=s("./app/icons/index.tsx"),f=s("./app/locale.tsx"),b=s("./app/utils.tsx"),j=s("./app/utils/discover/charts.tsx"),Z=s("./app/utils/discover/fields.tsx"),D=s("./app/utils/queryString.tsx"),S=s("./app/components/charts/eventsGeoRequest.tsx"),C=s("./app/components/charts/eventsRequest.tsx"),P=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class _ extends o.Component{constructor(...e){super(...e),(0,r.Z)(this,"state",{seriesSelection:{},forceUpdate:!1}),(0,r.Z)(this,"handleLegendSelectChanged",(e=>{const{disableableSeries:t=[]}=this.props,{selected:s}=e,r=Object.keys(s).reduce(((e,r)=>{const o=["Releases","Other"].includes(r)||t.includes(r);return e[r]=!o||s[r],e}),{});this.setState({seriesSelection:r,forceUpdate:!0},(()=>this.setState({forceUpdate:!1})))}))}shouldComponentUpdate(e,t){return!(!t.forceUpdate&&n()(this.state.seriesSelection,t.seriesSelection)&&(e.reloading||!e.timeseriesData||n()(this.props.timeseriesData,e.timeseriesData)&&n()(this.props.releaseSeries,e.releaseSeries)&&n()(this.props.previousTimeseriesData,e.previousTimeseriesData)&&n()(this.props.tableData,e.tableData)))}getChartComponent(){const{showDaily:e,timeseriesData:t,yAxis:s,chartComponent:r}=this.props;if((0,b.ri)(r))return r;if(e)return d.Z;if(t.length>1)switch((0,Z.fD)(s)){case"line":return u.Z;case"area":return l.Z;default:throw new Error("Unknown multi plot type for ".concat(s))}return l.Z}renderWorldMap(){const{tableData:e,fromDiscover:t}=this.props,{data:s,title:r}=(0,g.JT)(e),o=[{seriesName:r,data:s}];return(0,P.tZ)(y.Z,{series:o,fromDiscover:t})}render(){var e,t;const{theme:s,loading:r,reloading:o,yAxis:a,releaseSeries:i,zoomRenderProps:n,timeseriesData:l,previousTimeseriesData:p,showLegend:c,legendOptions:u,chartOptions:m,currentSeriesNames:h,previousSeriesNames:v,seriesTransformer:x,previousSeriesTransformer:b,colors:Z,height:D,timeframe:S,topEvents:C,..._}=this.props,{seriesSelection:w}=this.state;let T=this.getChartComponent();if(typeof T==typeof y.Z)return this.renderWorldMap();T=T;const R=[...h.length>0?h:[(0,f.t)("Current")],...v.length>0?v:[(0,f.t)("Previous")]],k=(0,f.t)("Releases"),q=C&&C+1===l.length;q&&R.push("Other"),Array.isArray(i)&&R.push(k);const A=i&&i[0],M=Array.isArray(i)&&(null==A||null===(e=A.markLine)||void 0===e?void 0:e.data)&&A.markLine.data.length>=g.XO,z=Array.isArray(i)&&0===Object.keys(w).length&&M?{[k]:!1}:w,N=c?{right:16,top:12,data:R,selected:z,...null!=u?u:{}}:void 0;let O=Array.isArray(i)?[...l,...i]:l,E=p;var L;x&&(O=x(O)),b&&(E=null===(L=E)||void 0===L?void 0:L.map((e=>b(e))));const W=l.length?null!==(t=null==Z?void 0:Z.slice(0,O.length))&&void 0!==t?t:[...s.charts.getColorPalette(l.length-2-(q?1:0))]:void 0;W&&W.length&&q&&W.push(s.chartOther);const U={colors:W,grid:{left:"24px",right:"24px",top:"32px",bottom:"12px"},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",truncate:80,valueFormatter:e=>(0,j.CX)(e,a)},xAxis:S?{min:S.start,max:S.end}:void 0,yAxis:{axisLabel:{color:s.chartLabel,formatter:e=>(0,j.gu)(e,a)}},...null!=m?m:{},animation:typeof T!=typeof d.Z&&void 0};return(0,P.tZ)(T,{..._,...n,...U,legend:N,onLegendSelectChanged:this.handleLegendSelectChanged,series:O,previousPeriod:E||void 0,height:D})}}_.displayName="Chart";const w=(0,a.b)(_);class T extends o.Component{isStacked(){const{topEvents:e,yAxis:t}=this.props;return"number"==typeof e&&e>0||Array.isArray(t)&&t.length>1}render(){const{api:e,organization:t,period:s,utc:r,query:a,router:i,start:n,end:l,projects:d,environments:u,showLegend:b,minutesThresholdToDisplaySeconds:j,yAxis:_,disablePrevious:T,disableReleases:R,emphasizeReleases:k,currentSeriesName:q,previousSeriesName:A,seriesTransformer:M,previousSeriesTransformer:z,field:N,interval:O,showDaily:E,topEvents:L,orderby:W,confirmedQuery:U,colors:F,chartHeader:I,legendOptions:Q,chartOptions:B,preserveReleaseQueryParams:G,releaseQueryExtra:J,disableableSeries:V,chartComponent:X,usePageZoom:Y,height:H,withoutZerofill:K,fromDiscover:$,...ee}=this.props,te=!T&&!n&&!l,se=(0,D.qP)(_),re=se.map((e=>{let t=e&&(0,Z.GO)(e)?(0,Z.vp)(e):e;return t&&t.length>60&&(t=t.substr(0,60)+"..."),t})),oe=A?[A]:re.map((e=>(0,f.t)("previous %s",e))),ae=q?[q]:re,ie=E?"1d":O||(0,g.ZS)(this.props,"high");let ne=({zoomRenderProps:e,releaseSeries:t,errored:s,loading:r,reloading:a,results:i,timeseriesData:n,previousTimeseriesData:l,timeframe:d,tableData:p})=>{if(s)return(0,P.tZ)(c.Z,{children:(0,P.tZ)(x.FC,{color:"gray300",size:"lg"})});const u=i||n;return(0,P.BX)(h.Z,{loading:r,reloading:a,height:H?"".concat(H,"px"):void 0,children:[(0,P.tZ)(v.Z,{visible:a}),o.isValidElement(I)&&I,(0,P.tZ)(w,{zoomRenderProps:e,loading:r,reloading:a,showLegend:b,minutesThresholdToDisplaySeconds:j,releaseSeries:t||[],timeseriesData:null!=u?u:[],previousTimeseriesData:l,currentSeriesNames:ae,previousSeriesNames:oe,seriesTransformer:M,previousSeriesTransformer:z,stacked:this.isStacked(),yAxis:se[0],showDaily:E,colors:F,legendOptions:Q,chartOptions:B,disableableSeries:V,chartComponent:X,height:H,timeframe:d,topEvents:L,tableData:null!=p?p:[],fromDiscover:$})]})};if(!R){const e=ne;ne=t=>(0,P.tZ)(m.Z,{utc:r,period:s,start:n,end:l,projects:d,environments:u,emphasizeReleases:k,preserveQueryParams:G,queryExtra:J,children:({releaseSeries:s})=>e({...t,releaseSeries:s})})}return(0,P.tZ)(p.Z,{router:i,period:s,start:n,end:l,utc:r,usePageDate:Y,...ee,children:r=>X===y.Z?(0,P.tZ)(S.Z,{api:e,organization:t,yAxis:_,query:a,orderby:W,projects:d,period:s,start:n,end:l,environments:u,referrer:ee.referrer,children:({errored:e,loading:t,reloading:s,tableData:o})=>ne({errored:e,loading:t,reloading:s,zoomRenderProps:r,tableData:o})}):(0,P.tZ)(C.Z,{...ee,api:e,organization:t,period:s,project:d,environment:u,start:n,end:l,interval:ie,query:a,includePrevious:te,currentSeriesNames:ae,previousSeriesNames:oe,yAxis:_,field:N,orderby:W,topEvents:L,confirmedQuery:U,partial:!0,withoutZerofill:K&&!this.isStacked(),children:e=>ne({...e,zoomRenderProps:r})})})}}T.displayName="EventsChart";const R=T},"./app/components/charts/eventsGeoRequest.tsx":(e,t,s)=>{s.d(t,{Z:()=>n}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=s("../node_modules/react/index.js"),o=s("./app/utils/dates.tsx"),a=s("./app/utils/discover/eventView.tsx"),i=s("./app/utils/discover/genericDiscoverQuery.tsx");const n=({api:e,organization:t,yAxis:s,query:n,orderby:l,projects:d,period:p,start:c,end:u,environments:m,referrer:h,children:v})=>{const g=a.ZP.fromSavedQuery({id:void 0,name:"",version:2,fields:Array.isArray(s)?s:[s],query:n,orderby:null!=l?l:"",projects:d,range:null!=p?p:"",start:c?(0,o.v5)(c):void 0,end:u?(0,o.v5)(u):void 0,environment:m}),[y,x]=(0,r.useState)(void 0),[f,b]=(0,r.useState)(!1),[j,Z]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{Z(!1),y&&b(!0),(0,i.AA)(e,"/organizations/".concat(t.slug,"/events-geo/"),{...g.generateQueryStringObject(),referrer:h}).then((e=>{x([e[0]]),b(!1)})).catch((()=>{Z(!0),b(!1)}))}),[n,s,c,u,p,m,d]),v({errored:j,loading:!y&&!j,reloading:f,tableData:y})}},"./app/components/charts/eventsRequest.tsx":(e,t,s)=>{s.d(t,{Z:()=>f});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("../node_modules/lodash/isEqual.js"),i=s.n(a),n=s("../node_modules/lodash/omitBy.js"),l=s.n(n),d=s("./app/actionCreators/events.tsx"),p=s("./app/actionCreators/indicator.tsx"),c=s("./app/components/charts/loadingPanel.tsx"),u=s("./app/components/charts/utils.tsx"),m=s("./app/locale.tsx"),h=s("./app/utils/discover/fields.tsx"),v=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const g=["api","children","organization","loading","queryBatching","generatePathname"],y=e=>l()(e,((e,t)=>g.includes(t)));class x extends o.PureComponent{constructor(...e){super(...e),(0,r.Z)(this,"state",{reloading:!!this.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,r.Z)(this,"unmounting",!1),(0,r.Z)(this,"fetchData",(async()=>{const{api:e,confirmedQuery:t,expired:s,name:r,hideError:o,...a}=this.props;let i,n=null;if(!1!==t){if(this.setState((e=>({reloading:null!==e.timeseriesData,errored:!1,errorMessage:void 0}))),s)i=(0,m.t)("%s has an invalid date range. Please try a more recent date range.",r),(0,p.Iw)(i,{append:!0}),this.setState({errored:!0,errorMessage:i});else try{e.clear(),n=await(0,d.lI)(e,a)}catch(e){i=e&&e.responseJSON&&e.responseJSON.detail?e.responseJSON.detail:(0,m.t)("Error loading chart data"),o||(0,p.Iw)(i),this.setState({errored:!0,errorMessage:i})}this.unmounting||this.setState({reloading:!1,timeseriesData:n,fetchedWithPrevious:a.includePrevious})}})),(0,r.Z)(this,"getData",(e=>{const{fetchedWithPrevious:t}=this.state,{period:s,includePrevious:r}=this.props,o=t||(0,u.Sw)(r,s),a=Math.floor(e.length/2);return{current:o?e.slice(a):e,previous:o?e.slice(0,a):null}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){i()(y(e),y(this.props))||this.fetchData()}componentWillUnmount(){this.unmounting=!0}calculateTotalsPerTimestamp(e,t=(e=>1e3*e)){return e.map((([e,s],r)=>({name:t(e,s,r),value:s.reduce(((e,{count:t})=>e+t),0)})))}transformPreviousPeriodData(e,t,s){return t?{seriesName:null!=s?s:"Previous",data:this.calculateTotalsPerTimestamp(t,((t,s,r)=>1e3*e[r][0])),stack:"previous"}:null}transformAggregatedTimeseries(e,t=""){return{seriesName:t,data:this.calculateTotalsPerTimestamp(e)}}transformTimeseriesData(e,t){return[{seriesName:t||"Current",data:e.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{count:t})=>e+t),0)})))}]}transformComparisonTimeseriesData(e){return[{seriesName:"comparisonCount()",data:e.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{comparisonCount:t})=>e+(null!=t?t:0)),0)})))}]}processData(e,t=0,s){var r;const{data:o,totals:a}=e,{includeTransformedData:i,includeTimeAggregation:n,timeAggregationSeriesName:l,currentSeriesNames:d,previousSeriesNames:p,comparisonDelta:c}=this.props,{current:u,previous:m}=this.getData(o);return{data:i?this.transformTimeseriesData(u,null!=s?s:null==d?void 0:d[t]):[],comparisonData:i&&c?this.transformComparisonTimeseriesData(u):[],allData:o,originalData:u,totals:a,originalPreviousData:m,previousData:i?this.transformPreviousPeriodData(u,m,null!==(r=s?"previous ".concat(s):void 0)&&void 0!==r?r:null==p?void 0:p[t]):null,timeAggregatedData:n?this.transformAggregatedTimeseries(u,l||""):{},timeframe:e.start&&e.end?m?{start:500*(e.start+e.end),end:1e3*e.end}:{start:1e3*e.start,end:1e3*e.end}:void 0}}render(){const{children:e,showLoading:t,...s}=this.props,{timeseriesData:r,reloading:o,errored:a,errorMessage:i}=this.state,n=this.props.loading||null===r;if(t&&n)return(0,v.tZ)(c.Z,{"data-test-id":"events-request-loading"});if((0,u.Xe)(r)){let t;const l=Object.keys(r).map(((e,s)=>{const o=r[e],a=this.processData(o,s,(0,h.bQ)(e));return t||(t=a.timeframe),[o.order||0,a.data[0],a.previousData]})).sort(((e,t)=>e[0]-t[0])),d=l.map((e=>e[1])),p=l.some((e=>null===e[2]))?void 0:l.map((e=>e[2]));return e({loading:n,reloading:o,errored:a,errorMessage:i,results:d,timeframe:t,previousTimeseriesData:p,...s})}if(r){const{data:t,comparisonData:l,allData:d,originalData:p,totals:c,originalPreviousData:u,previousData:m,timeAggregatedData:h,timeframe:v}=this.processData(r);return e({loading:n,reloading:o,errored:a,errorMessage:i,timeseriesData:t,comparisonTimeseriesData:l,allTimeseriesData:d,originalTimeseriesData:p,timeseriesTotals:c,originalPreviousTimeseriesData:u,previousTimeseriesData:m?[m]:m,timeAggregatedData:h,timeframe:v,...s})}return e({loading:n,reloading:o,errored:a,errorMessage:i,...s})}}x.displayName="EventsRequest",(0,r.Z)(x,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",comparisonDelta:void 0,limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const f=x},"./app/components/charts/lineChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>n}),s("../node_modules/react/index.js");var r=s("./app/components/charts/series/lineSeries.tsx"),o=s("./app/components/charts/baseChart.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i({series:e,seriesOptions:t,...s}){return(0,a.tZ)(o.Z,{...s,series:e.map((({seriesName:e,data:s,dataArray:o,...a})=>(0,r.Z)({...t,...a,name:e,data:o||(null==s?void 0:s.map((({value:e,name:t})=>[t,e]))),animation:!1,animationThreshold:1,animationDuration:0})))})}i.displayName="LineChart";const n=i},"./app/components/charts/releaseSeries.tsx":(e,t,s)=>{s.d(t,{Z:()=>C});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("../node_modules/react-router/es/index.js"),i=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),n=s("../node_modules/lodash/isEqual.js"),l=s.n(n),d=s("../node_modules/lodash/memoize.js"),p=s.n(d),c=s("../node_modules/lodash/partition.js"),u=s.n(c),m=s("./app/actionCreators/indicator.tsx"),h=s("./app/components/charts/components/markLine.tsx"),v=s("./app/locale.tsx"),g=s("./app/utils.tsx"),y=s("./app/utils/dates.tsx"),x=s("./app/utils/formatters.tsx"),f=s("./app/utils/parseLinkHeader.tsx"),b=s("./app/utils/withApi.tsx"),j=s("./app/utils/withOrganization.tsx"),Z=s("./app/components/charts/utils.tsx");function D(e,t,s){const r={};return Object.keys(s).forEach((e=>{let t=s[e];!t||"start"!==e&&"end"!==e||(t=(0,y.v5)(t)),t&&(r[e]=t)})),e.clear(),e.requestPromise("/organizations/".concat(t.slug,"/releases/stats/"),{includeAllArgs:!0,method:"GET",query:r})}class S extends o.Component{constructor(...e){super(...e),(0,r.Z)(this,"state",{releases:null,releaseSeries:[]}),(0,r.Z)(this,"_isMounted",!1),(0,r.Z)(this,"getOrganizationReleasesMemoized",p()(((e,t,s)=>D(e,t,s)),((e,t,s)=>Object.values(s).map((e=>JSON.stringify(e))).join("-")))),(0,r.Z)(this,"getReleaseSeries",((e,t={})=>{const{organization:s,router:r,tooltip:o,environments:a,start:i,end:n,period:l,preserveQueryParams:d,queryExtra:p,theme:c}=this.props,u={...p};s.features.includes("global-views")&&(u.project=r.location.query.project),d&&(u.environment=[...a],u.start=i?(0,y.v5)(i):void 0,u.end=n?(0,y.v5)(n):void 0,u.statsPeriod=l||void 0);const m=(0,h.Z)({animation:!1,lineStyle:{color:c.purple300,opacity:.3,type:"solid",...t},label:{show:!1},data:e.map((e=>({xAxis:+new Date(e.date),name:(0,x.ko)(e.version,!0),value:(0,x.ko)(e.version,!0),onClick:()=>{r.push({pathname:"/organizations/".concat(s.slug,"/releases/").concat(e.version,"/"),query:u})},label:{formatter:()=>(0,x.ko)(e.version,!0)}}))),tooltip:o||{trigger:"item",formatter:({data:e})=>{const t=(0,y.L0)(e.value,"MMM D, YYYY LT",{local:!this.props.utc}),s=(0,g.YU)((0,x.ko)(e.name,!0));return['<div class="tooltip-series">','<div><span class="tooltip-label"><strong>'.concat((0,v.t)("Release"),"</strong></span> ").concat(s,"</div>"),"</div>",'<div class="tooltip-date">',t,"</div>","</div>",(0,Z.U8)()].join("")}}});return{seriesName:"Releases",color:c.purple200,data:[],markLine:m}}))}componentDidMount(){this._isMounted=!0;const{releases:e}=this.props;e?this.setReleasesWithSeries(e):this.fetchData()}componentDidUpdate(e){l()(e.projects,this.props.projects)&&l()(e.environments,this.props.environments)&&l()(e.start,this.props.start)&&l()(e.end,this.props.end)&&l()(e.period,this.props.period)&&l()(e.query,this.props.query)?l()(e.emphasizeReleases,this.props.emphasizeReleases)||this.setReleasesWithSeries(this.state.releases):this.fetchData()}componentWillUnmount(){this._isMounted=!1,this.props.api.clear()}async fetchData(){const{api:e,organization:t,projects:s,environments:r,period:o,start:a,end:i,memoized:n,query:l}=this.props,d={start:a,end:i,project:s,environment:r,statsPeriod:o,query:l};let p=!0;const c=[];for(;p;)try{const s=n?this.getOrganizationReleasesMemoized:D,[r,,o]=await s(e,t,d);c.push(...r),this._isMounted&&this.setReleasesWithSeries(c);const a=null==o?void 0:o.getResponseHeader("Link");if(a){var u,h;const e=(0,f.Z)(a);p=null!==(u=null==e||null===(h=e.next)||void 0===h?void 0:h.results)&&void 0!==u&&u,d.cursor=e.next.cursor}else p=!1}catch{(0,m.Iw)((0,v.t)("Error fetching releases")),p=!1}}setReleasesWithSeries(e){const{emphasizeReleases:t=[]}=this.props,s=[];if(t.length){const[r,o]=u()(e,(e=>!t.includes(e.version)));r.length&&s.push(this.getReleaseSeries(r,{type:"dotted"})),o.length&&s.push(this.getReleaseSeries(o,{opacity:.8}))}else s.push(this.getReleaseSeries(e));this.setState({releases:e,releaseSeries:s})}render(){const{children:e}=this.props;return e({releases:this.state.releases,releaseSeries:this.state.releaseSeries})}}S.displayName="ReleaseSeries";const C=(0,a.withRouter)((0,j.Z)((0,b.Z)((0,i.b)(S))))},"./app/components/charts/transitionChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>l});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),a=s("./app/components/charts/loadingPanel.tsx"),i=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class n extends o.Component{constructor(...e){super(...e),(0,r.Z)(this,"state",{prevReloading:this.props.reloading,prevLoading:this.props.loading,key:1})}static getDerivedStateFromProps(e,t){const s=t.prevReloading,r=e.reloading,o=t.prevLoading,a=e.loading;return o!==a?{prevReloading:r,prevLoading:a,key:t.key+1}:a?{prevReloading:r,prevLoading:a,key:t.key}:s&&!r?{prevReloading:r,prevLoading:a,key:t.key+1}:{prevReloading:r,prevLoading:a,key:t.key}}render(){const{height:e,loading:t,reloading:s}=this.props;return t&&!s?(0,i.tZ)(a.Z,{height:e,"data-test-id":"events-request-loading"}):(0,i.tZ)(o.Fragment,{children:this.props.children},String(this.state.key))}}n.displayName="TransitionChart",(0,r.Z)(n,"defaultProps",{height:"200px"});const l=n},"./app/components/charts/transparentLoadingMask.tsx":(e,t,s)=>{s.d(t,{Z:()=>i});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/react/index.js"),s("./app/components/loadingMask.tsx")),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,r.Z)((({className:e,visible:t,children:s,...r})=>{const i=t?{...r,"data-test-id":"loading-placeholder"}:r;return(0,a.tZ)(o.Z,{className:e,...i,children:s})}),{target:"ewtkxp50"})((e=>!e.visible&&"display: none;"),";opacity:0.4;z-index:1;")},"./app/components/charts/worldMapChart.tsx":(e,t,s)=>{s.d(t,{Z:()=>h});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.object.from-entries.js"),s("../node_modules/react/index.js")),a=s("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),i=s("../node_modules/echarts/lib/core/echarts.js"),n=s("../node_modules/lodash/max.js"),l=s.n(n),d=s("./app/components/charts/components/visualMap.tsx");s("../node_modules/echarts/lib/chart/map.js");var p=s("./app/components/charts/baseChart.tsx"),c=s("./app/components/charts/utils.tsx"),u=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m extends o.Component{constructor(...e){super(...e),(0,r.Z)(this,"state",{countryToCodeMap:null,map:null,codeToCountryMap:null})}async componentDidMount(){const[e,t]=await Promise.all([s.e("app_data_countryCodesMap_tsx").then(s.bind(s,"./app/data/countryCodesMap.tsx")),s.e("app_data_world_json").then(s.t.bind(s,"./app/data/world.json",19))]);i.je("sentryWorld",t.default),this.setState({countryToCodeMap:e.default,map:t.default,codeToCountryMap:Object.fromEntries(Object.entries(e.default).map((([e,t])=>[t,e])))})}render(){const{countryToCodeMap:e,map:t}=this.state;if(null===e||null===t)return null;const{series:s,seriesOptions:r,theme:o,fromDiscover:a,fromDiscoverQueryList:i,...n}=this.props,m=s.map((({seriesName:e,data:t,...s})=>{var n;return function(e={map:""}){return{roam:!0,...e,emphasis:{label:{show:!1},...e.emphasis},type:"map"}}({...r,...s,map:"sentryWorld",name:e,nameMap:null!==(n=this.state.countryToCodeMap)&&void 0!==n?n:void 0,aspectScale:.85,zoom:a?1.1:i?.9:1.3,center:[10.97,i?-12:9.71],itemStyle:{areaColor:o.gray200,borderColor:o.backgroundSecondary},emphasis:{itemStyle:{areaColor:o.pink300},label:{show:!1}},data:t,silent:i,roam:!i})})),h=l()(s.map((({data:e})=>l()(e.map((({value:e})=>e))))))||1;return(0,u.tZ)(p.Z,{options:{backgroundColor:i?void 0:o.background,visualMap:[(0,d.Z)({show:!i,left:a?void 0:"right",right:a?5:void 0,min:0,max:h,inRange:{color:[o.purple200,o.purple300]},text:["High","Low"],textStyle:{color:o.textColor},calculable:!1})]},...n,yAxis:null,xAxis:null,series:m,tooltip:{formatter:e=>{var t;const{marker:s,name:r,value:o}=Array.isArray(e)?e[0]:e;if(isNaN(o))return"";const a="number"==typeof o?o.toLocaleString():"",i=(null===(t=this.state.codeToCountryMap)||void 0===t?void 0:t[r])||r;return['<div class="tooltip-series tooltip-series-solo">\n                 <div><span class="tooltip-label">'.concat(s," <strong>").concat(i,"</strong></span> ").concat(a,"</div>\n              </div>"),(0,c.U8)()].join("")}},height:a?400:void 0})}}m.displayName="WorldMapChart";const h=(0,a.b)(m)},"./app/utils/getPeriod.tsx":(e,t,s)=>{s.d(t,{X:()=>n}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var r=s("../node_modules/moment/moment.js"),o=s.n(r),a=s("./app/constants/index.tsx"),i=s("./app/utils/dates.tsx");const n=({period:e,start:t,end:s},{shouldDoublePeriod:r}={})=>{if(e||t||s||(e=a.GY),e){if(!r)return{statsPeriod:e};const[,t,s]=e.match(/([0-9]+)([mhdw])/);return{statsPeriod:"".concat(2*parseInt(t,10)).concat(s)}}if(!t||!s)throw new Error("start and end required");const n=(0,i.v5)(t),l=(0,i.v5)(s);if(r){const e=o()(s).diff(o()(t)),r=o()(t).subtract(e);return{start:(0,i.v5)(r),end:l}}return{start:n,end:l}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_charts_eventsChart_tsx.230467cf74faf0a3d505dfcf81597dcf.js.map