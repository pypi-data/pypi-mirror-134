"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_integrationOrganizationLink_tsx"],{"./app/components/narrowLayout.tsx":(t,e,n)=>{n.d(e,{Z:()=>h});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),a=n("./app/actionCreators/account.tsx"),r=n("./app/api.tsx"),l=n("./app/icons/index.tsx"),d=n("./app/locale.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class g extends s.Component{constructor(...t){super(...t),(0,i.Z)(this,"api",new r.KU),(0,i.Z)(this,"handleLogout",(()=>{(0,a.kS)(this.api).then((()=>window.location.assign("/auth/login")))}))}UNSAFE_componentWillMount(){document.body.classList.add("narrow")}componentWillUnmount(){this.api.clear(),document.body.classList.remove("narrow")}render(){return(0,c.BX)("div",{className:"app",children:[(0,c.tZ)("div",{className:"pattern-bg"}),(0,c.tZ)("div",{className:"container",style:{maxWidth:this.props.maxWidth},children:(0,c.BX)("div",{className:"box box-modal",children:[(0,c.BX)("div",{className:"box-header",children:[(0,c.tZ)("a",{href:"/",children:(0,c.tZ)(l.iW,{size:"lg"})}),this.props.showLogout&&(0,c.tZ)("a",{className:"logout pull-right",onClick:this.handleLogout,children:(0,c.tZ)(p,{children:(0,d.t)("Sign out")})})]}),(0,c.tZ)("div",{className:"box-content with-padding",children:this.props.children})]})})]})}}g.displayName="NarrowLayout";const p=(0,o.Z)("span",{target:"eaq1ri90"})({name:"11g4mt0",styles:"font-size:16px"}),h=g},"./app/views/asyncView.tsx":(t,e,n)=>{n.d(e,{Z:()=>a}),n("../node_modules/react/index.js");var i=n("./app/components/asyncComponent.tsx"),o=n("./app/components/sentryDocumentTitle.tsx"),s=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends i.Z{getTitle(){return""}render(){return(0,s.tZ)(o.Z,{title:this.getTitle(),children:this.renderComponent()})}}a.displayName="AsyncView"},"./app/views/integrationOrganizationLink.tsx":(t,e,n)=>{n.r(e),n.d(e,{default:()=>z});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/react/index.js")),a=n("../node_modules/react-select/dist/chunk-80640036.browser.esm.js"),r=n("../node_modules/@sentry/utils/esm/object.js"),l=n("./app/actionCreators/indicator.tsx"),d=n("./app/components/alert.tsx"),c=n("./app/components/button.tsx"),g=n("./app/components/forms/selectControl.tsx"),p=n("./app/components/idBadge/index.tsx"),h=n("./app/components/loadingIndicator.tsx"),u=n("./app/components/narrowLayout.tsx"),m=n("./app/icons/index.tsx"),w=n("./app/locale.tsx"),y=n("./app/utils/integrationUtil.tsx"),Z=n("./app/utils/marked.tsx"),x=n("./app/views/asyncView.tsx"),v=n("./app/views/organizationIntegrations/addIntegration.tsx"),f=n("./app/views/settings/components/forms/field/index.tsx"),b=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class z extends x.Z{constructor(...t){super(...t),(0,i.Z)(this,"disableErrorReport",!1),(0,i.Z)(this,"trackIntegrationAnalytics",((t,e)=>{const{organization:n,provider:i}=this.state;n&&i&&(0,y.Db)(t,{integration_type:"first_party",integration:i.key,already_installed:!1,view:"external_install",organization:n},{startSession:!!e})})),(0,i.Z)(this,"getOrgBySlug",(t=>this.state.organizations.find((e=>e.slug===t)))),(0,i.Z)(this,"onSelectOrg",(async({value:t})=>{this.setState({selectedOrgSlug:t,reloading:!0,organization:void 0});try{const[e,{providers:n}]=await Promise.all([this.api.requestPromise("/organizations/".concat(t,"/")),this.api.requestPromise("/organizations/".concat(t,"/config/integrations/?provider_key=").concat(this.integrationSlug))]);if(0===n.length)throw new Error("Invalid provider");this.setState({organization:e,reloading:!1,provider:n[0]},this.trackOpened)}catch(t){(0,l.Iw)((0,w.t)("Failed to retrieve organization or integration details")),this.setState({reloading:!1})}})),(0,i.Z)(this,"hasAccess",(()=>{const{organization:t}=this.state;return null==t?void 0:t.access.includes("org:integrations")})),(0,i.Z)(this,"onInstallWithInstallationId",(t=>{const{organization:e}=this.state,n=e&&e.slug;this.props.router.push("/settings/".concat(n,"/integrations/").concat(t.provider.key,"/").concat(t.id,"/"))})),(0,i.Z)(this,"finishInstallation",(()=>{const{selectedOrgSlug:t}=this.state,e={orgSlug:t,...this.queryParams};this.trackInstallationStart(),window.location.assign("/extensions/".concat(this.integrationSlug,"/configure/?").concat((0,r._j)(e)))})),(0,i.Z)(this,"customOption",(t=>{const e=this.getOrgBySlug(t.value);return e?(0,b.tZ)(a.y.Option,{...t,children:(0,b.tZ)(p.Z,{organization:e,avatarSize:20,displayName:e.name,avatarProps:{consistentWidth:!0}})}):null})),(0,i.Z)(this,"customValueContainer",(t=>{const e=t.getValue();if(0===e.length)return(0,b.tZ)(a.y.ValueContainer,{...t});const n=e[0].value,i=this.getOrgBySlug(n);return i?(0,b.tZ)(a.y.ValueContainer,{...t,children:(0,b.tZ)(p.Z,{organization:i,avatarSize:20,displayName:i.name,avatarProps:{consistentWidth:!0}})}):(0,b.tZ)(a.y.ValueContainer,{...t})}))}getEndpoints(){return[["organizations","/organizations/"]]}getTitle(){return(0,w.t)("Choose Installation Organization")}trackOpened(){this.trackIntegrationAnalytics("integrations.integration_viewed",!0)}trackInstallationStart(){this.trackIntegrationAnalytics("integrations.installation_start")}get integrationSlug(){return this.props.params.integrationSlug}get queryParams(){return this.props.location.query}onLoadAllEndpointsSuccess(){const{organizations:t}=this.state;1===t.length&&this.onSelectOrg({value:t[0].slug})}renderAddButton(){const{installationId:t}=this.props.params,{organization:e,provider:n}=this.state;if(!n||!e)return null;const{features:i}=n.metadata,o=i.map((t=>({featureGate:t.featureGate,description:(0,b.tZ)(j,{dangerouslySetInnerHTML:{__html:(0,Z.A)(t.description)}})}))),{IntegrationDirectoryFeatures:s}=(0,y.bh)();return(0,b.tZ)(s,{organization:e,features:o,children:({disabled:i})=>(0,b.tZ)(v.Z,{provider:n,onInstall:this.onInstallWithInstallationId,organization:e,children:e=>(0,b.tZ)(S,{children:(0,b.tZ)(c.ZP,{priority:"primary",disabled:!this.hasAccess()||i,onClick:()=>t?e({installation_id:t}):this.finishInstallation(),children:(0,w.t)("Install %s",n.name)})})})})}renderBottom(){const{organization:t,selectedOrgSlug:e,provider:n,reloading:i}=this.state,{FeatureList:o}=(0,y.bh)();return i?(0,b.tZ)(h.Z,{}):(0,b.BX)(s.Fragment,{children:[e&&t&&!this.hasAccess()&&(0,b.BX)(d.Z,{type:"error",icon:(0,b.tZ)(m.Gy,{size:"md"}),children:[(0,b.tZ)("p",{children:(0,w._N)("You do not have permission to install integrations in\n                [organization]. Ask an organization owner or manager to\n                visit this page to finish installing this integration.",{organization:(0,b.tZ)("strong",{children:t.slug})})}),(0,b.tZ)(_,{children:window.location.href})]}),n&&t&&this.hasAccess()&&o&&(0,b.BX)(s.Fragment,{children:[(0,b.tZ)("p",{children:(0,w._N)("The following features will be available for [organization] when installed.",{organization:(0,b.tZ)("strong",{children:t.slug})})}),(0,b.tZ)(o,{organization:t,features:n.metadata.features,provider:n})]}),(0,b.tZ)("div",{className:"form-actions",children:this.renderAddButton()})]})}renderBody(){const{selectedOrgSlug:t}=this.state,e=this.state.organizations.map((t=>({value:t.slug,label:t.name})));return(0,b.BX)(u.Z,{children:[(0,b.tZ)("h3",{children:(0,w.t)("Finish integration installation")}),(0,b.tZ)("p",{children:(0,w._N)("Please pick a specific [organization:organization] to link with\n            your integration installation of [integation].",{organization:(0,b.tZ)("strong",{}),integation:(0,b.tZ)("strong",{children:this.integrationSlug})})}),(0,b.tZ)(f.Z,{label:(0,w.t)("Organization"),inline:!1,stacked:!0,required:!0,children:(0,b.tZ)(g.Z,{onChange:this.onSelectOrg,value:t,placeholder:(0,w.t)("Select an organization"),options:e,components:{Option:this.customOption,ValueContainer:this.customValueContainer}})}),this.renderBottom()]})}}const _=(0,o.Z)("pre",{target:"e6s0axp2"})({name:"1iee5id",styles:"margin-bottom:0;background:#fbe3e1"}),j=(0,o.Z)("span",{target:"e6s0axp1"})({name:"1gt2cgk",styles:"line-height:24px"}),S=(0,o.Z)("div",{target:"e6s0axp0"})({name:"ur67by",styles:"margin-left:auto;align-self:center;display:flex;flex-direction:column;align-items:center"})},"./app/views/organizationIntegrations/addIntegration.tsx":(t,e,n)=>{n.d(e,{Z:()=>d});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),s=n("../node_modules/query-string/index.js"),a=n("./app/actionCreators/indicator.tsx"),r=n("./app/locale.tsx"),l=n("./app/utils/integrationUtil.tsx");class d extends o.Component{constructor(...t){super(...t),(0,i.Z)(this,"dialog",null),(0,i.Z)(this,"openDialog",(t=>{const{account:e,analyticsParams:n,modalParams:i,organization:o,provider:a}=this.props;(0,l.Db)("integrations.installation_start",{integration:a.key,integration_type:"first_party",organization:o,...n});const{url:r,width:d,height:c}=a.setupDialog,{left:g,top:p}=this.computeCenteredWindow(d,c);let h={...t};e&&(h.account=e),i&&(h={...h,...i});const u="".concat(r,"?").concat(s.stringify(h)),m="scrollbars=yes,width=".concat(d,",height=").concat(c,",top=").concat(p,",left=").concat(g);this.dialog=window.open(u,"sentryAddIntegration",m),this.dialog&&this.dialog.focus()})),(0,i.Z)(this,"didReceiveMessage",(t=>{const{analyticsParams:e,onInstall:n,organization:i,provider:o}=this.props;if(t.origin!==document.location.origin)return;if(t.source!==this.dialog)return;const{success:s,data:d}=t.data;this.dialog=null,s?d&&((0,l.Db)("integrations.installation_complete",{integration:o.key,integration_type:"first_party",organization:i,...e}),(0,a.S9)((0,r.t)("%s added",o.name)),n(d)):(0,a.Iw)(d.error)}))}componentDidMount(){window.addEventListener("message",this.didReceiveMessage)}componentWillUnmount(){window.removeEventListener("message",this.didReceiveMessage),this.dialog&&this.dialog.close()}computeCenteredWindow(t,e){const n=void 0!==window.screenLeft?window.screenLeft:window.screenX,i=void 0!==window.screenTop?window.screenTop:window.screenY;return{left:(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-t/2+n,top:(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-e/2+i}}render(){const{children:t}=this.props;return t(this.openDialog)}}d.displayName="AddIntegration"}}]);
//# sourceMappingURL=../sourcemaps/app_views_integrationOrganizationLink_tsx.6e9bdd60416d42a7a49bbfb4a202e38c.js.map