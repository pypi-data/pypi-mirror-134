(self.webpackChunk=self.webpackChunk||[]).push([["app_views_sentryAppExternalInstallation_tsx"],{"./app/actionCreators/sentryAppInstallations.tsx":(e,t,n)=>{"use strict";n.d(t,{G:()=>i,W:()=>a});var s=n("./app/actionCreators/indicator.tsx"),r=n("./app/locale.tsx");function i(e,t,n){(0,s.E3)();const i=e.requestPromise("/organizations/".concat(t,"/sentry-app-installations/"),{method:"POST",data:{slug:n.slug}});return i.then((()=>(0,s.B8)()),(()=>(0,s.Iw)((0,r.t)("Unable to install ".concat(n.name))))),i}function a(e,t){(0,s.E3)();const n=e.requestPromise("/sentry-app-installations/".concat(t.uuid,"/"),{method:"DELETE"});return n.then((()=>{(0,s.S9)((0,r.t)("".concat(t.app.slug," successfully uninstalled.")))}),(()=>(0,s.B8)())),n}},"./app/components/narrowLayout.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),a=n("./app/actionCreators/account.tsx"),o=n("./app/api.tsx"),l=n("./app/icons/index.tsx"),d=n("./app/locale.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class p extends i.Component{constructor(...e){super(...e),(0,s.Z)(this,"api",new o.KU),(0,s.Z)(this,"handleLogout",(()=>{(0,a.kS)(this.api).then((()=>window.location.assign("/auth/login")))}))}UNSAFE_componentWillMount(){document.body.classList.add("narrow")}componentWillUnmount(){this.api.clear(),document.body.classList.remove("narrow")}render(){return(0,c.BX)("div",{className:"app",children:[(0,c.tZ)("div",{className:"pattern-bg"}),(0,c.tZ)("div",{className:"container",style:{maxWidth:this.props.maxWidth},children:(0,c.BX)("div",{className:"box box-modal",children:[(0,c.BX)("div",{className:"box-header",children:[(0,c.tZ)("a",{href:"/",children:(0,c.tZ)(l.iW,{size:"lg"})}),this.props.showLogout&&(0,c.tZ)("a",{className:"logout pull-right",onClick:this.handleLogout,children:(0,c.tZ)(g,{children:(0,d.t)("Sign out")})})]}),(0,c.tZ)("div",{className:"box-content with-padding",children:this.props.children})]})})]})}}p.displayName="NarrowLayout";const g=(0,r.Z)("span",{target:"eaq1ri90"})({name:"11g4mt0",styles:"font-size:16px"}),u=p},"./app/components/sentryAppIcon.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>a}),n("../node_modules/react/index.js");var s=n("./app/components/avatar/sentryAppAvatar.tsx"),r=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=({sentryApp:e,size:t})=>(0,r.tZ)(s.Z,{sentryApp:e,size:t,isColor:!0});i.displayName="SentryAppIcon";const a=i},"./app/utils/consolidatedScopes.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>y,m:()=>h}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=n("../node_modules/lodash/groupBy.js"),r=n.n(s),i=n("../node_modules/lodash/invertBy.js"),a=n.n(i),o=n("../node_modules/lodash/pick.js"),l=n.n(o);const d={read:0,write:1,admin:2},c={project:"Project",team:"Team",release:"Release",event:"Event",org:"Organization",member:"Member"},p={Project:"no-access",Team:"no-access",Release:"no-access",Event:"no-access",Organization:"no-access",Member:"no-access"},g="project:releases",u=e=>{const t=e.split(":")[1];return d[t]},m=(e,t)=>u(e)-u(t);function h(e){const t={...p};let n=[...e];var s;return e.includes(g)&&(t.Release="admin",n=e.filter((e=>e!==g))),(s=n,Object.values(r()(s,(e=>e.split(":")[0]))).map((e=>e.sort(m))).map((e=>e.pop()))).forEach((e=>{if(e){const[n,s]=e.split(":");t[c[n]]=s}})),t}function y(e){const t=h(e);return{read:[],write:[],admin:[],...l()(a()(t),["read","write","admin"])}}},"./app/views/asyncView.tsx":(e,t,n)=>{"use strict";n.d(t,{Z:()=>a}),n("../node_modules/react/index.js");var s=n("./app/components/asyncComponent.tsx"),r=n("./app/components/sentryDocumentTitle.tsx"),i=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class a extends s.Z{getTitle(){return""}render(){return(0,i.tZ)(r.Z,{title:this.getTitle(),children:this.renderComponent()})}}a.displayName="AsyncView"},"./app/views/sentryAppExternalInstallation.tsx":(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>U});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("./app/actionCreators/indicator.tsx")),a=n("./app/actionCreators/sentryAppInstallations.tsx"),o=n("./app/components/alert.tsx"),l=n("./app/components/avatar/organizationAvatar.tsx"),d=n("./app/components/forms/selectControl.tsx"),c=(n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/react/index.js")),p=n("./app/components/acl/access.tsx"),g=n("./app/components/asyncComponent.tsx"),u=n("./app/components/button.tsx"),m=n("./app/components/circleIndicator.tsx"),h=n("./app/components/sentryAppIcon.tsx"),y=n("./app/components/tag.tsx"),Z=n("./app/icons/index.tsx"),x=n("./app/locale.tsx"),v=n("./app/styles/space.tsx"),b=n("./app/utils/consolidatedScopes.tsx"),_=n("./app/utils/integrationUtil.tsx"),w=n("./app/utils/marked.tsx"),j=n("./app/utils/recordSentryAppInteraction.tsx"),z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class A extends g.Z{componentDidUpdate(e){this.props.organization.id!==e.organization.id&&this.trackOpened()}componentDidMount(){this.trackOpened()}trackOpened(){const{sentryApp:e,organization:t,isInstalled:n}=this.props;(0,j.E)(e.slug,"sentry_app_viewed"),(0,_.Db)("integrations.install_modal_opened",{integration_type:"sentry_app",integration:e.slug,already_installed:n,view:"external_install",integration_status:e.status,organization:t},{startSession:!0})}getEndpoints(){const{sentryApp:e}=this.props;return[["featureData","/sentry-apps/".concat(e.slug,"/features/")]]}featureTags(e){return e.map((e=>{const t=e.featureGate.replace(/integrations/g,"");return(0,z.tZ)(F,{children:t.replace(/-/g," ")},t)}))}get permissions(){return(0,b.A)(this.props.sentryApp.scopes)}async onInstall(){const{onInstall:e}=this.props;try{await e()}catch(e){}}renderPermissions(){const e=this.permissions;return 0===Object.keys(e).filter((t=>e[t].length>0)).length?null:(0,z.BX)(c.Fragment,{children:[(0,z.tZ)(X,{children:"Permissions"}),e.read.length>0&&(0,z.BX)(C,{children:[(0,z.tZ)(P,{}),(0,z.tZ)(k,{children:(0,x._N)("[read] access to [resources] resources",{read:(0,z.tZ)("strong",{children:"Read"}),resources:e.read.join(", ")})},"read")]}),e.write.length>0&&(0,z.BX)(C,{children:[(0,z.tZ)(P,{}),(0,z.tZ)(k,{children:(0,x._N)("[read] and [write] access to [resources] resources",{read:(0,z.tZ)("strong",{children:"Read"}),write:(0,z.tZ)("strong",{children:"Write"}),resources:e.write.join(", ")})},"write")]}),e.admin.length>0&&(0,z.BX)(C,{children:[(0,z.tZ)(P,{}),(0,z.tZ)(k,{children:(0,x._N)("[admin] access to [resources] resources",{admin:(0,z.tZ)("strong",{children:"Admin"}),resources:e.admin.join(", ")})},"admin")]})]})}renderBody(){const{sentryApp:e,closeModal:t,isInstalled:n,organization:s}=this.props,{featureData:r}=this.state,i=(r||[]).map((e=>({featureGate:e.featureGate,description:(0,z.tZ)("span",{dangerouslySetInnerHTML:{__html:(0,w.A)(e.description)}})}))),{FeatureList:a,IntegrationFeatures:o}=(0,_.bh)(),l=e.overview||"",d={organization:s,features:i};return(0,z.BX)(c.Fragment,{children:[(0,z.BX)(f,{children:[(0,z.tZ)(h.Z,{sentryApp:e,size:50}),(0,z.BX)(S,{children:[(0,z.tZ)(I,{children:e.name}),!!i.length&&(0,z.tZ)(L,{children:this.featureTags(i)})]})]}),(0,z.tZ)(O,{dangerouslySetInnerHTML:{__html:(0,w.Z)(l)}}),(0,z.tZ)(a,{...d,provider:{...e,key:e.slug}}),(0,z.tZ)(o,{...d,children:({disabled:r,disabledReason:i})=>(0,z.BX)(c.Fragment,{children:[!r&&this.renderPermissions(),(0,z.BX)(E,{children:[(0,z.tZ)(N,{children:(0,x.t)("Authored By %s",e.author)}),(0,z.BX)("div",{children:[r&&(0,z.tZ)(B,{reason:i}),(0,z.tZ)(u.ZP,{size:"small",onClick:t,children:(0,x.t)("Cancel")}),(0,z.tZ)(p.Z,{organization:s,access:["org:integrations"],children:({hasAccess:e})=>e&&(0,z.tZ)(u.ZP,{size:"small",priority:"primary",disabled:n||r,onClick:()=>this.onInstall(),style:{marginLeft:(0,v.Z)(1)},"data-test-id":"install",children:(0,x.t)("Accept & Install")})})]})]})]})})]})}}const f=(0,r.Z)("div",{target:"e1hor01j12"})("display:grid;grid-template-columns:max-content 1fr;gap:",(0,v.Z)(1),";align-items:center;margin-bottom:",(0,v.Z)(2),";"),S=(0,r.Z)("div",{target:"e1hor01j11"})({name:"4runny",styles:"display:grid;grid-template-rows:max-content max-content;align-items:start"}),I=(0,r.Z)("div",{target:"e1hor01j10"})({name:"1k5apmu",styles:"font-weight:bold;font-size:1.4em"}),O=(0,r.Z)("div",{target:"e1hor01j9"})("margin-bottom:",(0,v.Z)(2),";li{margin-bottom:6px;}"),N=(0,r.Z)("div",{target:"e1hor01j8"})("color:",(e=>e.theme.gray300),";"),B=(0,r.Z)((({reason:e,...t})=>(0,z.BX)("div",{...t,children:[(0,z.tZ)(Z.Gy,{color:"red300",size:"1.5em"}),e]})),{target:"e1hor01j7"})("display:grid;align-items:center;flex:1;grid-template-columns:max-content 1fr;color:",(e=>e.theme.red300),";font-size:0.9em;"),k=(0,r.Z)("p",{target:"e1hor01j6"})({name:"1x9ekz7",styles:"margin:0px 6px"}),C=(0,r.Z)("div",{target:"e1hor01j5"})({name:"zjik7",styles:"display:flex"}),E=(0,r.Z)("div",{target:"e1hor01j4"})({name:"1348q18",styles:"display:flex;padding:20px 30px;border-top:1px solid #e2dee6;margin:20px -30px -30px;justify-content:space-between"}),X=(0,r.Z)("p",{target:"e1hor01j3"})("margin-bottom:",(0,v.Z)(1),";font-weight:bold;"),P=(0,r.Z)((e=>(0,z.tZ)(m.Z,{size:7,...e})),{target:"e1hor01j2"})("margin-top:7px;color:",(e=>e.theme.success),";"),L=(0,r.Z)("div",{target:"e1hor01j1"})("margin:-",(0,v.Z)(.5),";"),F=(0,r.Z)(y.Z,{target:"e1hor01j0"})("padding:",(0,v.Z)(.5),";");var M=n("./app/components/narrowLayout.tsx"),T=n("./app/utils/queryString.tsx"),q=n("./app/views/asyncView.tsx"),D=n("./app/views/settings/components/forms/field/index.tsx");class U extends q.Z{constructor(...e){super(...e),(0,s.Z)(this,"disableErrorReport",!1),(0,s.Z)(this,"hasAccess",(e=>e.access.includes("org:integrations"))),(0,s.Z)(this,"onClose",(()=>{const{selectedOrgSlug:e}=this.state,t=document.referrer||"/settings/".concat(e,"/integrations/");window.location.assign(t)})),(0,s.Z)(this,"onInstall",(async()=>{const{organization:e,sentryApp:t}=this.state;if(!e||!t)return;(0,_.Db)("integrations.installation_start",{integration_type:"sentry_app",integration:t.slug,view:"external_install",integration_status:t.status,organization:e});const n=await(0,a.G)(this.api,e.slug,t);if("installed"===n.status&&(0,_.Db)("integrations.installation_complete",{integration_type:"sentry_app",integration:t.slug,view:"external_install",integration_status:t.status,organization:e}),t.redirectUrl){const s={installationId:n.uuid,code:n.code,orgSlug:e.slug},r=(0,T.Yi)(t.redirectUrl,s);return window.location.assign(r)}return this.onClose()})),(0,s.Z)(this,"onSelectOrg",(async e=>{this.setState({selectedOrgSlug:e,reloading:!0});try{const[t,n]=await Promise.all([this.api.requestPromise("/organizations/".concat(e,"/")),this.api.requestPromise("/organizations/".concat(e,"/sentry-app-installations/"))]),s=n.map((e=>e.app.slug)).includes(this.sentryAppSlug);this.setState({organization:t,isInstalled:s,reloading:!1})}catch(e){(0,i.Iw)((0,x.t)("Failed to retrieve organization or integration details")),this.setState({reloading:!1})}})),(0,s.Z)(this,"onRequestSuccess",(({stateKey:e,data:t})=>{"organizations"===e&&1===t.length&&this.onSelectOrg(t[0].slug)}))}getDefaultState(){return{...super.getDefaultState(),selectedOrgSlug:null,organization:null,organizations:[],reloading:!1}}getEndpoints(){return[["organizations","/organizations/"],["sentryApp","/sentry-apps/".concat(this.sentryAppSlug,"/")]]}getTitle(){return(0,x.t)("Choose Installation Organization")}get sentryAppSlug(){return this.props.params.sentryAppSlug}get isSingleOrg(){return 1===this.state.organizations.length}get isSentryAppInternal(){const{sentryApp:e}=this.state;return e&&"internal"===e.status}get isSentryAppUnavailableForOrg(){var e;const{sentryApp:t,selectedOrgSlug:n}=this.state;return n&&(null==t||null===(e=t.owner)||void 0===e?void 0:e.slug)!==n&&"unpublished"===t.status}get disableInstall(){const{reloading:e,isInstalled:t}=this.state;return t||e||this.isSentryAppUnavailableForOrg}getOptions(){return this.state.organizations.map((e=>({value:e.slug,label:(0,z.BX)("div",{children:[(0,z.tZ)(l.Z,{organization:e}),(0,z.tZ)(R,{children:e.slug})]},e.slug)})))}renderInternalAppError(){const{sentryApp:e}=this.state;return(0,z.tZ)(o.Z,{type:"error",icon:(0,z.tZ)(Z.Gy,{size:"md"}),children:(0,x._N)("Integration [sentryAppName] is an internal integration. Internal integrations are automatically installed",{sentryAppName:(0,z.tZ)("strong",{children:e.name})})})}checkAndRenderError(){const{organization:e,selectedOrgSlug:t,isInstalled:n,sentryApp:s}=this.state;if(t&&e&&!this.hasAccess(e))return(0,z.BX)(o.Z,{type:"error",icon:(0,z.tZ)(Z.Gy,{size:"md"}),children:[(0,z.tZ)("p",{children:(0,x._N)("You do not have permission to install integrations in\n          [organization]. Ask an organization owner or manager to\n          visit this page to finish installing this integration.",{organization:(0,z.tZ)("strong",{children:e.slug})})}),(0,z.tZ)(G,{children:window.location.href})]});if(n&&e)return(0,z.tZ)(o.Z,{type:"error",icon:(0,z.tZ)(Z.Gy,{size:"md"}),children:(0,x._N)("Integration [sentryAppName] already installed for [organization]",{organization:(0,z.tZ)("strong",{children:e.name}),sentryAppName:(0,z.tZ)("strong",{children:s.name})})});if(this.isSentryAppUnavailableForOrg){var r,i;const e=null!==(r=null==s||null===(i=s.owner)||void 0===i?void 0:i.slug)&&void 0!==r?r:"another organization";return(0,z.tZ)(o.Z,{type:"error",icon:(0,z.tZ)(Z.Gy,{size:"md"}),children:(0,x._N)("Integration [sentryAppName] is an unpublished integration for [otherOrg]. An unpublished integration can only be installed on the organization which created it.",{sentryAppName:(0,z.tZ)("strong",{children:s.name}),otherOrg:(0,z.tZ)("strong",{children:e})})})}return null}renderMultiOrgView(){const{selectedOrgSlug:e,sentryApp:t}=this.state;return(0,z.BX)("div",{children:[(0,z.tZ)("p",{children:(0,x._N)("Please pick a specific [organization:organization] to install [sentryAppName]",{organization:(0,z.tZ)("strong",{}),sentryAppName:(0,z.tZ)("strong",{children:t.name})})}),(0,z.tZ)(D.Z,{label:(0,x.t)("Organization"),inline:!1,stacked:!0,required:!0,children:()=>(0,z.tZ)(d.Z,{onChange:({value:e})=>this.onSelectOrg(e),value:e,placeholder:(0,x.t)("Select an organization"),options:this.getOptions()})})]})}renderSingleOrgView(){const{organizations:e,sentryApp:t}=this.state,n=e[0].name;return(0,z.tZ)("div",{children:(0,z.tZ)("p",{children:(0,x._N)("You are installing [sentryAppName] for organization [organization]",{organization:(0,z.tZ)("strong",{children:n}),sentryAppName:(0,z.tZ)("strong",{children:t.name})})})})}renderMainContent(){const{organization:e,sentryApp:t}=this.state;return(0,z.BX)("div",{children:[(0,z.tZ)(W,{children:this.isSingleOrg?this.renderSingleOrgView():this.renderMultiOrgView()}),this.checkAndRenderError(),e&&(0,z.tZ)(A,{sentryApp:t,organization:e,onInstall:this.onInstall,closeModal:this.onClose,isInstalled:this.disableInstall})]})}renderBody(){return(0,z.tZ)(M.Z,{children:(0,z.BX)(V,{children:[(0,z.tZ)("h3",{children:(0,x.t)("Finish integration installation")}),this.isSentryAppInternal?this.renderInternalAppError():this.renderMainContent()]})})}}const G=(0,r.Z)("pre",{target:"e14lyx9n3"})({name:"1iee5id",styles:"margin-bottom:0;background:#fbe3e1"}),R=(0,r.Z)("span",{target:"e14lyx9n2"})({name:"1qkltea",styles:"margin-left:5px"}),V=(0,r.Z)("div",{target:"e14lyx9n1"})({name:"qkomnt",styles:"margin-bottom:40px"}),W=(0,r.Z)("div",{target:"e14lyx9n0"})({name:"1azpx8r",styles:"margin-bottom:20px"})},"../node_modules/lodash/_baseInverter.js":(e,t,n)=>{var s=n("../node_modules/lodash/_baseForOwn.js");e.exports=function(e,t,n,r){return s(e,(function(e,s,i){t(r,n(e),s,i)})),r}},"../node_modules/lodash/_createInverter.js":(e,t,n)=>{var s=n("../node_modules/lodash/_baseInverter.js");e.exports=function(e,t){return function(n,r){return s(n,e,t(r),{})}}},"../node_modules/lodash/invertBy.js":(e,t,n)=>{var s=n("../node_modules/lodash/_baseIteratee.js"),r=n("../node_modules/lodash/_createInverter.js"),i=Object.prototype,a=i.hasOwnProperty,o=i.toString,l=r((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=o.call(t)),a.call(e,t)?e[t].push(n):e[t]=[n]}),s);e.exports=l}}]);
//# sourceMappingURL=../sourcemaps/app_views_sentryAppExternalInstallation_tsx.30dd37f15fe96cc0056ad5305e2dff24.js.map