"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_dataExport_dataDownload_tsx"],{"./app/components/dataExport.tsx":(e,t,r)=>{r.d(t,{tD:()=>w,ZP:()=>Z});var o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),s=r("../node_modules/lodash/debounce.js"),i=r.n(s),a=r("../node_modules/lodash/isEqual.js"),d=r.n(a),l=r("./app/actionCreators/indicator.tsx"),c=r("./app/components/acl/feature.tsx"),p=r("./app/components/button.tsx"),u=r("./app/locale.tsx"),h=r("./app/utils/withApi.tsx"),m=r("./app/utils/withOrganization.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let w;!function(e){e.IssuesByTag="Issues-by-Tag",e.Discover="Discover"}(w||(w={}));class x extends n.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",this.initialState),(0,o.Z)(this,"resetState",(()=>{this.setState(this.initialState)})),(0,o.Z)(this,"startDataExport",(()=>{const{api:e,organization:{slug:t},payload:{queryType:r,queryInfo:o}}=this.props;this.setState({inProgress:!0}),e.requestPromise("/organizations/".concat(t,"/data-export/"),{includeAllArgs:!0,method:"POST",data:{query_type:r,query_info:o}}).then((([e,t,r])=>{(0,l.S9)(201===(null==r?void 0:r.status)?(0,u.t)("Sit tight. We'll shoot you an email when your data is ready for download."):(0,u.t)("It looks like we're already working on it. Sit tight, we'll email you."))})).catch((e=>{var t,r;const o=null!==(t=null==e||null===(r=e.responseJSON)||void 0===r?void 0:r.detail)&&void 0!==t?t:"We tried our hardest, but we couldn't export your data. Give it another go.";(0,l.Iw)((0,u.t)(o)),this.setState({inProgress:!1})}))}))}componentDidUpdate({payload:e}){const{payload:t}=this.props;d()(e,t)||this.resetState()}get initialState(){return{inProgress:!1}}render(){const{inProgress:e}=this.state,{children:t,disabled:r,icon:o}=this.props;return(0,y.tZ)(c.Z,{features:["organizations:discover-query"],children:e?(0,y.tZ)(p.ZP,{size:"small",priority:"default",title:"You can get on with your life. We'll email you when your data's ready.",...this.props,disabled:!0,icon:o,children:(0,u.t)("We're working on it...")}):(0,y.tZ)(p.ZP,{onClick:i()(this.startDataExport,500),disabled:r||!1,size:"small",priority:"default",title:"Put your data to work. Start your export and we'll email you when it's finished.",icon:o,...this.props,children:t||(0,u.t)("Export All to CSV")})})}}x.displayName="DataExport";const Z=(0,h.Z)((0,m.Z)(x))},"./app/views/asyncView.tsx":(e,t,r)=>{r.d(t,{Z:()=>i}),r("../node_modules/react/index.js");var o=r("./app/components/asyncComponent.tsx"),n=r("./app/components/sentryDocumentTitle.tsx"),s=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends o.Z{getTitle(){return""}render(){return(0,s.tZ)(n.Z,{title:this.getTitle(),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/dataExport/dataDownload.tsx":(e,t,r)=>{r.r(t),r.d(t,{DownloadStatus:()=>w,default:()=>v});var o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),i=r("../node_modules/react-router/es/index.js"),a=r("./app/components/button.tsx"),d=r("./app/components/dataExport.tsx"),l=r("./app/components/dateTime.tsx"),c=r("./app/icons/index.tsx"),p=r("./app/locale.tsx"),u=r("./app/styles/space.tsx"),h=r("./app/views/asyncView.tsx"),m=r("./app/views/auth/layout.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let w;!function(e){e.Early="EARLY",e.Valid="VALID",e.Expired="EXPIRED"}(w||(w={}));class x extends h.Z{constructor(...e){super(...e),(0,o.Z)(this,"disableErrorReport",!1)}getTitle(){return(0,p.t)("Download Center")}getEndpoints(){const{orgId:e,dataExportId:t}=this.props.params;return[["download","/organizations/".concat(e,"/data-export/").concat(t,"/")]]}getActionLink(e){const{orgId:t}=this.props.params;switch(e){case d.tD.IssuesByTag:return"/organizations/".concat(t,"/issues/");case d.tD.Discover:return"/organizations/".concat(t,"/discover/queries/");default:return"/"}}renderDate(e){if(!e)return null;const t=new Date(e);return(0,y.tZ)("strong",{children:(0,y.tZ)(l.Z,{date:t})})}renderEarly(){return(0,y.BX)(s.Fragment,{children:[(0,y.tZ)(Z,{children:(0,y.BX)("h3",{children:[(0,p.t)("What are"),(0,y.tZ)("i",{children:(0,p.t)(" you ")}),(0,p.t)("doing here?")]})}),(0,y.BX)(g,{children:[(0,y.tZ)("p",{children:(0,p.t)("Not that its any of our business, but were you invited to this page? It's just that we don't exactly remember emailing you about it.")}),(0,y.tZ)("p",{children:(0,p.t)("Close this window and we'll email you when your download is ready.")})]})]})}renderExpired(){const{query:e}=this.state.download,t=this.getActionLink(e.type);return(0,y.BX)(s.Fragment,{children:[(0,y.tZ)(Z,{children:(0,y.tZ)("h3",{children:(0,p.t)("This is awkward.")})}),(0,y.BX)(g,{children:[(0,y.tZ)("p",{children:(0,p.t)("That link expired, so your download doesn't live here anymore. Just picked up one day and left town.")}),(0,y.tZ)("p",{children:(0,p.t)("Make a new one with your latest data. Your old download will never see it coming.")}),(0,y.tZ)(b,{href:t,priority:"primary",children:(0,p.t)("Start a New Download")})]})]})}openInDiscover(){const{download:{query:{info:e}}}=this.state,{orgId:t}=this.props.params,r={pathname:"/organizations/".concat(t,"/discover/results/"),query:e};i.browserHistory.push(r)}renderOpenInDiscover(){const{download:{query:e={type:d.tD.IssuesByTag,info:{}}}}=this.state,{type:t=d.tD.IssuesByTag}=e;return"Discover"===t?(0,y.BX)(s.Fragment,{children:[(0,y.tZ)("p",{children:(0,p.t)("Need to make changes?")}),(0,y.tZ)(a.ZP,{priority:"primary",onClick:()=>this.openInDiscover(),children:(0,p.t)("Open in Discover")}),(0,y.tZ)("br",{})]}):null}renderValid(){const{download:{dateExpired:e,checksum:t}}=this.state,{orgId:r,dataExportId:o}=this.props.params;return(0,y.BX)(s.Fragment,{children:[(0,y.tZ)(Z,{children:(0,y.tZ)("h3",{children:(0,p.t)("All done.")})}),(0,y.BX)(g,{children:[(0,y.tZ)("p",{children:(0,p.t)("See, that wasn't so bad. Your data is all ready for download.")}),(0,y.tZ)(a.ZP,{priority:"primary",icon:(0,y.tZ)(c.Dj,{}),href:"/api/0/organizations/".concat(r,"/data-export/").concat(o,"/?download=true"),children:(0,p.t)("Download CSV")}),(0,y.BX)("p",{children:[(0,p.t)("That link won't last forever â€” it expires:"),(0,y.tZ)("br",{}),this.renderDate(e)]}),this.renderOpenInDiscover(),(0,y.BX)("p",{children:[(0,y.tZ)("small",{children:(0,y.BX)("strong",{children:["SHA1:",t]})}),(0,y.tZ)("br",{}),(0,p._N)("Need help verifying? [link].",{link:(0,y.tZ)("a",{href:"https://docs.sentry.io/product/discover-queries/query-builder/#filter-by-table-columns",target:"_blank",rel:"noopener noreferrer",children:(0,p.t)("Check out our docs")})})]})]})]})}renderError(){var e;const{errors:{download:t}}=this.state,r=null==t||null===(e=t.responseJSON)||void 0===e?void 0:e.detail;return(0,y.tZ)(m.Z,{children:(0,y.BX)("main",{children:[(0,y.tZ)(Z,{children:(0,y.BX)("h3",{children:[t.status," - ",t.statusText]})}),r&&(0,y.tZ)(g,{children:(0,y.tZ)("p",{children:r})})]})})}renderContent(){const{download:e}=this.state;switch(e.status){case w.Early:return this.renderEarly();case w.Expired:return this.renderExpired();default:return this.renderValid()}}renderBody(){return(0,y.tZ)(m.Z,{children:(0,y.tZ)("main",{children:this.renderContent()})})}}const Z=(0,n.Z)("header",{target:"eq2c1c22"})("border-bottom:1px solid ",(e=>e.theme.border),";padding:",(0,u.Z)(3)," 40px 0;h3{font-size:24px;margin:0 0 ",(0,u.Z)(3)," 0;}"),g=(0,n.Z)("div",{target:"eq2c1c21"})("padding:",(0,u.Z)(2)," 40px;max-width:500px;p{margin:",(0,u.Z)(1.5)," 0;}"),b=(0,n.Z)(a.ZP,{target:"eq2c1c20"})("margin-bottom:",(0,u.Z)(1.5),";"),v=x}}]);
//# sourceMappingURL=../sourcemaps/app_views_dataExport_dataDownload_tsx.c2c280d9328d0a6abfe017c12eb3f62a.js.map