"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_settings_projectPlugins_index_tsx"],{"./app/actionCreators/plugins.tsx":(t,e,s)=>{s.d(e,{MM:()=>p,Cg:()=>d,rR:()=>u}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=s("./app/actionCreators/indicator.tsx"),i=s("./app/actions/pluginActions.tsx"),o=s("./app/api.tsx"),r=s("./app/locale.tsx");const a={},l=new o.KU;function c({orgId:t,projectId:e,pluginId:s,update:n,...o}){i.Z.update(s,n);const r=l.requestPromise("/projects/".concat(t,"/").concat(e,"/plugins/").concat(s,"/"),{...o});return r.then((()=>{i.Z.updateSuccess(s,n)})).catch((t=>{const e=t&&t.responseJSON&&"string"==typeof t.responseJSON.detail?new Error(t.responseJSON.detail):new Error("Unable to update plugin");i.Z.updateError(s,n,e)})),r}function p({orgId:t,projectId:e},s){const n="/projects/".concat(t,"/").concat(e,"/plugins/");if(a[n])return a[n];i.Z.fetchAll(s);const o=l.requestPromise(n,{method:"GET",includeAllArgs:!0});return a[n]=o,o.then((([t,e,s])=>(i.Z.fetchAllSuccess(t,{pageLinks:null==s?void 0:s.getResponseHeader("Link")}),t))).catch((t=>{throw i.Z.fetchAllError(t),new Error("Unable to fetch plugins")})).then((()=>a[n]=null)),o}function d(t){return(0,n.E3)((0,r.t)("Enabling...")),c({...t,update:{enabled:!0},method:"POST"}).then((()=>(0,n.S9)((0,r.t)("Plugin was enabled")))).catch((()=>(0,n.Iw)((0,r.t)("Unable to enable plugin"))))}function u(t){return(0,n.E3)((0,r.t)("Disabling...")),c({...t,update:{enabled:!1},method:"DELETE"}).then((()=>(0,n.S9)((0,r.t)("Plugin was disabled")))).catch((()=>(0,n.Iw)((0,r.t)("Unable to disable plugin"))))}},"./app/actions/pluginActions.tsx":(t,e,s)=>{s.d(e,{Z:()=>i});var n=s("../node_modules/reflux/src/index.js");const i=s.n(n)().createActions(["update","updateError","updateSuccess","fetchAll","fetchAllSuccess","fetchAllError"])},"./app/utils/recreateRoute.tsx":(t,e,s)=>{s.d(e,{Z:()=>r});var n=s("../node_modules/lodash/findLastIndex.js"),i=s.n(n),o=s("./app/utils/replaceRouterParams.tsx");function r(t,e){var s,n;const{routes:r,params:a,location:l,stepBack:c}=e,p=r.map((({path:t})=>t||""));let d,u;"string"!=typeof t?(u=r.indexOf(t)+1,d=i()(p.slice(0,u),(t=>"/"===t[0]))):d=i()(p,(t=>"/"===t[0]));let g=p.slice(d,u);void 0!==c&&(g=g.slice(0,c));const h=null!==(s=null==l?void 0:l.search)&&void 0!==s?s:"",m=null!==(n=null==l?void 0:l.hash)&&void 0!==n?n:"",x="".concat(g.join("")).concat("string"!=typeof t?"":t).concat(h).concat(m);return(0,o.Z)(x,a)}},"./app/utils/withPlugins.tsx":(t,e,s)=>{s.d(e,{Z:()=>Z});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("./app/actionCreators/plugins.tsx"),r=s("../node_modules/reflux/src/index.js"),a=s.n(r),l=s("./app/actions/pluginActions.tsx");const c={loading:!0,plugins:[],error:null,pageLinks:null},p={plugins:null,state:{...c},updating:new Map,reset(){return this.plugins=null,this.state={...c},this.updating=new Map,this.state},getInitialState(){return this.getState()},getState(){const{plugins:t,...e}=this.state;return{...e,plugins:this.plugins?Array.from(this.plugins.values()):[]}},init(){this.reset(),this.listenTo(l.Z.fetchAll,this.onFetchAll),this.listenTo(l.Z.fetchAllSuccess,this.onFetchAllSuccess),this.listenTo(l.Z.fetchAllError,this.onFetchAllError),this.listenTo(l.Z.update,this.onUpdate),this.listenTo(l.Z.updateSuccess,this.onUpdateSuccess),this.listenTo(l.Z.updateError,this.onUpdateError)},triggerState(){this.trigger(this.getState())},onFetchAll({resetLoading:t}={}){t&&(this.state.loading=!0,this.state.error=null,this.plugins=null),this.triggerState()},onFetchAllSuccess(t,{pageLinks:e}){this.plugins=new Map(t.map((t=>[t.id,t]))),this.state.pageLinks=e||null,this.state.loading=!1,this.triggerState()},onFetchAllError(t){this.plugins=null,this.state.loading=!1,this.state.error=t,this.triggerState()},onUpdate(t,e){if(!this.plugins)return;const s=this.plugins.get(t);if(!s)return;const n={...s,...e};this.plugins.set(t,n),this.updating.set(t,s),this.triggerState()},onUpdateSuccess(t,e){this.updating.delete(t)},onUpdateError(t,e,s){const n=this.updating.get(t);n&&this.plugins&&(this.plugins.set(t,n),this.updating.delete(t),this.state.error=s,this.triggerState())}},d=a().createStore(p);var u=s("./app/utils.tsx"),g=s("./app/utils/getDisplayName.tsx"),h=s("./app/utils/withOrganization.tsx"),m=s("./app/utils/withProject.tsx"),x=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=function(t){class e extends i.Component{constructor(...t){super(...t),(0,n.Z)(this,"state",{plugins:[],loading:!0}),(0,n.Z)(this,"unsubscribe",d.listen((({plugins:t,loading:e})=>{this.setState({plugins:t,loading:e})}),void 0))}componentDidMount(){this.fetchPlugins()}componentDidUpdate(t,e,s){const{organization:n,project:i}=this.props,o=t.organization||(null==s?void 0:s.organization),r=t.project||(null==s?void 0:s.project);if(!(0,u.ri)(r)||!(0,u.ri)(o))return;const a=o.slug===n.slug,l=r.slug===(null==i?void 0:i.slug);a&&l||this.fetchPlugins()}componentWillUnmount(){this.unsubscribe()}fetchPlugins(){const{organization:t,project:e}=this.props;e&&t&&(0,o.MM)({projectId:e.slug,orgId:t.slug})}render(){return(0,x.tZ)(t,{...this.props,plugins:this.state})}}return e.displayName="WithPlugins",(0,n.Z)(e,"displayName","withPlugins(".concat((0,g.Z)(t),")")),(0,h.Z)((0,m.Z)(e))}},"./app/views/settings/project/permissionAlert.tsx":(t,e,s)=>{s.d(e,{Z:()=>c}),s("../node_modules/react/index.js");var n=s("./app/components/acl/access.tsx"),i=s("./app/components/alert.tsx"),o=s("./app/icons/index.tsx"),r=s("./app/locale.tsx"),a=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const l=({access:t=["project:write"],...e})=>(0,a.tZ)(n.Z,{access:t,children:({hasAccess:t})=>!t&&(0,a.tZ)(i.Z,{type:"warning",icon:(0,a.tZ)(o.FC,{size:"xs"}),...e,children:(0,r.t)("These settings can only be edited by users with the organization owner, manager, or admin role.")})});l.displayName="PermissionAlert";const c=l},"./app/views/settings/projectPlugins/index.tsx":(t,e,s)=>{s.r(e),s.d(e,{default:()=>B});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("./app/actionCreators/plugins.tsx"),r=s("./app/components/sentryDocumentTitle.tsx"),a=s("./app/locale.tsx"),l=s("./app/utils/integrationUtil.tsx"),c=s("./app/utils/withPlugins.tsx"),p=s("./app/views/settings/components/settingsPageHeader.tsx"),d=s("./app/views/settings/project/permissionAlert.tsx"),u=s("./app/components/acl/access.tsx"),g=s("./app/components/links/link.tsx"),h=s("./app/components/loadingIndicator.tsx"),m=s("./app/components/panels/index.tsx"),x=s("./app/views/routeError.tsx"),Z=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),f=s("./app/components/links/externalLink.tsx"),j=s("./app/components/switchButton.tsx"),v=s("./app/plugins/components/pluginIcon.tsx"),b=s("./app/utils/getDynamicText.tsx"),w=s("./app/utils/recreateRoute.tsx"),y=s("./app/utils/withOrganization.tsx"),S=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const A={name:"is2cq7",styles:"color:#979ba0"};class P extends i.PureComponent{constructor(...t){super(...t),(0,n.Z)(this,"handleChange",(()=>{const{onChange:t,id:e,enabled:s}=this.props;t(e,!s);const n=s?"integrations.disabled":"integrations.enabled";(0,l.Db)(n,{integration:e,integration_type:"plugin",view:"legacy_integrations",organization:this.props.organization})}))}render(){const{id:t,name:e,slug:s,version:n,author:i,hasConfiguration:o,enabled:r,canDisable:l}=this.props,c=(0,w.Z)(t,this.props);return(0,S.tZ)(u.Z,{access:["project:write"],children:({hasAccess:p})=>{const d=p?g.Z:"span";return(0,S.BX)(_,{className:s,children:[(0,S.BX)(E,{children:[(0,S.tZ)(k,{size:48,pluginId:t}),(0,S.BX)(C,{children:[(0,S.BX)(z,{children:["".concat(e," "),(0,b.Z)({value:(0,S.tZ)(U,{children:n?"v".concat(n):(0,S.tZ)("em",{children:(0,a.t)("n/a")})}),fixed:(0,S.tZ)(U,{children:"v10"})})]}),(0,S.BX)("div",{children:[i&&(0,S.tZ)(f.Z,{css:A,href:i.url,children:i.name}),o&&(0,S.BX)("span",{children:[" ","Â·"," ",(0,S.tZ)(d,{css:A,to:c,children:(0,a.t)("Configure plugin")})]})]})]})]}),(0,S.tZ)(j.Z,{size:"lg",isDisabled:!p||!l,isActive:r,toggle:this.handleChange})]},t)}})}}P.displayName="ProjectPluginRow";const I=(0,y.Z)(P),_=(0,Z.Z)("div",{target:"evund0f5"})({name:"zol16h",styles:"display:flex;flex:1;align-items:center"}),C=(0,Z.Z)("div",{target:"evund0f4"})({name:"1cepywk",styles:"display:flex;justify-content:center;flex-direction:column"}),E=(0,Z.Z)("div",{target:"evund0f3"})({name:"1l1txui",styles:"display:flex;flex:1;line-height:24px"}),z=(0,Z.Z)("div",{target:"evund0f2"})({name:"11g4mt0",styles:"font-size:16px"}),k=(0,Z.Z)(v.ZP,{target:"evund0f1"})({name:"o7nnmj",styles:"margin-right:16px"}),U=(0,Z.Z)("span",{target:"evund0f0"})({name:"qhuumn",styles:"color:#babec2"});class D extends i.Component{render(){const{plugins:t,loading:e,error:s,onChange:n,routes:i,params:o,project:r}=this.props,{orgId:l}=this.props.params,c=!s&&e;return s?(0,S.tZ)(x.Z,{error:s}):c?(0,S.tZ)(h.Z,{}):(0,S.BX)(m.s_,{children:[(0,S.BX)(m.V9,{children:[(0,S.tZ)("div",{children:(0,a.t)("Legacy Integration")}),(0,S.tZ)("div",{children:(0,a.t)("Enabled")})]}),(0,S.BX)(m.N,{children:[(0,S.tZ)(m.aU,{type:"warning",children:(0,S.tZ)(u.Z,{access:["org:integrations"],children:({hasAccess:t})=>t?(0,a._N)("Legacy Integrations must be configured per-project. It's recommended to prefer organization integrations over the legacy project integrations when available. Visit the [link:organization integrations] settings to manage them.",{link:(0,S.tZ)(g.Z,{to:"/settings/".concat(l,"/integrations")})}):(0,a.t)("Legacy Integrations must be configured per-project. It's recommended to prefer organization integrations over the legacy project integrations when available.")})}),t.filter((t=>!t.isHidden)).map((t=>(0,S.tZ)(m.Lv,{children:(0,S.tZ)(I,{params:o,routes:i,project:r,...t,onChange:n})},t.id)))]})]})}}D.displayName="ProjectPlugins";const L=D;class N extends i.Component{constructor(...t){super(...t),(0,n.Z)(this,"fetchData",(async()=>{const t=(await(0,o.MM)(this.props.params)).filter((t=>t.hasConfiguration&&t.enabled)).length;(0,l.Db)("integrations.index_viewed",{integrations_installed:t,view:"legacy_integrations",organization:this.props.organization},{startSession:!0})})),(0,n.Z)(this,"handleChange",((t,e)=>{const{projectId:s,orgId:n}=this.props.params;(e?o.Cg:o.rR)({projectId:s,orgId:n,pluginId:t})}))}componentDidMount(){this.fetchData()}render(){const{loading:t,error:e,plugins:s}=this.props.plugins||{},{orgId:n}=this.props.params,o=(0,a.t)("Legacy Integrations");return(0,S.BX)(i.Fragment,{children:[(0,S.tZ)(r.Z,{title:o,orgSlug:n}),(0,S.tZ)(p.Z,{title:o}),(0,S.tZ)(d.Z,{}),(0,S.tZ)(L,{...this.props,onChange:this.handleChange,loading:t,error:e,plugins:s})]})}}N.displayName="ProjectPluginsContainer";const B=(0,c.Z)(N)}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_projectPlugins_index_tsx.b4b6945af2cf78abfb48a696f65d759d.js.map